<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkillNeast Courses</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Open+Sans:wght@300;400;600;700&family=Comfortaa:wght@700;800&family=Poppins:wght@700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        :root {
            /* Premium Colors (Dark Theme Defaults) */
            --primary-dark: #1A2B3C;
            --accent-teal: #00ADB5;
            --secondary-light: #2c2c2c;
            --text-dark: #f0f0f0;
            --text-light: #b0b0b0;
            --highlight-gold: #FFD700;
            --success-green: #4CAF50;
            --error-red: #EF5350;
            --white: #ffffff;
            --border-color: rgba(255, 255, 255, 0.08);
            --cyan-glow-color: rgba(0, 173, 181, 0.5);
            --dark-bg-gradient-start: #000000;
            --dark-bg-gradient-end: #1A1A1A;
            /* Image-specific colors for lesson-item and player view */
            --player-bg-color: #1A2B3C;
            --player-section-bg: #222222;
            --player-meta-bg: #282828;
            --timeline-btn-bg: #4CAF50;
            --comments-btn-bg: #007bff;
            --watch-later-btn-bg: #6c757d;
            /* Shadows & Radii */
            --shadow-light: 0 4px 12px rgba(0, 0, 0, 0.2);
            --shadow-medium: 0 10px 30px rgba(0, 0, 0, 0.35);
            --shadow-popup: 0 15px 40px rgba(0, 0, 0, 0.5);
            --border-radius-main: 25px;
            --border-radius-card: 15px;
            --border-radius-input: 10px;
            --border-radius-button: 30px;

            /* Slider Menu Variables */
            --slider-bg: #1A1A1A;
            --slider-item-hover: #2c2c2c;
            --slider-text-color: var(--text-dark);
            --slider-icon-color: var(--accent-teal);
            --slider-border-color: rgba(255, 255, 255, 0.1);
        }

        /* Light Mode Variables (These are still here, but toggle functionality is removed from slider) */
        body.light-mode {
            --primary-dark: #F0F0F0;
            --accent-teal: #007B80; /* A darker teal for contrast */
            --secondary-light: #F8F8F8;
            --text-dark: #333333;
            --text-light: #555555;
            --highlight-gold: #DAA520;
            --success-green: #388E3C;
            --error-red: #D32F2F;
            --white: #000000;
            --border-color: rgba(0, 0, 0, 0.1);
            --player-bg-color: #DDDDDD;
            --player-section-bg: #FFFFFF;
            --player-meta-bg: #EAEAEA;

            --shadow-light: 0 4px 12px rgba(0, 0, 0, 0.1);
            --shadow-medium: 0 10px 30px rgba(0, 0, 0, 0.2);
            --shadow-popup: 0 15px 40px rgba(0, 0, 0, 0.3);
            
            --dark-bg-gradient-start: #FFFFFF;
            --dark-bg-gradient-end: #F0F0F0;
            /* Light mode specific for slider */
            --slider-bg: #FFFFFF;
            --slider-item-hover: #E0E0E0;
            --slider-text-color: #333333;
            --slider-icon-color: #007B80;
            --slider-border-color: rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Open Sans', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--secondary-light);
            color: var(--text-dark);
            line-height: 1.8;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
            padding-bottom: 90px;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        img {
            pointer-events: none;
            -webkit-user-drag: none;
            user-drag: none;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: auto;
            padding: 0 15px;
        }

        .top-navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 25px;
            background: linear-gradient(to right, var(--dark-bg-gradient-start), var(--dark-bg-gradient-end));
            box-shadow: var(--shadow-medium);
            position: relative;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            border-bottom-left-radius: var(--border-radius-main);
            border-bottom-right-radius: var(--border-radius-main);
            transition: background 0.3s ease, box-shadow 0.3s ease;
        }
        .top-navbar .menu-icon, .top-navbar .telegram-icon {
            font-size: 1.8em;
            color: var(--white);
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            width: 52px;
            height: 52px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease, color 0.3s ease;
            margin: 0;
            flex-shrink: 0;
        }
        
        .top-navbar .telegram-icon {
            padding-right: 5px;
        }
        .top-navbar .menu-icon {
            padding-left: 5px;
        }


        .top-navbar .menu-icon:hover, .top-navbar .telegram-icon:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }
        .top-navbar .app-logo {
            display: flex;
            flex-direction: row;
            align-items: center;
            padding: 8px 18px;
            background-color: var(--primary-dark);
            border-radius: var(--border-radius-button);
            box-shadow: var(--shadow-light);
            cursor: pointer;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            overflow: hidden;
            flex-grow: 0;
            margin: 0;
            justify-content: center;
            z-index: 1;
        }
        .top-navbar .app-logo:hover {
            background-color: #2F4156;
        }
        .top-navbar .app-logo img#skillNeastLogo {
            height: 34px;
            margin-right: 8px;
            margin-bottom: 0;
            transition: transform 1s linear;
        }
        .top-navbar .app-logo img#skillNeastLogo.rotating {
            animation: rotate360 1s linear forwards;
        }
        @keyframes rotate360 {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .top-navbar .app-logo .text-wrapper {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        .top-navbar .app-logo .main-title {
            font-family: 'Poppins', sans-serif;
            font-weight: 800;
            font-size: 1.5em;
            letter-spacing: 1.2px;
            background: linear-gradient(90deg, #FF6F61, #FFD700, #4CAF50, #00ADB5, #3F51B5, #9C27B0);
            -webkit-background-clip: text;
            color: transparent;
            display: inline-block;
            animation: rainbowText 5s linear infinite;
            background-size: 200% 100%;
            line-height: 1;
        }

        @keyframes rainbowText {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }
        /* New Tagline Styles */
        .top-navbar .app-logo .tagline {
            font-family: 'Open Sans', sans-serif;
            font-size: 0.65em;
            font-weight: 600;
            color: var(--text-light);
            text-align: left;
            animation: floatUpDown 2s infinite ease-in-out;
            white-space: nowrap;
            transition: color 0.3s ease;
            line-height: 1;
        }

        /* --- Main Content Area --- */
        .main-content {
            padding: 30px 20px;
            min-height: calc(100vh - 180px);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* --- Welcome Banner --- */
        .welcome-banner {
            background: linear-gradient(135deg, var(--primary-dark), #2F4156);
            color: var(--text-dark);
            padding: 28px;
            border-radius: var(--border-radius-main);
            box-shadow: 0 0 10px rgba(0, 173, 181, 0.6),
                        0 0 20px rgba(0, 173, 181, 0.4),
                        0 10px 30px rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 25px;
            border: 1px solid rgba(0, 173, 181, 0.1);
            position: relative;
            transition: background 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
        }
        .welcome-banner .greeting {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.9em;
            font-weight: 700;
            display: flex;
            align-items: center;
            color: var(--text-dark);
            transition: color 0.3s ease;
        }
        .welcome-banner .greeting i {
            margin-right: 10px;
            color: var(--error-red);
            font-size: 1.5em;
            vertical-align: middle;
        }
        .welcome-banner .fire-icon {
            font-size: 2.5em;
            color: #FF5722;
            animation: pulse 1s infinite alternate;
            vertical-align: middle;
            margin-left: 0;
        }
        .role-sticker {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--accent-teal);
            color: var(--white);
            font-family: 'Montserrat', sans-serif;
            font-size: 0.7em;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 12px;
            box-shadow: var(--shadow-light);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* --- Quote Section (Updated for Premium Look with Cyan Glow) --- */
        .quote-section {
            background: linear-gradient(135deg, #2A2A2A, #222222);
            padding: 30px;
            border-radius: var(--border-radius-main);
            box-shadow: 0 0 15px var(--cyan-glow-color),
                        0 10px 30px rgba(0, 0, 0, 0.35);
            text-align: center;
            margin-bottom: 30px;
            border: 2px solid var(--accent-teal);
            position: relative;
            overflow: hidden;
            transition: box-shadow 0.3s ease-in-out, background 0.3s ease, border-color 0.3s ease;
        }
        .quote-section::before {
            content: '“';
            position: absolute;
            top: 10px;
            left: 20px;
            font-family: serif;
            font-size: 5em;
            color: rgba(255, 255, 255, 0.08);
            z-index: 0;
            line-height: 0.5;
        }
        .quote-section::after {
            content: '”';
            position: absolute;
            bottom: -20px;
            right: 20px;
            font-family: serif;
            font-size: 5em;
            color: rgba(255, 255, 255, 0.08);
            z-index: 0;
            line-height: 0.5;
        }
        .quote-section .quote-text {
            font-family: 'Open Sans', sans-serif;
            font-style: italic;
            font-size: 1.25em;
            margin-bottom: 18px;
            color: var(--text-dark);
            position: relative;
            z-index: 1;
            animation: quoteSlideIn 0.8s cubic-bezier(0.23, 1, 0.32, 1) forwards;
            padding: 0 10px;
            transition: color 0.3s ease;
        }
        @keyframes quoteSlideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .quote-section .quote-author {
            font-weight: 700;
            color: var(--highlight-gold);
            font-size: 1.1em;
            position: relative;
            z-index: 1;
            animation: quoteAuthorFadeIn 1s ease-out forwards;
            transition: color 0.3s ease;
        }
        @keyframes quoteAuthorFadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .quote-section .quote-emoji {
            font-size: 1.3em;
            margin-left: 10px;
            display: inline-block;
            z-index: 1;
            animation: emojiPopAndGlow 0.6s ease-out forwards, floatUpDown 2s infinite ease-in-out;
        }
        @keyframes emojiPopAndGlow {
            0% { transform: scale(0); opacity: 0; text-shadow: none; }
            50% { transform: scale(1.3); opacity: 1; text-shadow: 0 0 8px var(--cyan-glow-color); }
            100% { transform: scale(1); opacity: 1; text-shadow: none; }
        }
        @keyframes floatUpDown {
            0% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0); }
        }

        /* Fullscreen Image Overlay */
        .fullscreen-image-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2500;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .fullscreen-image-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .fullscreen-image-overlay img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            cursor: zoom-out;
        }

        .fullscreen-image-close-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 2.5em;
            color: #fff;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .fullscreen-image-close-button:hover {
            color: var(--error-red);
        }

        /* Global Notice Popup Overlay (promotional popup) */
        .global-notice-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2100;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .global-notice-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .global-notice-popup {
            background-color: #f0f0f0;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.5);
            text-align: center;
            width: 90%;
            max-width: 450px;
            position: relative;
            color: #333;
            transform: translateY(20px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .global-notice-overlay.active .global-notice-popup {
            transform: translateY(0);
            opacity: 1;
        }

        .global-notice-close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 2em;
            color: #999;
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .global-notice-close-button:hover {
            color: #555;
        }

        .global-notice-popup .action-required-header {
            background-color: #ef5350;
            color: #fff;
            padding: 10px 15px;
            border-radius: 8px;
            margin: -20px -20px 20px -20px;
            font-weight: 700;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .global-notice-popup .action-required-header i {
            font-size: 1.5em;
            color: #FFD700;
        }

        .global-notice-popup p {
            font-size: 0.95em;
            line-height: 1.5;
            margin-bottom: 20px;
            color: #444;
        }

        .global-notice-popup .join-button {
            background-color: #4CAF50;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease;
            width: 100%;
            margin-bottom: 20px;
        }

        .global-notice-popup .join-button:hover {
            background-color: #45a049;
            transform: translateY(-2px);
        }

        .global-notice-popup .notice-reaction-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #ddd;
        }

        .global-notice-popup .reaction-icon-notice {
            font-size: 1.4em;
            cursor: pointer;
            padding: 5px 8px;
            border-radius: 5px;
            transition: background-color 0.2s ease;
            user-select: none;
            display: flex;
            align-items: center;
        }

        .global-notice-popup .reaction-icon-notice span {
            font-size: 0.8em;
            margin-left: 5px;
            color: #666;
        }

        .global-notice-popup .reaction-icon-notice:hover {
            background-color: #e0e0e0;
        }

        .global-notice-popup .reaction-icon-notice.reacted {
            background-color: #c9e6f1;
            color: var(--accent-teal);
        }

        .global-notice-popup .reaction-emoji {
            font-size: 1.5em;
            line-height: 1;
        }

        /* Telegram Channels Banner (WE NEED) - Premium Look */
        .telegram-channels-banner {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-radius: var(--border-radius-main);
            box-shadow: var(--shadow-medium);
            padding: 25px;
            text-align: center;
            margin-top: 30px;
            color: #333;
            font-family: 'Montserrat', sans-serif;
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }
        .telegram-channels-banner::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            filter: blur(15px);
        }
        .telegram-channels-banner::after {
            content: '';
            position: absolute;
            bottom: -10px;
            right: -10px;
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            filter: blur(20px);
        }

        .telegram-channels-banner .banner-title {
            font-size: 1.8em;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #C0392B;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            z-index: 1;
        }
        .telegram-channels-banner h2 {
            font-size: 1.5em;
            font-weight: 700;
            color: #4A4A4A;
            margin: 0;
            line-height: 1.2;
            z-index: 1;
        }
        .telegram-channels-banner .channel-list {
            text-align: center;
            font-size: 1em;
            font-weight: 600;
            line-height: 2;
            color: #666;
            z-index: 1;
        }
        .telegram-channels-banner .channel-list span {
            display: block;
            margin-bottom: 5px;
        }
        .telegram-channels-banner .channel-list i {
            margin-right: 8px;
            color: #007bff;
        }
        .telegram-channels-banner .click-here-button {
            background-color: #007bff;
            color: white;
            padding: 12px 25px;
            border-radius: 30px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            z-index: 1;
        }
        .telegram-channels-banner .click-here-button:hover {
            background-color: #0056b3;
            transform: translateY(-3px);
        }
        .telegram-channels-banner .your-support-text {
            font-size: 1.2em;
            font-weight: 700;
            color: #C0392B;
            margin-top: 15px;
            z-index: 1;
        }

        /* Discover Notice (Namo Buddhaya Everyone) - Premium Look */
        .discover-notice {
            background: linear-gradient(135deg, #1A2B3C, #000000);
            border-radius: var(--border-radius-main);
            box-shadow: var(--shadow-medium);
            padding: 30px;
            margin-top: 30px;
            color: var(--text-dark);
            font-family: 'Open Sans', sans-serif;
            text-align: left;
            display: none;
            position: relative;
            border: 1px solid var(--border-color);
        }
        .discover-notice .discover-image {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .discover-notice h4 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5em;
            font-weight: 700;
            color: var(--highlight-gold);
            margin-bottom: 15px;
            text-align: center;
        }
        .discover-notice ol {
            padding-left: 20px;
            margin-bottom: 0;
            color: var(--text-light);
        }
        .discover-notice ol li {
            margin-bottom: 10px;
            font-size: 1em;
            line-height: 1.6;
        }
        .discover-notice .emoji-inline {
            margin-right: 8px;
            font-size: 1.1em;
        }
        /* Discover Notice Reactions */
        .discover-notice-reactions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }
        .discover-notice-reactions .reaction-icon-discover {
            font-size: 1.5em;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
            transition: background-color 0.2s ease, transform 0.2s ease, color 0.2s ease;
            user-select: none;
            display: flex;
            align-items: center;
            color: var(--text-light);
        }
        .discover-notice-reactions .reaction-icon-discover span {
            font-size: 0.9em;
            margin-left: 8px;
            color: var(--text-light);
        }
        .discover-notice-reactions .reaction-icon-discover:hover {
            background-color: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
        }
        .discover-notice-reactions .reaction-icon-discover.reacted {
            background-color: rgba(0, 173, 181, 0.3);
            color: var(--accent-teal);
            transform: scale(1.05);
        }
        .discover-notice-reactions .reaction-emoji {
            font-size: 1.8em;
            line-height: 1;
        }

        /* --- Home View (Initial grid of course categories/batches) --- */
        #home-view {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            padding: 0px;
        }
        
        /* Container for dynamically loaded categories */
        #dynamic-categories-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            grid-column: 1 / -1;
        }

        .course-category-item {
            background-color: #333333;
            border-radius: 18px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            padding: 0;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease, background-color 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: stretch;
            min-height: 180px;
            border: 1px solid var(--border-color);
            overflow: hidden;
            width: 100%;
        }
        .course-category-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            border-color: var(--accent-teal);
        }
        .course-category-item:active {
            transform: scale(0.98);
        }
        .course-category-item.long-press {
            transform: scale(0.95) !important;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5) !important;
            transition-duration: 0.1s;
        }

        .course-category-item .image-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: inherit;
            overflow: hidden;
            z-index: 1;
        }
        .course-category-item .image-container img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            object-position: center;
            padding: 10px;
            box-sizing: border-box;
        }
        .course-category-item .content-overlay {
            position: relative;
            z-index: 2;
            background: rgba(0, 0, 0, 0.4);
            color: var(--white);
            padding: 10px 15px;
            text-align: center;
            box-sizing: border-box;
            width: 100%;
            margin-top: auto;
            transition: color 0.3s ease;
        }
        .course-category-item .content-overlay .category-name {
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            font-size: 1.2em;
            line-height: 1.2;
            margin-bottom: 0;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.8);
        }
        .course-category-item .new-tag {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #FFC107;
            color: var(--white);
            font-size: 0.7em;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 5px;
            text-transform: uppercase;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 3;
        }

        .surprise-button {
            grid-column: 1 / -1;
            background: linear-gradient(90deg, #FF6F61, #FF5722);
            color: var(--white);
            padding: 20px;
            border-radius: var(--border-radius-main);
            box-shadow: var(--shadow-medium);
            text-align: center;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.3em;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        .surprise-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(0,0,0,0.4);
            background: linear-gradient(90deg, #FF5722, #FF6F61);
        }
        .surprise-button:active {
            transform: scale(0.98);
        }
        .surprise-button i {
            font-size: 1.5em;
            animation: bounce 1s infinite alternate;
        }

        .original-price-strikethrough {
            text-decoration: line-through;
            color: var(--text-light);
            font-size: 0.9em;
            margin-left: 8px;
        }
        .free-price {
            font-weight: 700;
            color: var(--success-green);
        }
        .batch-description-feature {
            display: flex;
            align-items: flex-start;
            margin-bottom: 5px;
            color: var(--text-light);
        }
        .batch-description-feature i {
            margin-right: 8px;
            color: var(--success-green);
            font-size: 1.1em;
            line-height: inherit;
        }

        @media (max-width: 600px) {
            #home-view {
                grid-template-columns: 1fr;
            }
            #dynamic-categories-container {
                grid-template-columns: 1fr;
            }
            .surprise-button {
                font-size: 1.1em;
                padding: 15px;
                gap: 10px;
                margin-top: 15px;
            }
            .surprise-button i {
                font-size: 1.3em;
            }
            .course-category-item {
                min-height: 160px;
            }
            .course-category-item .image-container img { padding: 5px; }
            .course-category-item .content-overlay { padding: 10px; }
            .course-category-item .category-name { font-size: 0.95em;}

            .quote-section {
                padding: 20px;
            }
            .quote-section .quote-text {
                font-size: 1.1em;
            }
            .quote-section .quote-author {
                font-size: 0.95em;
            }
        }

        .favorites-section-home-card {
            grid-column: 1 / -1;
            background-color: #333333;
            border-radius: var(--border-radius-main);
            box-shadow: var(--shadow-light);
            padding: 25px;
            margin-top: 30px;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.3s ease;
            border: 1px solid var(--border-color);
        }
        .favorites-section-home-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-medium);
        }
        .favorites-section-home-card:active {
            transform: scale(0.98);
        }
        .favorites-section-home-card.long-press {
            transform: scale(0.95) !important;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5) !important;
            transition-duration: 0.1s;
        }
        .favorites-section-home-card h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8em;
            font-weight: 700;
            color: var(--text-dark);
            margin-top: 0;
            margin-bottom: 15px;
            transition: color 0.3s ease;
        }
        .favorites-section-home-card .fav-icon {
            font-size: 3em;
            color: var(--error-red);
            margin-bottom: 10px;
        }
        .favorites-section-home-card p {
            font-size: 1em;
            color: var(--text-light);
            margin-bottom: 10px;
            transition: color 0.3s ease;
        }
        .favorites-section-home-card .fav-count {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.2em;
            font-weight: 700;
            color: var(--accent-teal);
            transition: color 0.3s ease;
        }

        .telegram-card {
            grid-column: 1 / -1;
            background-color: #333333;
            border-radius: var(--border-radius-card);
            box-shadow: var(--shadow-light);
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease, background-color 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 150px;
            border: 1px solid var(--border-color);
            margin-top: 20px;
            color: var(--text-dark);
        }
        .telegram-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-medium);
            border-color: #0088cc;
        }
        .telegram-card:active {
            transform: scale(0.98);
        }
        .telegram-card.long-press {
            transform: scale(0.95) !important;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5) !important;
            transition-duration: 0.1s;
        }
        .telegram-card .telegram-icon-large {
            font-size: 3em;
            color: #0088cc;
            margin-bottom: 10px;
        }
        .telegram-card .telegram-text {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 1.2em;
            color: var(--text-dark);
            transition: color 0.3s ease;
        }

        #new-batches-view {
            display: none;
            padding: 0px;
        }
        #new-batches-view .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
        }
        #new-batches-view .back-button {
            background-color: transparent;
            border: none;
            font-size: 2em;
            color: var(--text-dark);
            cursor: pointer;
            margin-right: 18px;
            transition: color 0.2s ease, transform 0.2s ease;
        }
        #new-batches-view .back-button:hover {
            color: var(--accent-teal);
            transform: translateX(-5px);
        }
        #new-batches-view h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.2em;
            font-weight: 700;
            color: var(--text-dark);
            margin: 0;
            flex-grow: 1;
            transition: color 0.3s ease;
        }
        .search-bar-container {
            display: flex;
            align-items: center;
            background-color: #222222;
            border-radius: var(--border-radius-main);
            box-shadow: var(--shadow-light);
            padding: 8px 15px;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
            transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .search-bar-container input {
            flex-grow: 1;
            border: none;
            outline: none;
            padding: 8px 10px;
            font-size: 1em;
            font-family: 'Open Sans', sans-serif;
            color: var(--text-dark);
            background-color: transparent;
            transition: color 0.3s ease;
        }
        .search-bar-container .search-icon {
            font-size: 1.2em;
            color: var(--text-light);
            margin-right: 10px;
            transition: color 0.3s ease;
        }
        .search-bar-container .search-button {
            background-color: var(--accent-teal);
            color: var(--white);
            border: none;
            border-radius: var(--border-radius-button);
            padding: 10px 20px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .search-bar-container .search-button:hover {
            background-color: #00939b;
        }

        .batch-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .batch-card {
            background-color: #333333;
            border-radius: var(--border-radius-card);
            box-shadow: var(--shadow-light);
            overflow: hidden;
            border: 1px solid #444444;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.3s ease, border-color 0.3s ease;
        }
        .batch-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-medium);
        }
        .batch-card:active {
            transform: scale(0.98);
        }
        .batch-card.long-press {
            transform: scale(0.95) !important;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5) !important;
            transition-duration: 0.1s;
        }
        .batch-card-header {
            position: relative;
            background-color: var(--accent-teal);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--white);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.1em;
            font-weight: 600;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .batch-card-header .icons {
            font-size: 1.2em;
        }
        .batch-card-header .icons i {
            margin-left: 15px;
            cursor: pointer;
            transition: color 0.2s ease, transform 0.2s ease;
        }
        .batch-card-header .icons i.fas.fa-heart {
            color: var(--error-red);
            transform: scale(1.1);
        }
        .batch-card-header .icons i:hover {
            transform: scale(1.2);
        }

        .batch-card-body {
            padding: 20px;
            transition: color 0.3s ease;
        }
        .batch-card-body .batch-image-container {
            width: calc(100% + 40px);
            height: 220px;
            margin: -20px -20px 15px -20px;
            border-radius: 0;
            overflow: hidden;
            position: relative;
        }
        .batch-card-body .batch-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .batch-card-body .batch-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.6em;
            font-weight: 700;
            color: var(--text-dark);
            margin-top: 0;
            margin-bottom: 10px;
            transition: color 0.3s ease;
        }
        .batch-card-body .batch-description {
            font-size: 0.95em;
            color: var(--text-light);
            margin-bottom: 15px;
            line-height: 1.5;
            text-align: justify;
            transition: color 0.3s ease;
        }
        .batch-card-body .lets-roar-button {
            background-color: var(--primary-dark);
            color: var(--white);
            padding: 15px 25px;
            border-radius: var(--border-radius-button);
            text-align: center;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: var(--shadow-light);
            margin-top: 15px;
        }
        .batch-card-body .lets-roar-button:hover {
            background-color: #2F4156;
            transform: translateY(-2px);
        }
        .batch-card-body .lets-roar-button i {
            font-size: 1.2em;
        }

        .batch-card-body .access-content-button {
            background-color: #17a2b8;
            color: var(--white);
            padding: 15px 25px;
            border-radius: var(--border-radius-button);
            text-align: center;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: var(--shadow-light);
            margin-top: 15px;
        }
        .batch-card-body .access-content-button:hover {
            background-color: #138496;
            transform: translateY(-2px);
        }
        .batch-card-body .access-content-button i {
            font-size: 1.2em;
            animation: pulse 1s infinite alternate;
        }


        #favorites-view {
            display: none;
            padding: 0px;
        }
        #favorites-view .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
        }
        #favorites-view .back-button {
            background-color: transparent;
            border: none;
            font-size: 2em;
            color: var(--text-dark);
            cursor: pointer;
            margin-right: 18px;
            transition: color 0.2s ease, transform 0.2s ease;
        }
        #favorites-view .back-button:hover {
            color: var(--accent-teal);
            transform: translateX(-5px);
        }
        #favorites-view h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.2em;
            font-weight: 700;
            color: var(--text-dark);
            margin: 0;
            flex-grow: 1;
            transition: color 0.3s ease;
        }
        .promotional-banner {
            display: none;
        }
        .favorite-batch-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .no-favorites-message-view {
            font-size: 1.2em;
            color: var(--text-light);
            text-align: center;
            padding: 40px 20px;
            background-color: #333333;
            border-radius: var(--border-radius-card);
            box-shadow: var(--shadow-light);
            margin-top: 20px;
            border: 1px solid var(--border-color);
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .partition {
            display: none;
        }

        #sections-view {
            display: none;
            padding: 0px;
        }
        #sections-view .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
        }
        #sections-view .back-button {
            background-color: transparent;
            border: none;
            font-size: 2em;
            color: var(--text-dark);
            cursor: pointer;
            margin-right: 18px;
            transition: color 0.2s ease, transform 0.2s ease;
        }
        #sections-view .back-button:hover {
            color: var(--accent-teal);
            transform: translateX(-5px);
        }
        #sections-view h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.2em;
            font-weight: 700;
            color: var(--text-dark);
            margin: 0;
            flex-grow: 1;
            transition: color 0.3s ease;
        }
        .sections-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .section-item {
            background: linear-gradient(135deg, rgba(0, 173, 181, 0.1), rgba(0, 173, 181, 0.05));
            border-radius: var(--border-radius-card);
            box-shadow: var(--shadow-light);
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.3s ease;
            border: 1px solid rgba(0, 173, 181, 0.2);
            position: relative;
            overflow: hidden;
        }
        .section-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background-color: var(--accent-teal);
            border-top-left-radius: inherit;
            border-bottom-left-radius: inherit;
        }
        .section-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }
        .section-item .section-name {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.4em;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 5px;
            padding-left: 10px;
            text-align: left;
            flex-grow: 1;
        }
        .section-item .section-counts {
            font-size: 0.9em;
            color: var(--text-light);
            padding-left: 10px;
            text-align: left;
        }
        .section-item .section-counts span {
            font-weight: 600;
            color: var(--accent-teal);
        }
        .section-item .section-arrow {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5em;
            color: var(--accent-teal);
            transition: color 0.3s ease;
        }

        .content-category-header {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.6em;
            font-weight: 700;
            color: var(--highlight-gold);
            margin-top: 25px;
            margin-bottom: 15px;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .content-category-header i {
            font-size: 1.2em;
        }
        .content-list-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        #lessons-in-sections-view {
            display: none;
            padding: 0px;
        }
        #lessons-in-sections-view .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
        }
        #lessons-in-sections-view .back-button {
            background-color: transparent;
            border: none;
            font-size: 2em;
            color: var(--text-dark);
            cursor: pointer;
            margin-right: 18px;
            transition: color 0.2s ease, transform 0.2s ease;
        }
        #lessons-in-sections-view .back-button:hover {
            color: var(--accent-teal);
            transform: translateX(-5px);
        }
        #lessons-in-sections-view h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.2em;
            font-weight: 700;
            color: var(--text-dark);
            margin: 0;
            flex-grow: 1;
            transition: color 0.3s ease;
        }
        .lesson-list-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .lesson-list-item {
            background: linear-gradient(135deg, #2A2A2A, #222222);
            border-radius: var(--border-radius-card);
            box-shadow: var(--shadow-light);
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.3s ease;
            position: relative;
        }
        .lesson-list-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }
        .lesson-list-item-right {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            text-align: left;
        }
        .lesson-list-item .lesson-list-item-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.3em;
            font-weight: 700;
            color: var(--text-dark);
            margin: 0 0 5px 0;
            line-height: 1.2;
        }
        .lesson-list-item .video-icon-overlay {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 2em;
            color: var(--error-red);
        }


        #video-player-view {
            display: none;
            padding: 0px;
            background-color: var(--player-bg-color);
            min-height: calc(100vh - 90px);
            transition: background-color 0.3s ease;
        }
        #video-player-view .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 0px;
            padding: 15px 20px;
            background-color: var(--player-bg-color);
            transition: background-color 0.3s ease;
        }
        #video-player-view .back-button {
            background-color: transparent;
            border: none;
            font-size: 2em;
            color: var(--text-dark);
            cursor: pointer;
            margin-right: 18px;
            transition: color 0.2s ease, transform 0.2s ease;
        }
        #video-player-view .back-button:hover {
            color: var(--accent-teal);
            transform: translateX(-5px);
        }
        #video-player-view h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.2em;
            font-weight: 700;
            color: var(--text-dark);
            margin: 0;
            flex-grow: 1;
            transition: color 0.3s ease;
        }

        .player-card-header-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .player-card-header-actions .icon-button {
            font-size: 1.5em;
            color: var(--text-light);
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: color 0.2s ease, transform 0.2s ease, background-color 0.2s ease;
            position: relative;
        }
        .player-card-header-actions .like-button.liked {
            color: var(--error-red);
            transform: scale(1.1);
        }
        .player-card-header-actions .like-button:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }
        .like-count-display {
            position: absolute;
            bottom: -8px;
            right: -8px;
            background-color: var(--highlight-gold);
            color: var(--primary-dark);
            font-size: 0.6em;
            font-weight: 700;
            padding: 2px 5px;
            border-radius: 10px;
            min-width: 20px;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            z-index: 2;
        }
        @keyframes popAndPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
        .like-button.animating {
            animation: popAndPulse 0.3s ease-out;
        }

        .player-card-container {
            padding: 0px 20px 20px 20px;
        }

        .player-card {
            background-color: var(--player-section-bg);
            border-radius: var(--border-radius-card);
            box-shadow: var(--shadow-light);
            overflow: hidden;
            border: 1px solid var(--border-color);
            margin-bottom: 20px;
            transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .main-video-player {
            position: relative;
            padding-top: 56.25%;
            background-color: #000;
            display: block;
        }
        .main-video-player iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        .player-metadata {
            padding: 20px;
            background-color: var(--player-meta-bg);
            border-top: 1px solid var(--border-color);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        .player-metadata .lesson-sub-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8em;
            font-weight: 600;
            color: var(--text-dark);
            margin-top: 0;
            margin-bottom: 10px;
            text-align: center;
            transition: color 0.3s ease;
        }
        
        .player-action-buttons {
            display: flex;
            gap: 10px;
            padding: 0 20px 20px 20px;
        }
        .player-action-buttons .action-button {
            flex: 1;
            background-color: var(--button-primary);
            color: var(--white);
            border: none;
            border-radius: var(--border-radius-button);
            padding: 12px 10px;
            font-family: 'Montserrat', sans-serif;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: var(--shadow-light);
            transition: background-color 0.2s ease, transform 0.2s ease, color 0.3s ease;
        }
        .player-action-buttons .action-button:hover {
            transform: translateY(-2px);
        }
        .player-action-buttons .action-button.timeline {
            background-color: var(--timeline-btn-bg);
        }
        .player-action-buttons .action-button.comments {
            background-color: var(--comments-btn-bg);
        }
        .player-action-buttons .action-button.watch-later {
            background-color: var(--watch-later-btn-bg);
        }

        .lesson-list {
            list-style: none;
            padding: 0 20px;
            margin-top: 20px;
        }
        .lesson-item {
            background: linear-gradient(135deg, #2A2A2A, #222222);
            border-radius: var(--border-radius-card);
            box-shadow: var(--shadow-light);
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.3s ease;
            position: relative;
        }
        .lesson-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }
        .lesson-item h3 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.3em;
            color: var(--text-dark);
            margin-top: 0;
            margin-bottom: 0;
            transition: color 0.3s ease;
        }

        /* --- Bottom Navigation Bar --- */
        .bottom-navbar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #1A1A1A;
            box-shadow: 0 -6px 20px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: space-around;
            padding: 15px 0;
            border-top-left-radius: var(--border-radius-main);
            border-top-right-radius: var(--border-radius-main);
            z-index: 1000;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }
        .nav-item {
            text-align: center;
            color: var(--text-light);
            font-size: 0.9em;
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 5px;
            transition: color 0.2s ease, transform 0.2s ease;
        }
        .nav-item i {
            font-size: 1.8em;
            margin-bottom: 8px;
            transition: color 0.2s ease;
        }
        .nav-item.active {
            color: var(--accent-teal);
            font-weight: 700;
        }
        .nav-item.active i {
            color: var(--accent-teal);
        }
        .nav-item:hover {
            color: var(--accent-teal);
        }
        .nav-item:active {
            transform: scale(0.95);
        }

        /* --- Popup Styles --- */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .popup-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .name-popup {
            background-color: #222222;
            padding: 40px;
            border-radius: var(--border-radius-main);
            box-shadow: var(--shadow-popup);
            text-align: center;
            width: 90%;
            max-width: 420px;
            position: relative;
            color: #333;
            transform: translateY(20px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .popup-overlay.active .name-popup {
            transform: translateY(0);
            opacity: 1;
        }

        .name-popup h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2em;
            color: var(--text-dark);
            margin-bottom: 25px;
            font-weight: 700;
            transition: color 0.3s ease;
        }

        .name-popup p {
            font-size: 1.1em;
            color: var(--text-light);
            margin-bottom: 30px;
            transition: color 0.3s ease;
        }

        .name-popup .input-container {
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-input);
            padding: 12px 18px;
            margin-bottom: 25px;
            position: relative;
            background-color: #383838;
            transition: border-color 0.2s ease, background-color 0.3s ease;
        }

        .name-popup .input-container:focus-within {
            border-color: var(--accent-teal);
        }

        .name-popup input[type="text"] {
            width: 100%;
            padding: 10px 0;
            padding-top: 20px;
            border: none;
            background: transparent;
            font-family: 'Open Sans', sans-serif;
            font-size: 1.2em;
            color: var(--text-dark);
            outline: none;
            transition: color 0.3s ease;
        }

         .name-popup input[type="text"]:focus + label,
         .name-popup input[type="text"]:not(:placeholder-shown) + label {
            top: 5px;
            font-size: 0.7em;
            color: var(--accent-teal);
        }

        .name-popup .char-count {
            font-size: 0.85em;
            color: var(--text-light);
            text-align: right;
            margin-top: -15px;
            margin-bottom: 25px;
            transition: color 0.3s ease;
        }

        .name-popup .role-selection {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            font-family: 'Open Sans', sans-serif;
        }

        .name-popup .role-option {
            display: flex;
            align-items: center;
            background-color: #444;
            padding: 8px 15px;
            border-radius: var(--border-radius-button);
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.3s ease;
            font-size: 0.9em;
            color: var(--text-light);
        }

        .name-popup .role-option:hover {
            background-color: #555;
        }

        .name-popup input[type="radio"] {
            margin-right: 8px;
            accent-color: var(--accent-teal);
        }

        .name-popup button {
            background-color: var(--accent-teal);
            color: white;
            padding: 15px 35px;
            border: none;
            border-radius: var(--border-radius-button);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease, color 0.3s ease;
            box-shadow: var(--shadow-light);
        }

        .name-popup button:hover {
            background-color: #00939b;
            transform: translateY(-3px);
        }

        .popup-close-button {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 2em;
            color: var(--text-light);
            cursor: pointer;
            transition: color 0.2s ease;
        }

        .popup-close-button:hover {
            color: var(--text-dark);
        }

        .comments-popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .comments-popup-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .comments-popup {
            background-color: #222222;
            padding: 25px;
            border-radius: var(--border-radius-main);
            box-shadow: var(--shadow-popup);
            width: 90%;
            max-width: 500px;
            position: relative;
            color: #333;
            transform: translateY(20px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .comments-popup-overlay.active .comments-popup {
            transform: translateY(0);
            opacity: 1;
        }

        .comments-popup h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8em;
            color: var(--text-dark);
            margin-top: 0;
            margin-bottom: 20px;
            text-align: center;
            transition: color 0.3s ease;
        }

        .comments-input-area {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .comments-input-area textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-input);
            font-family: 'Open Sans', sans-serif;
            font-size: 1em;
            min-height: 80px;
            resize: vertical;
            outline: none;
            transition: border-color 0.2s ease, background-color 0.3s ease, color 0.3s ease;
            background-color: #383838;
            color: var(--text-dark);
        }

        .comments-input-area button {
            background-color: var(--comments-btn-bg);
            color: var(--white);
            border: none;
            border-radius: var(--border-radius-button);
            padding: 10px 15px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.3s ease;
        }

        .comments-input-area button:hover {
            background-color: #0056b3;
        }

        .comments-display-area {
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 10px;
            margin-bottom: 10px;
        }

        .comment-item {
            background-color: #383838;
            border-radius: var(--border-radius-input);
            padding: 10px;
            margin-bottom: 10px;
            font-size: 0.9em;
            border: 1px solid #555;
            color: var(--text-dark);
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }

        .comment-item strong {
            color: var(--primary-dark);
            margin-right: 5px;
            transition: color 0.3s ease;
        }

        .no-comments-message {
            text-align: center;
            color: var(--text-light);
            font-style: italic;
            transition: color 0.3s ease;
        }

        .coming-soon-section {
            display: none;
            text-align: center;
            padding: 50px 20px;
            background-color: #333333;
            border-radius: var(--border-radius-main);
            box-shadow: var(--shadow-medium);
            margin-top: 30px;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 300px;
            border: 1px solid var(--border-color);
            color: var(--text-dark);
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .coming-soon-section h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.5em;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 20px;
            transition: color 0.3s ease;
        }

        .coming-soon-section p {
            font-size: 1.3em;
            color: var(--text-light);
            margin-bottom: 30px;
            line-height: 1.5;
            transition: color 0.3s ease;
        }

        .coming-soon-section .emoji {
            font-size: 3em;
            margin-top: 20px;
            animation: bounce 1s infinite alternate;
        }

        @keyframes bounce {
            0% { transform: translateY(0); }
            100% { transform: translateY(-10px); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.08); }
            100% { transform: scale(1); }
        }

        @keyframes fadeInSlideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        body.animate-in {
            animation: fadeInSlideUp 0.8s ease-out forwards;
        }

        @keyframes popupEnter {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(50px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        .popup-overlay.active .name-popup {
            animation: popupEnter 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .hidden-on-scroll {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }

        .visible-on-scroll {
            opacity: 1;
            transform: translateY(0);
        }

        .offline-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 3000;
            color: white;
            font-size: 1.5em;
            text-align: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .offline-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .offline-overlay i {
            font-size: 3em;
            margin-bottom: 20px;
            color: #FFC107;
        }

        .offline-overlay p {
            margin: 0;
            padding: 0 20px;
        }

        .offline-overlay .reload-button {
            background-color: var(--accent-teal);
            color: var(--white);
            border: none;
            border-radius: var(--border-radius-button);
            padding: 10px 20px;
            margin-top: 20px;
            cursor: pointer;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            transition: background-color 0.2s ease;
        }

        .offline-overlay .reload-button:hover {
            background-color: #00939b;
        }

        #about-me-view {
            display: none;
            flex-direction: column;
            padding: 20px;
            min-height: calc(100vh - 90px);
            background-color: var(--secondary-light);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        #about-me-view .section-header {
            display: flex;
            align-items: center;
            width: 100%;
            margin-bottom: 25px;
        }

        #about-me-view .back-button {
            background-color: transparent;
            border: none;
            font-size: 2em;
            color: var(--text-dark);
            cursor: pointer;
            margin-right: 18px;
            transition: color 0.2s ease, transform 0.2s ease;
        }

        #about-me-view .back-button:hover {
            color: var(--accent-teal);
            transform: translateX(-5px);
        }

        #about-me-view h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.2em;
            font-weight: 700;
            color: var(--text-dark);
            margin: 0;
            flex-grow: 1;
            transition: color 0.3s ease;
        }

        .about-me-card {
            background-color: #333333;
            border-radius: var(--border-radius-main);
            box-shadow: var(--shadow-medium);
            padding: 30px;
            width: 100%;
            max-width: 500px;
            margin-top: 20px;
            border: 1px solid var(--border-color);
            transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .about-me-card .profile-pic {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 20px;
            border: 4px solid var(--accent-teal);
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }

        .about-me-card h3 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8em;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 10px;
            transition: color 0.3s ease;
        }

        .about-me-card p {
            font-size: 1.1em;
            color: var(--text-light);
            margin-bottom: 25px;
            line-height: 1.6;
            transition: color 0.3s ease;
        }

        .social-links {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 20px;
        }

        .social-link.telegram:hover { color: #0088cc; }

        .social-link.instagram:hover {
            background: radial-gradient(circle at 30% 107%, #fdf497 0%, #fdf497 5%, #fd5949 45%, #d6249f 60%, #285AEB 90%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .social-link.youtube:hover { color: #FF0000; }

        #how-to-use-app-view {
            display: none;
            flex-direction: column;
            padding: 20px;
            min-height: calc(100vh - 90px);
            background-color: var(--secondary-light);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        #how-to-use-app-view .section-header {
            display: flex;
            align-items: center;
            width: 100%;
            margin-bottom: 25px;
        }

        #how-to-use-app-view .back-button {
            background-color: transparent;
            border: none;
            font-size: 2em;
            color: var(--text-dark);
            cursor: pointer;
            margin-right: 18px;
            transition: color 0.2s ease, transform 0.2s ease;
        }

        #how-to-use-app-view .back-button:hover {
            color: var(--accent-teal);
            transform: translateX(-5px);
        }

        #how-to-use-app-view h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.2em;
            font-weight: 700;
            color: var(--text-dark);
            margin: 0;
            flex-grow: 1;
            transition: color 0.3s ease;
        }

        #how-to-use-app-view .video-container {
            position: relative;
            width: 100%;
            padding-top: 56.25%;
            background-color: #000;
            border-radius: var(--border-radius-card);
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: var(--shadow-medium);
        }

        #how-to-use-app-view .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        #how-to-use-app-view p {
            font-size: 1.1em;
            color: var(--text-light);
            line-height: 1.6;
            margin-top: 0;
            transition: color 0.3s ease;
        }
        
        .share-app-button {
            background-color: #007bff;
            color: var(--white);
            padding: 15px 25px;
            border-radius: var(--border-radius-button);
            text-align: center;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease, color 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: var(--shadow-medium);
            margin-top: 30px;
            margin-bottom: 30px;
        }

        .share-app-button:hover {
            background-color: #0056b3;
            transform: translateY(-3px);
        }

        .share-app-button i {
            font-size: 1.5em;
        }

        @media (max-width: 768px) {
            .top-navbar { padding: 12px 15px; }
            .top-navbar .app-logo .main-title { font-size: 1.3em; }
            .top-navbar .app-logo .tagline { font-size: 0.6em; }
            .top-navbar .app-logo img#skillNeastLogo { height: 30px; }
            .top-navbar .menu-icon, .top-navbar .telegram-icon {
                width: 44px;
                height: 44px;
                font-size: 1.6em;
            }
            .top-navbar .menu-icon { margin-right: 5px; }
            .top-navbar .telegram-icon { margin-left: 5px; }
            .top-navbar .app-logo {
                padding: 5px 10px;
                margin: 0 5px;
            }


            .welcome-banner { padding: 20px; }
            .welcome-banner .greeting { font-size: 1.4em; }
            .welcome-banner .fire-icon { font-size: 1.8em; }
            .quote-section { padding: 20px; }
            .quote-section .quote-text { font-size: 0.95em; }
            #home-view { gap: 20px; }
            .course-category-item { min-height: 160px; }
            .course-category-item .image-container img { padding: 5px; }
            .course-category-item .content-overlay { padding: 10px; }
            .course-category-item .category-name { font-size: 0.95em;}

            .quote-section {
                padding: 20px;
            }
            .quote-section .quote-text {
                font-size: 1.1em;
            }
            .quote-section .quote-author {
                font-size: 0.95em;
            }
        }

        .slider-menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1500;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease;
        }

        .slider-menu-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .slider-menu {
            position: fixed;
            top: 0;
            left: -250px;
            width: 250px;
            height: 100%;
            background-color: var(--slider-bg);
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.5);
            z-index: 1600;
            transition: left 0.3s ease-in-out, background-color 0.3s ease;
            display: flex;
            flex-direction: column;
            padding-top: 20px;
            box-sizing: border-box;
            overflow-y: auto;
            padding-bottom: 20px;
        }

        .slider-menu.active {
            left: 0;
        }

        .slider-header {
            padding: 20px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid var(--slider-border-color);
            margin-bottom: 10px;
            font-family: 'Comfortaa', sans-serif;
            transition: border-color 0.3s ease;
        }

        .slider-header img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 15px;
            object-fit: cover;
            border: 2px solid var(--accent-teal);
            box-shadow: 0 0 8px rgba(0, 173, 181, 0.3);
        }

        .slider-header h3 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5em;
            font-weight: 700;
            color: var(--accent-teal);
            margin: 0;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
            transition: color 0.3s ease;
        }

        .slider-menu-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            color: var(--slider-text-color);
            text-decoration: none;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.05em;
            transition: background-color 0.2s ease, transform 0.2s ease, color 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .slider-menu-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 173, 181, 0.1), transparent);
            transition: left 0.3s ease-out;
        }

        .slider-menu-item:hover::before {
            left: 0;
        }

        .slider-menu-item:hover {
            background-color: var(--slider-item-hover);
            transform: translateX(5px);
        }

        .slider-menu-item i {
            font-size: 1.6em;
            margin-right: 15px;
            color: var(--slider-icon-color);
            transition: color 0.2s ease;
        }

        .slider-menu-item:hover i {
            color: var(--highlight-gold);
        }

        .slider-menu-item .item-text {
            flex-grow: 1;
            font-weight: 500;
        }

        .slider-menu-item .coming-soon-tag {
            background-color: #FFC107;
            color: #333;
            font-size: 0.7em;
            font-weight: 700;
            padding: 3px 8px;
            border-radius: 10px;
            margin-left: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .slider-footer {
            margin-top: auto;
            padding: 15px 20px;
            text-align: center;
            border-top: 1px solid var(--slider-border-color);
            font-size: 0.85em;
            color: var(--text-light);
            font-family: 'Open Sans', sans-serif;
            line-height: 1.5;
            transition: border-color 0.3s ease, color 0.3s ease;
        }

        .slider-footer .version {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--text-dark);
            font-size: 0.9em;
            transition: color 0.3s ease;
        }
        
        /* Dark Mode toggle styles are removed as per request */

        /* Request Courses View Styles */
        #request-courses-view {
            display: none; /* Controlled by JS */
            padding: 0px;
        }
        #request-courses-view .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
        }
        #request-courses-view .back-button {
            background-color: transparent;
            border: none;
            font-size: 2em;
            color: var(--text-dark);
            cursor: pointer;
            margin-right: 18px;
            transition: color 0.2s ease, transform 0.2s ease;
        }
        #request-courses-view .back-button:hover {
            color: var(--accent-teal);
            transform: translateX(-5px);
        }
        #request-courses-view h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.2em;
            font-weight: 700;
            color: var(--text-dark);
            margin: 0;
            flex-grow: 1;
            transition: color 0.3s ease;
        }

        .request-posts-grid {
            display: grid;
            grid-template-columns: 1fr; /* Single column for mobile */
            gap: 20px;
            padding: 0px;
        }

        .request-post-card {
            background-color: var(--primary-dark); /* Darker background for contrast */
            border-radius: var(--border-radius-card);
            box-shadow: var(--shadow-light);
            overflow: hidden;
            border: 1px solid var(--border-color);
            transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.3s ease, border-color 0.3s ease;
            position: relative; /* For the new tag */
        }
        .request-post-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-medium);
            border-color: var(--accent-teal); /* Highlight on hover */
        }
        .request-post-card .post-image-container {
            width: 100%;
            height: 200px; /* Fixed height for images */
            overflow: hidden;
            background-color: #000; /* Black background if no image */
            display: flex;
            align-items: center;
            justify-content: center;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer; /* Make image clickable for fullscreen */
        }
        .request-post-card .post-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Cover the area, crop if needed */
        }
        .request-post-card .post-content {
            padding: 20px;
        }
        .request-post-card .post-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.4em;
            font-weight: 700;
            color: var(--highlight-gold); /* Gold for titles */
            margin-bottom: 10px;
        }
        .request-post-card .post-description {
            font-size: 0.95em;
            color: var(--text-light);
            margin-bottom: 15px;
            line-height: 1.5;
            text-align: justify;
        }
        .request-post-card .post-button {
            background-color: var(--accent-teal);
            color: var(--white);
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            font-family: 'Montserrat', sans-serif;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
            width: 100%; /* Make button full width */
        }
        .request-post-card .post-button:hover {
            background-color: #00939b;
            transform: translateY(-2px);
        }
        .request-post-card .post-reactions {
            display: flex;
            justify-content: space-around;
            gap: 10px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }
        .request-post-card .reaction-icon-post {
            font-size: 1.2em;
            cursor: pointer;
            padding: 5px 8px;
            border-radius: 5px;
            transition: background-color 0.2s ease;
            user-select: none;
            display: flex;
            align-items: center;
            color: var(--text-light);
        }
        .request-post-card .reaction-icon-post span {
            font-size: 0.8em;
            margin-left: 5px;
            color: var(--text-light);
        }
        .request-post-card .reaction-icon-post:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        .request-post-card .reaction-icon-post.reacted {
            background-color: rgba(0, 173, 181, 0.2);
            color: var(--accent-teal);
        }
        .request-post-card .reaction-emoji {
            font-size: 1.5em;
            line-height: 1;
        }
        .request-post-card .new-post-tag {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #FFC107; /* Orange/Gold */
            color: #333;
            font-size: 0.7em;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 5px;
            text-transform: uppercase;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 3;
        }

        /* Responsive adjustments for request posts */
        @media (min-width: 601px) {
            .request-posts-grid {
                grid-template-columns: repeat(2, 1fr); /* Two columns for larger screens */
            }
        }
        @media (min-width: 992px) {
            .request-posts-grid {
                grid-template-columns: repeat(3, 1fr); /* Three columns for even larger screens */
            }
        }
    </style>
</head>
<body>

    <div class="offline-overlay" id="offlineOverlay">
        <i class="fas fa-wifi"></i>
        <p>No Internet Connection 😕</p>
        <button class="reload-button" onclick="location.reload()">Retry 🔁</button>
    </div>

    <div class="fullscreen-image-overlay" id="fullscreenImageOverlay">
        <button class="fullscreen-image-close-button" onclick="window.closeFullscreenImage()">×</button>
        <img src="" alt="Full Screen Image" id="fullscreenImage">
    </div>

    <div class="global-notice-overlay" id="globalNoticeOverlay">
        <div class="global-notice-popup">
            <button class="global-notice-close-button" onclick="window.closeGlobalNoticePopup()">×</button>
            <div class="action-required-header">
                <i class="fas fa-exclamation-triangle"></i> ACTION REQUIRED!!! <i class="fas fa-exclamation-triangle"></i>
            </div>
            <p id="globalNoticeMessage"></p>
            <button class="join-button" id="globalNoticeJoinButton"></button>

            <div class="notice-reaction-container">
                <span class="reaction-icon-notice" data-reaction="❤️"><span class="reaction-emoji">❤️</span> <span class="count">0</span></span>
                <span class="reaction-icon-notice" data-reaction="😂"><span class="reaction-emoji">😂</span> <span class="count">0</span></span>
                <span class="reaction-icon-notice" data-reaction="👍"><span class="reaction-emoji">👍</span> <span class="count">0</span></span>
            </div>
        </div>
    </div>
    <div class="popup-overlay" id="namePopupOverlay">
        <div class="name-popup">
            <button class="popup-close-button" onclick="window.closeNamePopup()">×</button>
            <h2>Welcome to SkillNeast!</h2>
            <p>Please tell us your name and what you do to personalize your experience.</p>
            <div class="input-container">
                <label for="userNameInput" style="position: absolute; top: 12px; left: 18px; font-size: 0.9em; color: var(--text-light); transition: all 0.2s ease;">Enter Your Name</label>
                <input type="text" id="userNameInput" placeholder=" " maxlength="15" onkeyup="window.updateCharCount()">
            </div>
            <div class="char-count"><span id="currentCharCount">0</span>/15</div>
            <div class="role-selection">
                <label class="role-option"><input type="radio" name="userRole" value="Editor"> Editor ✂️</label>
                <label class="role-option"><input type="radio" name="userRole" value="Programmer"> Programmer 💻</label>
                <label class="role-option"><input type="radio" name="userRole" value="Content Creator"> Content Creator 🎬</label>
                <label class="role-option"><input type="radio" name="userRole" value="Music Artist"> Music Artist 🎶</label>
                <label class="role-option"><input type="radio" name="userRole" value="Other" checked> Other ✨</label>
            </div>
            <button onclick="window.submitName()">START LEARNING</button>
        </div>
    </div>

    <div class="comments-popup-overlay" id="commentsPopupOverlay" style="display: none;"> 
        <div class="comments-popup">
            <button class="popup-close-button" onclick="window.closeCommentsPopup()">×</button>
            <h2 id="commentsHeader">SR Comments</h2>
            <div class="comments-input-area">
                <textarea id="commentInput" placeholder="Write your comment here..."></textarea>
                <button onclick="window.postComment()">Post Comment</button>
            </div>
            <div class="comments-display-area" id="commentsDisplayArea">
                <p class="no-comments-message">No comments yet. Be the first to comment!</p>
            </div>
        </div>
    </div>


    <div class="top-navbar">
        <div class="menu-icon" id="menuIcon"><i class="fas fa-bars"></i></div>
        <div class="app-logo" id="appLogo">
            <img src="" alt="SkillNeast Logo" draggable="false" id="skillNeastLogo" onerror="this.onerror=null;this.src='https://via.placeholder.com/40x40/00ADB5/ffffff?text=SN';">
            <div class="text-wrapper">
                <span class="main-title">SKILLNEAST</span>
                <span class="tagline">Master New Skill 🚀💡</span>
            </div>
        </div>
        <div class="telegram-icon" onclick="window.open(window.siteConfig.telegramGroupLink || 'https://t.me/', '_blank');"><i class="fab fa-telegram-plane"></i></div>
    </div>

    <div class="main-content">

        <div class="welcome-banner">
            <span class="greeting"><i class="fas fa-heart"></i> Welcome <span id="displayedUserName">Guest</span></span>
            <span class="fire-icon"><i class="fas fa-fire"></i></span>
            <span class="role-sticker" id="displayedUserRole" style="display: none;"></span>
        </div>

        <div class="quote-section">
            <p class="quote-text" id="quoteText"></p>
            <p class="quote-author" id="quoteAuthor"></p>
        </div>

        <div class="telegram-channels-banner" id="telegramChannelsBanner">
            <div class="banner-title">
                <i class="fas fa-exclamation-triangle"></i> WE NEED <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h2 id="telegramBannerMainTitle">JOIN OUR OFFICIAL <br> TELEGRAM CHANNELS</h2>
            <div class="channel-list" id="telegramBannerChannelList">
            </div>
            <button class="click-here-button" id="telegramBannerButton">
                CLICK HERE! <i class="fas fa-arrow-right"></i>
            </button>
            <div class="your-support-text" id="telegramBannerSupportText">YOUR SUPPORT !!</div>
        </div>

        <div class="discover-notice" id="discoverNotice">
            <h4 class="text-center" id="discoverNoticeHeader">🙏 Namo Buddhaya Everyone 🙏</h4>
            <img src="" alt="Discover Notice Image" class="discover-image" id="discoverNoticeImage" style="display: none;"> <h4 id="discoverNoticeMainTitle">DISCOVER OUR APP'S DELIGHTS!</h4>
            <ol id="discoverNoticePoints">
            </ol>
            <div class="discover-notice-reactions">
                <span class="reaction-icon-discover" data-reaction="❤️"><span class="reaction-emoji">❤️</span> <span class="count">0</span></span>
                <span class="reaction-icon-discover" data-reaction="😂"><span class="reaction-emoji">😂</span> <span class="count">0</span></span>
                <span class="reaction-icon-discover" data-reaction="👍"><span class="reaction-emoji">👍</span> <span class="count">0</span></span>
                <span class="reaction-icon-discover" data-reaction="🌟"><span class="reaction-emoji">🌟</span> <span class="count">0</span></span>
            </div>
        </div>

        <div id="home-view">
            <div id="dynamic-categories-container">
                <p class="text-center text-muted col-span-full" id="loadingCategoriesMessage">Loading categories...</p>
            </div>

            <div class="favorites-section-home-card" onclick="window.showFavoritesView()" id="favorites-section-home-card">
                <i class="fas fa-heart fav-icon"></i>
                <h2>My Favorite Batches</h2>
                <p>
                    <span style="font-weight: bold; color: var(--highlight-gold);">@skillneast_official @skillneast_updates</span><br>
                    Disclaimer: We believe learning is for everyone, always! Enjoy incredible insights and master skills with our amazing content—grab yours before it's too late! 🎉
                </p>
                <span class="fav-count" id="favorites-count">0 Batches</span>
            </div>
            
            <button class="surprise-button" onclick="window.openTodaySurpriseLink()">
                <i class="fas fa-gift"></i> Today's Surprise! 🎉
            </button>

            <div class="telegram-card" onclick="window.open(window.siteConfig.telegramGroupLink || 'https://t.me/', '_blank');">
                <i class="fab fa-telegram-plane telegram-icon-large"></i>
                <span class="telegram-text">Join Our Telegram Community!</span>
            </div>
            
            <button class="share-app-button" onclick="window.shareApp()">
                <i class="fas fa-share-alt"></i> Share with your Friends
            </button>
        </div>

        <div id="new-batches-view" style="display: none;">
            <div class="section-header">
                <button class="back-button" onclick="window.showHomeView()"><i class="fas fa-arrow-left"></i></button>
                <h2 id="new-batches-title">All Courses</h2>
            </div>
            <div class="search-bar-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" id="batchSearchInput" placeholder="Search by batch name" onkeyup="window.filterBatches()">
                <button class="search-button" onclick="window.filterBatches()">Search</button>
            </div>
            <div class="batch-list" id="batches-container">
                <p class="text-center text-muted" id="loadingBatchesMessage">Loading batches...</p>
            </div>
        </div>

        <div id="favorites-view" style="display: none;">
            <div class="section-header">
                <button class="back-button" onclick="window.showHomeView()"><i class="fas fa-arrow-left"></i></button>
                <h2>Favourite Batches</h2>
            </div>
            <div class="batch-list" id="favorite-batches-container">
            </div>
            <p id="no-favorites-message-view" class="no-favorites-message-view" style="display: none;">You haven't favorited any batches yet. Click the heart icon on any batch to add it here!</p>
        </div>

        <div id="sections-view" style="display: none;">
            <div class="section-header">
                <button class="back-button" onclick="window.showNewBatchesView(window.lastCategoryViewed)"><i class="fas fa-arrow-left"></i></button>
                <h2 id="sections-title"></h2>
            </div>
            <div class="sections-container" id="sections-container">
            </div>
        </div>

        <div id="lessons-in-sections-view" style="display: none;">
            <div class="section-header">
                <button class="back-button" onclick="window.goBackFromLessonsList()"><i class="fas fa-arrow-left"></i></button>
                <h2 id="lessons-in-sections-title"></h2>
            </div>
            <div class="lesson-list-container" id="lessons-in-sections-container">
            </div>
        </div>

        <div id="video-player-view" style="display: none;">
            <div class="section-header">
                <button class="back-button" onclick="window.goBackFromPlayerView()"><i class="fas fa-arrow-left"></i></button>
                <h2 id="player-view-title"></h2>
                <div class="player-card-header-actions">
                    <button class="icon-button like-button" id="likeButton"><i class="fas fa-heart"></i><span class="like-count-display" id="likeCountDisplay">0</span></button>
                    <button class="icon-button" id="fullscreenButton" onclick="window.toggleFullScreen()"><i class="fas fa-expand"></i></button>
                </div>
            </div>
            <div class="player-card-container">
                <div class="player-card">
                    <div class="main-video-player" id="main-video-player">
                    </div>
                    <div class="player-metadata">
                        <h3 class="lesson-sub-title" id="player-lesson-sub-title"></h3>
                    </div>
                </div>
            </div>

            <div class="player-action-buttons">
                <button class="action-button timeline" onclick="window.showComingSoonView('timeline')"><i class="fas fa-stream"></i> Timeline</button>
                <button class="action-button comments" onclick="window.showComingSoonView('comments-coming-soon')"><i class="fas fa-comments"></i> SR Comments</button>
                <button class="action-button watch-later" onclick="window.showComingSoonView('watch-later')"><i class="fas fa-bookmark"></i> Watch Later</button>
            </div>
            
            <ul class="lesson-list" id="lessons-for-player-batch">
            </ul>
        </div>

        <div id="timeline-coming-soon-view" class="coming-soon-section" style="display: none;">
            <div class="section-header">
                <button class="back-button" onclick="window.goBackFromPlayerView()"><i class="fas fa-arrow-left"></i></button>
                <h2>Timeline Coming Soon!</h2>
            </div>
            <i class="emoji">⏳</i>
            <p>We're building advanced timeline features to help you navigate lectures seamlessly. Stay tuned! 🚀</p>
        </div>
        <div id="watch-later-coming-soon-view" class="coming-soon-section" style="display: none;">
            <div class="section-header">
                <button class="back-button" onclick="window.goBackFromPlayerView()"><i class="fas fa-arrow-left"></i></button>
                <h2>Watch Later Coming Soon!</h2>
            </div>
            <i class="emoji">⏰</i>
            <p>Save lectures to watch later and organize your study schedule. This feature is in the works! ✨</p>
        </div>
        
        <div id="comments-coming-soon-view" class="coming-soon-section" style="display: none;">
            <div class="section-header">
                <button class="back-button" onclick="window.goBackFromPlayerView()"><i class="fas fa-arrow-left"></i></button>
                <h2>Comments Section Coming Soon!</h2>
            </div>
            <i class="emoji">💬</i>
            <p>We're working on an interactive comments feature to enhance your learning experience. Stay tuned! ✨</p>
        </div>

        <div id="bundles-coming-soon-view" class="coming-soon-section" style="display: none;">
            <div class="section-header">
                <button class="back-button" onclick="window.showHomeView()"><i class="fas fa-arrow-left"></i></button>
                <h2>Bundles Coming Soon!</h2>
            </div>
            <i class="emoji">🎁</i>
            <p>Exciting new course bundles are on their way. Stay tuned for amazing deals and curated learning paths!</p>
        </div>

        <div id="pdfs-coming-soon-view" class="coming-soon-section" style="display: none;">
            <div class="section-header">
                <button class="back-button" onclick="window.showHomeView()"><i class="fas fa-arrow-left"></i></button>
                <h2>PDFs Coming Soon!</h2>
            </div>
            <i class="emoji">📄</i>
            <p>We're preparing a comprehensive library of downloadable PDFs and study materials for you. Check back soon!</p>
        </div>

        <div id="ai-chatbot-coming-soon-view" class="coming-soon-section" style="display: none;">
            <div class="section-header">
                <button class="back-button" onclick="window.showHomeView()"><i class="fas fa-arrow-left"></i></button>
                <h2>Neast Bro (AI Chatbot) Coming Soon!</h2>
            </div>
            <i class="emoji">🤖</i>
            <p>Get ready for personalized assistance! Our AI Chatbot, Neast Bro, is under development to help you with your learning journey. Stay tuned for its launch! 🚀</p>
        </div>

        <div id="about-me-view" style="display: none;">
            <div class="section-header">
                <button class="back-button" onclick="window.showHomeView()"><i class="fas fa-arrow-left"></i></button>
                <h2>About Me</h2>
            </div>
            <div class="about-me-card">
                <img src="" alt="Fahad Profile" class="profile-pic" draggable="false" id="aboutMeProfilePic" onerror="this.onerror=null;this.src='https://via.placeholder.com/120x120/00ADB5/ffffff?text=Fahad';">
                <h3>Hello, I'm Fahad! 👋</h3>
                <p>I'm 16 years old and currently learning in Class 11 with PCM (Physics, Chemistry, Maths) stream. Skills abhi kuch nahi hain, but har roz kuch naya seekh raha hoon! Learning is my journey. 😊</p>
                <div class="social-links">
                    <a href="" target="_blank" class="social-link telegram" id="aboutMeTelegramGroupLink"><i class="fab fa-telegram-plane"></i></a>
                    <a href="" target="_blank" class="social-link instagram" id="aboutMeInstagramLink"><i class="fab fa-instagram"></i></a>
                    <a href="" target="_blank" class="social-link youtube" id="aboutMeYoutubeLink"><i class="fab fa-youtube"></i></a>
                </div>
            </div>
        </div>

        <div id="how-to-use-app-view" style="display: none;">
            <div class="section-header">
                <button class="back-button" onclick="window.showHomeView()"><i class="fas fa-arrow-left"></i></button>
                <h2>How to use the App</h2>
            </div>
            <div class="video-container">
            </div>
            <p>
            </p>
            <p>If you have any further questions, feel free to reach out to us through the Telegram community link in the menu!</p>
        </div>

        <div id="request-courses-view" style="display: none;">
            <div class="section-header">
                <button class="back-button" onclick="window.showHomeView()"><i class="fas fa-arrow-left"></i></button>
                <h2>Community Requests <i class="fas fa-hand-paper"></i></h2>
            </div>
            <div id="request-posts-container" class="request-posts-grid">
                <p class="text-center text-muted col-span-full" id="loadingRequestPostsMessage">Loading community requests...</p>
            </div>
        </div>
        </div> 
  
    <div class="bottom-navbar">
        <a href="#" class="nav-item" id="courses-nav" onclick="window.showNewBatchesView('all'); window.highlightBottomNav('courses-nav')"><i class="fas fa-book-open"></i> Courses</a>
        <a href="#" class="nav-item" id="bundles-nav" onclick="window.showComingSoonView('bundles'); window.highlightBottomNav('bundles-nav');"><i class="fas fa-boxes"></i> Bundles</a>
        <a href="#" class="nav-item active" id="home-nav" onclick="window.showHomeView(); window.highlightBottomNav('home-nav')"><i class="fas fa-home"></i> Home</a>
        <a href="#" class="nav-item" id="pdfs-nav" onclick="window.showComingSoonView('pdfs'); window.highlightBottomNav('pdfs-nav');"><i class="fas fa-file-pdf"></i> PDFs</a>
        <a href="#" class="nav-item" id="about-me-nav" onclick="window.showAboutMeView(); window.highlightBottomNav('about-me-nav');"><i class="fas fa-user-circle"></i> About Me</a>
    </div>

    <div class="slider-menu-overlay" id="sliderMenuOverlay" onclick="window.closeSliderMenu()"></div>
    <div class="slider-menu" id="sliderMenu">
        <div class="slider-header">
            <img src="" alt="SkillNeast Logo" id="sliderHeaderLogo" onerror="this.onerror=null;this.src='https://via.placeholder.com/50x50/00ADB5/ffffff?text=SN';">
            <h3>SkillNeast</h3>
        </div>
        
        <a href="#" class="slider-menu-item" onclick="window.showComingSoonView('ai-chatbot'); window.closeSliderMenu();">
            <i class="fas fa-robot"></i> <span class="item-text">Neast Bro (AI Chatbot)</span> <span class="coming-soon-tag">Coming Soon</span>
        </a>
        <a href="#" class="slider-menu-item" onclick="window.showAboutMeView(); window.closeSliderMenu();">
            <i class="fas fa-user-circle"></i> <span class="item-text">About Me</span>
        </a>
        <a href="#" class="slider-menu-item" onclick="window.showFavoritesView(); window.closeSliderMenu();">
            <i class="fas fa-heart"></i> <span class="item-text">Favorite Batches</span>
        </a>
        <a href="" target="_blank" class="slider-menu-item" id="sliderTelegramChannelLink">
            <i class="fab fa-telegram-plane"></i> <span class="item-text">Join Telegram Channel</span>
        </a>
        <a href="" target="_blank" class="slider-menu-item" id="sliderTelegramGroupLink">
            <i class="fab fa-telegram-plane"></i> <span class="item-text">Join Telegram Group</span>
        </a>
        <a href="#" class="slider-menu-item" id="sliderRequestCoursesLink" onclick="window.showRequestCoursesView(); window.closeSliderMenu();">
            <i class="fas fa-hand-paper"></i> <span class="item-text">Request Courses</span>
        </a>
        <a href="#" class="slider-menu-item" onclick="window.showHowToUseAppView(); window.closeSliderMenu();">
            <i class="fas fa-question-circle"></i> <span class="item-text">How to use the App</span>
        </a>
        <a href="#" class="slider-menu-item" onclick="window.shareApp(); window.closeSliderMenu();">
            <i class="fas fa-share-alt"></i> <span class="item-text">Share with your Friends</span>
        </a>

        <div class="slider-footer">
            <div class="version">App Version: v1.0.0 (G.O.A.T)</div>
            Made with ❤️ in INDIA 🇮🇳
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
        import { getDatabase, ref as dbRef, onValue, push, set, serverTimestamp, update } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
        import { getFirestore, collection, query, where, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";
        const firebaseConfig = {
          apiKey: "AIzaSyChwpbFb6M4HtG6zwjg0AXh7Lz9KjnrGZk",
          authDomain: "adminneast.firebaseapp.com",
          databaseURL: "https://adminneast-default-rtdb.firebaseio.com",
          projectId: "adminneast",
          storageBucket: "adminneast.appspot.com", 
          messagingSenderId: "883877553418",
          appId: "1:883877553418:web:84ce8200f4b471bfffc6f3",
          measurementId: "G-PCH99BDF1S"
        };
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const app = initializeApp(firebaseConfig);
        const rtdb = getDatabase(app);
        const auth = getAuth(app);
        const firestore = getFirestore(app);

        let isAuthenticated = false;
        let currentUserId = null;
        window.userLikes = JSON.parse(localStorage.getItem('userLikes')) || [];
        window.userNoticeReactions = JSON.parse(localStorage.getItem('userNoticeReactions')) || {};
        window.userDiscoverNoticeReactions = JSON.parse(localStorage.getItem('userDiscoverNoticeReactions')) || {};
        window.userRequestReactions = JSON.parse(localStorage.getItem('userRequestReactions')) || {}; 
        const likesRef = dbRef(rtdb, 'likes');
        const globalNoticeRef = dbRef(rtdb, 'notices/globalNotice');
        const discoverNoticeReactionsRef = dbRef(rtdb, 'notices/discoverNoticeReactions');
        const requestCoursesRef = dbRef(rtdb, 'requestCourses'); 
        window.siteConfig = {
            telegramChannelLink: 'https://t.me/default_channel',
            telegramGroupLink: 'https://t.me/default_group',
            youtubeLink: 'https://youtube.com/default_channel',
            instagramLink: 'https://instagram.com/default_profile',
            requestCoursesLink: '#',
            profilePictureUrl: 'https://via.placeholder.com/120x120/00ADB5/ffffff?text=Fahad',
            skillNeastLogoUrl: 'https://via.placeholder.com/40x40/00ADB5/ffffff?text=SN',
            sliderHeaderPictureUrl: 'https://via.placeholder.com/50x50/00ADB5/ffffff?text=SN',
            pwLogoUrl: 'https://via.placeholder.com/50x50/000000/ffffff?text=PW',
            surpriseButtonLink: '#',
            telegramBannerVisible: true, 
            telegramBannerTitle: 'JOIN OUR OFFICIAL <br> TELEGRAM CHANNELS',
            telegramBannerChannelList: '• Study Ratna ✨|• RATNA Official 📣|• Anime Speaks 🐉|• Code with RATNA 💻',
            telegramBannerButtonText: 'CLICK HERE!',
            telegramBannerButtonLink: 'https://t.me/default_group',
            telegramBannerSupportText: 'YOUR SUPPORT !!',
            
            discoverNoticeVisible: true, 
            discoverNoticeHeaderEmoji: '🙏',
            discoverNoticeTitle: 'DISCOVER OUR APP\'S DELIGHTS!',
            discoverNoticePoints: '🚫 Don\'t buy this App from AnyOne. This App is Free 🆓 of Cost for EveryOne. Unfortunately, If you Purchased this App, then please report! that user who sold you this App and take your Money Back.|🤝 Join Us on Telegram : Scam se bachne ke liye, Get updates, mentorship, and connect with us.',
            discoverNoticeImageUrl: '' 
        };
        window.openTodaySurpriseLink = () => {
            alert('Loading surprise link... Please wait.');
        };
        const authenticateFirebase = async () => {
            try {
                if (typeof __initial_auth_token !== 'undefined') {
                    const userCredential = await signInWithCustomToken(auth, __initial_auth_token);
                    currentUserId = userCredential.user.uid;
                    isAuthenticated = true;
                    console.log("Public site: Signed in with custom token. UID:", currentUserId);
                } else {
                    const userCredential = await signInAnonymously(auth);
                    currentUserId = userCredential.user.uid;
                    isAuthenticated = true;
                    console.log("Public site: Signed in anonymously. UID:", currentUserId);
                }
            } catch (error) {
                console.error("Public site Firebase authentication error:", error);
                alert("Firebase Authentication Error: " + error.message);
            }
        };
        const quotes = [
            { quote: "The only way to do great work is to love what you do.", author: "Steve Jobs" },
            { quote: "Success is not final, failure is not fatal: It is the courage to continue that counts.", author: "Winston Churchill" },
            { quote: "Believe you can and you're halfway there.", author: "Theodore Roosevelt" },
            { quote: "The mind is everything. What you think you become.", author: "Buddha" },
            { quote: "The best way to predict the future is to create it.", author: "Peter Drucker" }
        ];
        const allEmojis = ['✨', '🚀', '💡', '🌟', '💪', '🔥', '💖', '🎓', '📚', '🎯'];
        let availableQuoteIndices = [];
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        let allCategoriesData = {};
        window.favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        let currentView = 'home-view';
        let currentBatchId = null;
        let currentSectionIndex = null;
        window.currentPlayingLectureId = null;
        window.lastCategoryViewed = 'all';

        function extractVideoId(url) {
            // Updated to be more robust for Google Drive and YouTube
            let videoId = null;
            let videoType = null;

            // Try YouTube
            const youtubeMatch = url.match(/(?:https?:\/\/)?(?:www\.)?(?:m\.)?(?:youtube\.com|youtu\.be)\/(?:watch\?v=|embed\/|v\/|)([\w-]{11})(?:\S+)?/);
            if (youtubeMatch && youtubeMatch[1]) {
                videoId = youtubeMatch[1];
                videoType = 'youtube';
            }

            // Try Google Drive
            // Matches: drive.google.com/file/d/FILE_ID/view
            // Matches: drive.google.com/open?id=FILE_ID
            // Matches: drive.google.com/embed?id=FILE_ID
            // Matches: drive.google.com/a/domain.com/file/d/FILE_ID/view (for G Suite/Workplace)
            const gdriveMatch = url.match(/(?:drive\.google\.com\/(?:file\/d\/|open\?id=|embed\/|a\/[^/]+\/file\/d\/|a\/[^/]+\/open\?id=))([a-zA-Z0-9_-]+)/);
            if (!videoId && gdriveMatch && gdriveMatch[1]) { // Only try GDrive if YouTube not found
                videoId = gdriveMatch[1];
                videoType = 'gdrive';
            }
            
            if (videoId && videoType) {
                return { type: videoType, id: videoId };
            }
            return null;
        }

        function getFileExtension(url, name) {
            if (name) {
                const nameParts = name.split('.');
                if (nameParts.length > 1) {
                    return nameParts.pop();
                }
            }
            if (url) {
                const urlParts = url.split('.');
                if (urlParts.length > 1) {
                    return urlParts.pop().split('?')[0].split('#')[0];
                }
                // Specific checks for common video types based on domains (if extension isn't clear)
                if (url.includes('youtube.com') || url.includes('youtu.be')) {
                    return 'youtube';
                }
                if (url.includes('drive.google.com')) {
                    return 'gdrive';
                }
            }
            return '';
        }

        window.openSliderMenu = function() {
            document.getElementById('sliderMenu').classList.add('active');
            document.getElementById('sliderMenuOverlay').classList.add('active');
        };

        window.closeSliderMenu = function() {
            document.getElementById('sliderMenu').classList.remove('active');
            document.getElementById('sliderMenuOverlay').classList.remove('active');
        };
        document.addEventListener('DOMContentLoaded', async () => {
            document.getElementById('menuIcon').addEventListener('click', window.openSliderMenu);

            await authenticateFirebase();
            loadAllCategoriesFromFirebase();
            loadSiteConfigAndApply();

            let userName = localStorage.getItem('userName');
            let userRole = localStorage.getItem('userRole');
            const popupOverlay = document.getElementById('namePopupOverlay');
 
            document.body.classList.add('animate-in'); 

            if (!userName || !userRole) {
                popupOverlay.classList.add('active');
                document.querySelector('input[name="userRole"][value="Other"]').checked = true;
            } else {
                updateWelcomeSection();
            }

            for (let i = 0; i < quotes.length; i++) {
                availableQuoteIndices.push(i);
            }
            shuffleArray(availableQuoteIndices);

            window.highlightBottomNav('home-nav');
            renderFavoritesSectionHomeCard();
            window.updateQuote();
            setInterval(window.updateQuote, 6 * 60 * 60 * 1000);

            document.addEventListener('contextmenu', (e) => { e.preventDefault(); });
            function updateOnlineStatus() {
                const offlineOverlay = document.getElementById('offlineOverlay');
                if (navigator.onLine) {
                    offlineOverlay.classList.remove('active');
                } else {
                    offlineOverlay.classList.add('active');
                }
            }

            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);
            updateOnlineStatus();

            // Removed Dark Mode toggle initialization as per request
            // const isLightModeEnabled = localStorage.getItem('lightModeEnabled') === 'true';
            // if (isLightModeEnabled) {
            //     document.body.classList.add('light-mode');
            // }

            const appLogo = document.getElementById('appLogo');
            const skillNeastLogoImage = document.getElementById('skillNeastLogo');
            appLogo.addEventListener('click', () => {
                if (!skillNeastLogoImage.classList.contains('rotating')) {
                    skillNeastLogoImage.classList.add('rotating');
                    setTimeout(() => {
                        skillNeastLogoImage.classList.remove('rotating');
                        location.reload();
                    }, 1000);
                }
            });
            loadHowToUseVideosForWebsite();
            setupLikeButton();

            openGlobalNoticePopup();
        });
        window.updateQuote = function() {
            const quoteTextElement = document.getElementById('quoteText');
            const quoteAuthorElement = document.getElementById('quoteAuthor');
            
            if (availableQuoteIndices.length === 0) {
                for (let i = 0; i < quotes.length; i++) availableQuoteIndices.push(i);
                shuffleArray(availableQuoteIndices);
            }

            const quoteIndex = availableQuoteIndices.pop();
            const selectedQuote = quotes[quoteIndex];
            const randomEmoji = allEmojis[Math.floor(Math.random() * allEmojis.length)];

            quoteTextElement.innerHTML = `"${selectedQuote.quote}" <span class="quote-emoji">${randomEmoji}</span>`;
            quoteAuthorElement.textContent = selectedQuote.author;
        }

        window.updateCharCount = function() {
            document.getElementById('userNameInput').textContent = document.getElementById('userNameInput').value.length;
        }

        window.submitName = function() {
            let userName = document.getElementById('userNameInput').value.trim();
            let userRole = document.querySelector('input[name="userRole"]:checked').value;

            if (userName === '') userName = 'Guest';
            localStorage.setItem('userName', userName.substring(0, 15));
            localStorage.setItem('userRole', userRole);

            updateWelcomeSection();
            window.closeNamePopup();
        }

        function updateWelcomeSection() {
            const userName = localStorage.getItem('userName') || 'Guest';
            const userRole = localStorage.getItem('userRole') || '';
            document.getElementById('displayedUserName').textContent = userName;
            const displayedUserRoleElement = document.getElementById('displayedUserRole');
            if (userRole && userRole !== 'Other') {
                displayedUserRoleElement.textContent = userRole;
                displayedUserRoleElement.style.display = 'inline-block';
            } else {
                displayedUserRoleElement.style.display = 'none';
            }
        }

        window.closeNamePopup = () => document.getElementById('namePopupOverlay').classList.remove('active');
        function hideAllViews() {
            const views = [
                'home-view', 'new-batches-view', 'favorites-view', 'sections-view', 
                'lessons-in-sections-view', 'video-player-view', 'bundles-coming-soon-view', 
                'pdfs-coming-soon-view', 'about-me-view', 'how-to-use-app-view', 
                'ai-chatbot-coming-soon-view', 'timeline-coming-soon-view', 'watch-later-coming-soon-view',
                'comments-coming-soon-view',
                'request-courses-view' 
            ];
            const commentsPopupOverlay = document.getElementById('commentsPopupOverlay');
            if (commentsPopupOverlay) {
                commentsPopupOverlay.classList.remove('active');
                commentsPopupOverlay.style.display = 'none';
            }
            
            views.forEach(id => {
                const viewElement = document.getElementById(id);
                if (viewElement) {
                    viewElement.style.display = 'none';
                }
            });
            const welcomeBanner = document.querySelector('.welcome-banner');
            if (welcomeBanner) welcomeBanner.style.display = 'none';
            const quoteSection = document.querySelector('.quote-section');
            if (quoteSection) quoteSection.style.display = 'none';
            const globalNoticeOverlay = document.getElementById('globalNoticeOverlay');
            if (globalNoticeOverlay) {
                globalNoticeOverlay.classList.remove('active');
                globalNoticeOverlay.style.display = 'none';
            }
            document.getElementById('telegramChannelsBanner').style.display = 'none';
            document.getElementById('discoverNotice').style.display = 'none';
        }

        window.showHomeView = function() {
            hideAllViews();
            document.getElementById('home-view').style.display = 'grid';
            document.querySelector('.welcome-banner').style.display = 'flex';
            document.querySelector('.quote-section').style.display = 'block';
            
            const telegramBanner = document.getElementById('telegramChannelsBanner');
            if (telegramBanner && window.siteConfig.telegramBannerVisible) {
                telegramBanner.style.display = 'flex';
            }
            const discoverNotice = document.getElementById('discoverNotice');
            if (discoverNotice && window.siteConfig.discoverNoticeVisible) {
                discoverNotice.style.display = 'block';
            }

            currentView = 'home-view';
            window.highlightBottomNav('home-nav');
            window.scrollTo(0, 0);
            updateWelcomeSection();
            renderCategories();
        }

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible-on-scroll');
                }
            });
        }, { threshold: 0.1 });

        function loadAllCategoriesFromFirebase() {
            onValue(dbRef(rtdb, 'categories'), (snapshot) => {
                allCategoriesData = snapshot.val() || {};
                renderCategories();
            }, (error) => {
                document.getElementById('loadingCategoriesMessage').textContent = `Error loading categories: ${error.message}`;
            });
        }

        const loadSiteConfigAndApply = () => {
            onValue(dbRef(rtdb, 'siteConfig'), (snapshot) => {
                const config = snapshot.val() || {};
                window.siteConfig = { ...window.siteConfig, ...config };
                
                document.getElementById('skillNeastLogo').src = window.siteConfig.skillNeastLogoUrl || 'https://via.placeholder.com/40x40/00ADB5/ffffff?text=SN';
                window.openTodaySurpriseLink = () => {
                    const link = window.siteConfig.surpriseButtonLink || '#';
                    if (link && link !== '#') {
                        window.open(link, '_blank');
                    } else {
                        alert('No surprise link available yet! Check back later. 🎉');
                    }
                };
                document.querySelector('.surprise-button').onclick = window.openTodaySurpriseLink;

                document.querySelector('.top-navbar .telegram-icon').onclick = () => window.open(window.siteConfig.telegramGroupLink || 'https://t.me/', '_blank');
                document.getElementById('aboutMeProfilePic').src = window.siteConfig.profilePictureUrl || 'https://via.placeholder.com/120x120/00ADB5/ffffff?text=Fahad';
                document.getElementById('aboutMeTelegramGroupLink').href = window.siteConfig.telegramGroupLink || 'https://t.me/';
                document.getElementById('aboutMeInstagramLink').href = window.siteConfig.instagramLink || 'https://instagram.com/';
                document.getElementById('aboutMeYoutubeLink').href = window.siteConfig.youtubeLink || 'https://www.youtube.com/';
                document.getElementById('sliderHeaderLogo').src = window.siteConfig.sliderHeaderPictureUrl || 'https://via.placeholder.com/50x50/00ADB5/ffffff?text=SN';
                document.getElementById('sliderTelegramChannelLink').href = window.siteConfig.telegramChannelLink || 'https://t.me/';
                document.getElementById('sliderTelegramGroupLink').href = window.siteConfig.telegramGroupLink || 'https://t.me/';
                document.getElementById('sliderRequestCoursesLink').href = window.siteConfig.requestCoursesLink || '#';

                console.log("Site configuration applied.");

                // --- Populate Telegram Channels Banner (WE NEED) ---
                const telegramBanner = document.getElementById('telegramChannelsBanner');
                const telegramMainTitle = document.getElementById('telegramBannerMainTitle');
                const telegramChannelList = document.getElementById('telegramBannerChannelList');
                const telegramButton = document.getElementById('telegramBannerButton');
                const telegramSupportText = document.getElementById('telegramBannerSupportText');
                if (window.siteConfig.telegramBannerVisible) {
                    telegramBanner.style.display = 'flex';
                    telegramMainTitle.innerHTML = window.siteConfig.telegramBannerTitle || 'JOIN OUR OFFICIAL <br> TELEGRAM CHANNELS';
                    telegramSupportText.textContent = window.siteConfig.telegramBannerSupportText || 'YOUR SUPPORT !!';
                    telegramButton.textContent = window.siteConfig.telegramBannerButtonText || 'CLICK HERE!';
                    telegramButton.onclick = () => window.open(window.siteConfig.telegramBannerButtonLink || window.siteConfig.telegramGroupLink || 'https://t.me/', '_blank');

                    telegramChannelList.innerHTML = '';
                    if (window.siteConfig.telegramBannerChannelList) {
                        const channels = window.siteConfig.telegramBannerChannelList.split('|');
                        channels.forEach(channelText => {
                            const span = document.createElement('span');
                            span.innerHTML = channelText.trim();
                            telegramChannelList.appendChild(span);
                        });
                    } else {
                        telegramChannelList.innerHTML = `
                            <span>• Study Ratna <i class="fas fa-book-reader"></i></span>
                            <span>• RATNA Official <i class="fas fa-bullhorn"></i></span>
                            <span>• Anime Speaks <i class="fas fa-dragon"></i></span>
                            <span>• Code with RATNA <i class="fas fa-code"></i></span>
                        `;
                    }
                } else {
                    telegramBanner.style.display = 'none';
                }

                // --- Populate Discover Notice (Namo Buddhaya Everyone) ---
                const discoverNotice = document.getElementById('discoverNotice');
                const discoverNoticeHeader = document.getElementById('discoverNoticeHeader');
                const discoverNoticeMainTitle = document.getElementById('discoverNoticeMainTitle');
                const discoverNoticePoints = document.getElementById('discoverNoticePoints');
                const discoverNoticeImage = document.getElementById('discoverNoticeImage');
                if (window.siteConfig.discoverNoticeVisible) {
                    discoverNotice.style.display = 'block';
                    discoverNoticeHeader.innerHTML = `${window.siteConfig.discoverNoticeHeaderEmoji || '🙏'} Namo Buddhaya Everyone ${window.siteConfig.discoverNoticeHeaderEmoji || '🙏'}`;
                    discoverNoticeMainTitle.textContent = window.siteConfig.discoverNoticeTitle || 'DISCOVER OUR APP\'S DELIGHTS!';
                    if (window.siteConfig.discoverNoticeImageUrl) {
                        discoverNoticeImage.src = window.siteConfig.discoverNoticeImageUrl;
                        discoverNoticeImage.style.display = 'block';
                        discoverNoticeImage.onclick = () => window.openFullscreenImage(discoverNoticeImage.src);
                    } else {
                        discoverNoticeImage.style.display = 'none';
                    }

                    discoverNoticePoints.innerHTML = '';
                    if (window.siteConfig.discoverNoticePoints) {
                        const points = window.siteConfig.discoverNoticePoints.split('|');
                        points.forEach(pointText => {
                            const li = document.createElement('li');
                            li.innerHTML = pointText.trim();
                            discoverNoticePoints.appendChild(li);
                        });
                    } else {
                        discoverNoticePoints.innerHTML = `
                            <li><span class="emoji-inline">🚫</span>Don't buy this App from AnyOne. This App is Free <span class="emoji-inline">🆓</span> of Cost for EveryOne. Unfortunately, If you Purchased this App, then please report! that user who sold you this App and take your Money Back.</li>
                            <li><span class="emoji-inline">🤝</span> Join Us on Telegram : Scam se bachne ke liye, Get updates, mentorship, and connect with us.</li>
                        `;
                    }
                    loadDiscoverNoticeReactions();
                } else {
                    discoverNotice.style.display = 'none';
                }

            }, (error) => console.error("Error loading site config:", error));
        };
        function loadHowToUseVideosForWebsite() {
            onValue(dbRef(rtdb, 'siteConfig/howToUseVideos'), (snapshot) => {
                const howToUseAppView = document.getElementById('how-to-use-app-view');
                const videoContainer = howToUseAppView.querySelector('.video-container');
                const descriptionParagraph = howToUseAppView.querySelector('p:first-of-type');

                videoContainer.innerHTML = '';
                if (descriptionParagraph) {
                    descriptionParagraph.textContent = '';
                }

                const videos = snapshot.val();
                if (videos) {
                    const firstVideoId = Object.keys(videos)[0];
                    const firstVideo = videos[firstVideoId];
                    if (firstVideo && firstVideo.url) {
                        const videoInfo = extractVideoId(firstVideo.url);
                        if (videoInfo) {
                            let embedUrl = '';
                            if (videoInfo.type === 'gdrive') {
                                embedUrl = `https://drive.google.com/embed?id=${videoInfo.id}`;
                            } else if (videoInfo.type === 'youtube') {
                                embedUrl = `https://www.youtube-nocookie.com/embed/${videoInfo.id}?autoplay=0`;
                            }
                            if (embedUrl) {
                                videoContainer.innerHTML = `<iframe src="${embedUrl}" frameborder="0" allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen" allowfullscreen></iframe>`;
                            }
                        }
                    }
                    if (firstVideo && firstVideo.description && descriptionParagraph) {
                        descriptionParagraph.textContent = firstVideo.description;
                    } else if (descriptionParagraph) {
                        descriptionParagraph.textContent = "Welcome to SkillNeast! This video will guide you through all the features of our app, from navigating courses to managing your favorites and interacting with our community.";
                    }
                } else {
                    videoContainer.innerHTML = `<p style="color: var(--text-light); text-align: center; padding: 20px;">No tutorial video available yet.</p>`;
                    if (descriptionParagraph) {
                        descriptionParagraph.textContent = "Welcome to SkillNeast! This video will guide you through all the features of our app, from navigating courses to managing your favorites and interacting with our community.";
                    }
                }
            }, (error) => {
                console.error("Error loading how-to-use videos for website:", error);
                const howToUseAppView = document.getElementById('how-to-use-app-view');
                if (howToUseAppView) howToUseAppView.querySelector('.video-container').innerHTML = `<p style="color: red; text-align: center; padding: 20px;">Error loading tutorial video.</p>`;
            });
        }

        function renderCategories() {
            const homeView = document.getElementById('home-view');
            const dynamicCategoriesContainer = homeView.querySelector('#dynamic-categories-container');
            
            Array.from(dynamicCategoriesContainer.querySelectorAll('.course-category-item')).forEach(el => el.remove());
            const loadingMessage = dynamicCategoriesContainer.querySelector('#loadingCategoriesMessage');
            if (loadingMessage) loadingMessage.remove();
            if (allCategoriesData) {
                const sortedCategories = Object.entries(allCategoriesData).sort(([, catA], [, catB]) => {
                    const nameA = catA.name ? catA.name.toLowerCase() : '';
                    const nameB = catB.name ? catB.name.toLowerCase() : '';
                    
                    return nameA.localeCompare(nameB);
                });
                sortedCategories.forEach(([catId, category]) => {
                    const categoryItem = document.createElement('div');
                    categoryItem.className = 'course-category-item hidden-on-scroll';
                    categoryItem.onclick = () => window.showNewBatchesView(catId);
                    const imageUrl = category.imageUrl || 'https://via.placeholder.com/180x180/00ADB5/1A2B3C?text=Course';
 
                    categoryItem.innerHTML = `
                        <div class="image-container">
                            <img src="${imageUrl}" alt="${category.name}" draggable="false" onerror="this.onerror=null;this.src='https://via.placeholder.com/180x180/00ADB5/1A2B3C?text=No+Img';">
                        </div>
                        <div class="content-overlay">
                            <span class="category-name">${category.name}</span>
                        </div>
                    `;
                    dynamicCategoriesContainer.appendChild(categoryItem);
                    observer.observe(categoryItem);
                });
            } else {
                dynamicCategoriesContainer.innerHTML = `<p class="text-center text-muted col-span-full">No categories available.</p>`;
            }
        }

        window.showNewBatchesView = function(categoryId = 'all') {
            hideAllViews();
            document.getElementById('new-batches-view').style.display = 'block';
            currentView = 'new-batches-view';
            window.lastCategoryViewed = categoryId;
            document.getElementById('batchSearchInput').value = '';
            document.getElementById('batches-container').innerHTML = ''; 

            let batchesToDisplay = [];
            if (categoryId === 'all') {
                document.getElementById('new-batches-title').textContent = 'All Courses';
                Object.values(allCategoriesData).forEach(category => {
                    if (category.batches) {
                        batchesToDisplay.push(...Object.keys(category.batches).map(key => ({ id: key, ...category.batches[key] })));
                    }
                });
            } else {
                const selectedCategory = allCategoriesData[categoryId];
                document.getElementById('new-batches-title').textContent = selectedCategory ? selectedCategory.name + ' Courses' : 'Courses';
                if (selectedCategory && selectedCategory.batches) {
                    batchesToDisplay = Object.keys(selectedCategory.batches).map(key => ({ id: key, ...selectedCategory.batches[key] }));
                }
            }
            batchesToDisplay.sort((a, b) => (a.title || '').localeCompare(b.title || ''));
            displayBatches(batchesToDisplay);
            window.highlightBottomNav('courses-nav');
            window.scrollTo(0, 0);
        }

        function displayBatches(batchesToDisplay) {
            const batchesContainer = document.getElementById('batches-container');
            batchesContainer.innerHTML = '';
            if (batchesToDisplay.length === 0) {
                batchesContainer.innerHTML = '<p style="text-align: center; color: var(--text-light);">No batches found.</p>';
                return;
            }
            batchesToDisplay.forEach(batch => {
                const batchCard = document.createElement('div');
                batchCard.className = 'batch-card hidden-on-scroll';
                const isFavorited = window.favorites.includes(batch.id);
                const heartIconClass = isFavorited ? 'fas fa-heart' : 'far fa-heart';

                let priceHtml = '';
                if (batch.isFree) {
                    priceHtml = `<span class="free-price">FREE</span>`;
                    if (batch.originalPrice && batch.originalPrice > 0) {
                        priceHtml += `<span class="original-price-strikethrough"> ₹${batch.originalPrice}</span>`;
                    }
                } else {
                    if (batch.discountedPrice !== undefined && batch.discountedPrice !== null && batch.originalPrice !== undefined && batch.originalPrice !== null && batch.discountedPrice < batch.originalPrice) {
                        priceHtml = `<span style="font-weight: bold;">₹${batch.discountedPrice}</span> <span class="original-price-strikethrough">₹${batch.originalPrice}</span>`;
                    } else if (batch.discountedPrice !== undefined && batch.discountedPrice !== null) { 
                        priceHtml = `<span style="font-weight: bold;">₹${batch.discountedPrice}</span>`;
                    } else if (batch.originalPrice !== undefined && batch.originalPrice !== null) { 
                        priceHtml = `<span style="font-weight: bold;">₹${batch.originalPrice}</span>`;
                    } else {
                        priceHtml = `Price N/A`;
                    }
                }

                let descriptionHtml = '';
                if (batch.description) {
                    const lines = batch.description.split('\n').filter(line => line.trim() !== '');
                    descriptionHtml = lines.map(line => `<div class="batch-description-feature"><i class="fas fa-check-circle"></i> ${line.trim()}</div>`).join('');
                } else {
                    descriptionHtml = `<div class="batch-description-feature"><i class="fas fa-check-circle"></i> No description available.</div>`;
                }
                
                let actionButtonHtml = '';
                if (batch.isContentDirectLink) {
                    actionButtonHtml = `<button class="access-content-button" onclick="window.open('${batch.directDriveLink}', '_blank')">ACCESS CONTENT <i class="fas fa-globe"></i></button>`;
                } else {
                    let letsRoarAction;
                    let letsRoarButtonText;

                    if (batch.isFree) {
                        letsRoarAction = `window.showSectionsView('${batch.id}')`;
                        letsRoarButtonText = "LET'S ROAR 🚀🔥";
                    } else {
                        letsRoarAction = `window.open('${batch.telegramCourseLink || window.siteConfig.telegramGroupLink || 'https://t.me/'}', '_blank')`;
                        letsRoarButtonText = "JOIN TELEGRAM 📞";
                    }
                    actionButtonHtml = `<button class="lets-roar-button" onclick="${letsRoarAction}">${letsRoarButtonText}</button>`;
                }

                batchCard.innerHTML = `
                    <div class="batch-card-header">
                        <span>${batch.title}</span>
                        <div class="icons">
                            <i class="${heartIconClass}" onclick="event.stopPropagation(); window.toggleFavorite('${batch.id}', this);"></i>
                        </div>
                    </div>
                    <div class="batch-card-body">
                        <div class="batch-image-container">
                            <img src="${batch.thumbnail}" alt="${batch.title}" draggable="false" onerror="this.onerror=null;this.src='https://via.placeholder.com/200x150/00ADB5/1A2B3C?text=No+Img';">
                        </div>
                        <div class="batch-title">${batch.title}</div>
                        <p class="batch-price" style="margin-bottom: 15px;">${priceHtml}</p>
                        <div class="batch-description">${descriptionHtml}</div>
                        ${actionButtonHtml}
                    </div>`;
                batchesContainer.appendChild(batchCard);
                observer.observe(batchCard);
            });
        }

        window.filterBatches = function() {
            const searchTerm = document.getElementById('batchSearchInput').value.toLowerCase();
            let currentCategoryBatches = [];
            if (window.lastCategoryViewed === 'all') {
                Object.values(allCategoriesData).forEach(cat => {
                    if (cat.batches) {
                        currentCategoryBatches.push(...Object.keys(cat.batches).map(key => ({ id: key, ...cat.batches[key] })));
                    }
                });
            } else {
                const cat = allCategoriesData[window.lastCategoryViewed];
                if (cat && cat.batches) {
                    currentCategoryBatches = Object.keys(cat.batches).map(key => ({ id: key, ...cat.batches[key] }));
                }
            }
            const filtered = currentCategoryBatches.filter(b => (b.title || '').toLowerCase().includes(searchTerm) || ((b.description || '').toLowerCase().includes(searchTerm)));
            displayBatches(filtered);
        }

        window.toggleFavorite = function(batchId, iconElement) {
            const index = window.favorites.indexOf(batchId);
            if (index > -1) { 
                window.favorites.splice(index, 1);
                iconElement.classList.replace('fas', 'far');
            } else {
                window.favorites.push(batchId);
                iconElement.classList.replace('far', 'fas');
            }
            localStorage.setItem('favorites', JSON.stringify(window.favorites));
            renderFavoritesSectionHomeCard();
            if (currentView === 'favorites-view') window.showFavoritesView();
        }

        function renderFavoritesSectionHomeCard() {
            document.getElementById('favorites-count').textContent = `${window.favorites.length} Batches`;
        }

        window.showFavoritesView = function() {
            hideAllViews();
            document.getElementById('favorites-view').style.display = 'block';
            currentView = 'favorites-view';
            window.highlightBottomNav('home-nav');
            const container = document.getElementById('favorite-batches-container');
            const msgView = document.getElementById('no-favorites-message-view');
            container.innerHTML = '';
            if (window.favorites.length === 0) {
                msgView.style.display = 'block';
            } else {
                msgView.style.display = 'none';
                let favBatches = [];
                window.favorites.forEach(favId => {
                    for (const catId in allCategoriesData) {
                        if (allCategoriesData[catId].batches && allCategoriesData[catId].batches[favId]) {
                            favBatches.push({ id: favId, ...allCategoriesData[catId].batches[favId] });
                            break;
                        }
                    }
                });
                displayBatches(favBatches);
            }
            window.scrollTo(0, 0);
        }

        window.showSectionsView = function(batchId) {
            hideAllViews();
            currentBatchId = batchId;
            let selectedBatch = null;
            let currentCategoryId = null;
            for (const catId in allCategoriesData) {
                if (allCategoriesData[catId].batches && allCategoriesData[catId].batches[batchId]) {
                    selectedBatch = allCategoriesData[catId].batches[batchId];
                    currentCategoryId = catId;
                    break;
                }
            }

            const container = document.getElementById('sections-container');
            const titleEl = document.getElementById('sections-title');
            container.innerHTML = '';

            if (!selectedBatch) {
                alert('Error: Batch details could not be found. It might have been deleted.');
                window.showHomeView();
                return;
            }

            if (selectedBatch.isContentDirectLink && selectedBatch.directDriveLink) {
                titleEl.textContent = selectedBatch.title + ' Content';
                const directLinkWarning = document.createElement('div');
                directLinkWarning.className = 'batch-card mb-4';
                directLinkWarning.innerHTML = `
                    <div class="batch-card-body text-center">
                        <h3 class="batch-title" style="color: var(--highlight-gold);">Direct Content Available! <i class="fas fa-external-link-alt"></i></h3>
                        <p class="batch-description">This batch has external content. Click the button below to access it.</p>
                        <button class="access-content-button" onclick="window.open('${selectedBatch.directDriveLink}', '_blank');">
                            ACCESS CONTENT <i class="fas fa-globe"></i>
                        </button>
                    </div>
                `;
                container.appendChild(directLinkWarning);
                document.getElementById('sections-view').style.display = 'block';
            } else {
                titleEl.textContent = selectedBatch.title + ' Modules';
                document.getElementById('sections-view').style.display = 'block';

                const modulesData = selectedBatch.modules || {};
                if (Object.keys(modulesData).length === 0) {
                    container.innerHTML = `<p style="text-align: center; color: var(--text-light); padding: 20px;">No modules available for this batch yet.</p>`;
                } else {
                    Object.entries(modulesData).forEach(([modId, module]) => {
                        const moduleItem = document.createElement('div');
                        moduleItem.className = 'section-item hidden-on-scroll';
                        moduleItem.onclick = () => window.showLessonsInSectionsView(batchId, modId);

                        const lecturesCount = Object.values(module.lectures || {}).filter(item => item.type === 'lecture').length;
                        const resourcesCount = Object.values(module.lectures || {}).filter(item => item.type === 'resource').length;

                        let countsText = '';
                        if (lecturesCount > 0 && resourcesCount > 0) {
                            countsText = `<span>${lecturesCount} Lectures</span> | <span>${resourcesCount} Resources</span>`;
                        } else if (lecturesCount > 0) {
                            countsText = `<span>${lecturesCount} Lectures</span>`;
                        } else if (resourcesCount > 0) {
                            countsText = `<span>${resourcesCount} Resources</span>`;
                        } else {
                            countsText = `<span>No Content</span>`;
                        }

                        moduleItem.innerHTML = `
                            <div class="section-item-content">
                                <h3 class="section-name">${module.name || 'Untitled Module'}</h3>
                                <p class="section-counts">${countsText}</p>
                            </div>
                            <div class="section-arrow"><i class="fas fa-chevron-right"></i></div>
                        `;
                        container.appendChild(moduleItem);
                        observer.observe(moduleItem);
                    });
                }
            }
            window.scrollTo(0, 0);
        };

        window.goBackFromLessonsList = function() {
            window.showSectionsView(currentBatchId);
        };
        window.showLessonsInSectionsView = function(batchId, sectionId) {
            hideAllViews();
            currentBatchId = batchId;
            currentSectionIndex = sectionId;
            document.getElementById('lessons-in-sections-view').style.display = 'block';
            
            let selectedBatch = null;
            for (const catId in allCategoriesData) {
                if (allCategoriesData[catId].batches && allCategoriesData[catId].batches[batchId]) {
                    selectedBatch = allCategoriesData[catId].batches[batchId];
                    break;
                }
            }

            if (!selectedBatch || !selectedBatch.modules || !selectedBatch.modules[sectionId]) {
                alert('Error: Module not found.');
                window.goBackFromLessonsList();
                return;
            }

            const selectedModule = selectedBatch.modules[sectionId];
            document.getElementById('lessons-in-sections-title').textContent = selectedModule.name || 'Module Content';
            const lessonsContainer = document.getElementById('lessons-in-sections-container');
            lessonsContainer.innerHTML = '';

            const items = selectedModule.lectures ? Object.values(selectedModule.lectures) : [];

            const lectures = items.filter(item => item.type === 'lecture');
            const resources = items.filter(item => item.type === 'resource');
            if (lectures.length > 0) {
                const lecturesHeader = document.createElement('h3');
                lecturesHeader.className = 'content-category-header';
                lecturesHeader.innerHTML = `<i class="fas fa-play-circle"></i> Lectures 🎬`;
                lessonsContainer.appendChild(lecturesHeader);

                const lecturesList = document.createElement('div');
                lecturesList.className = 'content-list-container';
                lectures.forEach(lecture => {
                    const lectureItem = document.createElement('div');
                    lectureItem.className = 'lesson-list-item hidden-on-scroll';
                    lectureItem.onclick = () => window.showVideoPlayerView(batchId, sectionId, lecture.url, lecture.name);
                    lectureItem.innerHTML = `
                        <div class="lesson-list-item-right">
                            <h3 class="lesson-list-item-title">${lecture.name || 'Untitled Lecture'}</h3>
                        </div>
                        <div class="video-icon-overlay"><i class="fas fa-video"></i></div>
                    `;
                    lecturesList.appendChild(lectureItem);
                    observer.observe(lectureItem);
                });
                lessonsContainer.appendChild(lecturesList);
            }

            if (resources.length > 0) {
                const resourcesHeader = document.createElement('h3');
                resourcesHeader.className = 'content-category-header';
                resourcesHeader.innerHTML = `<i class="fas fa-file-alt"></i> Resources 📚`;
                lessonsContainer.appendChild(resourcesHeader);

                const resourcesList = document.createElement('div');
                resourcesList.className = 'content-list-container';
                resources.forEach(resource => {
                    const resourceItem = document.createElement('div');
                    resourceItem.className = 'lesson-list-item hidden-on-scroll';
                    resourceItem.onclick = () => {
                        window.open(resource.url, '_blank');
                    };
                    let resourceIconClass = 'fas fa-link';
                    const resourceExtension = getFileExtension(resource.url, resource.name).toLowerCase();
                    if (resourceExtension === 'pdf') {
                        resourceIconClass = 'fas fa-file-pdf';
                    } else if (['zip', 'rar', '7z'].includes(resourceExtension)) {
                        resourceIconClass = 'fas fa-file-archive';
                    } else if (['jpg', 'jpeg', 'png', 'gif'].includes(resourceExtension)) {
                        resourceIconClass = 'fas fa-image';
                    } else if (resourceExtension === 'gem') {
                        resourceIconClass = 'fas fa-gem';
                    } else {
                        resourceIconClass = 'fas fa-link';
                    }

                    resourceItem.innerHTML = `
                        <div class="lesson-list-item-right">
                            <h3 class="lesson-list-item-title">${resource.name || 'Untitled Resource'}</h3>
                        </div>
                        <div class="video-icon-overlay"><i class="${resourceIconClass}" style="color: var(--accent-teal);"></i></div>
                    `;
                    resourcesList.appendChild(resourceItem);
                    observer.observe(resourceItem);
                });
                lessonsContainer.appendChild(resourcesList);
            }

            if (lectures.length === 0 && resources.length === 0) {
                lessonsContainer.innerHTML = `<p style="text-align: center; color: var(--text-light); padding: 20px;">No lectures or resources available in this module yet.</p>`;
            }
            window.scrollTo(0, 0);
        };
        window.goBackFromPlayerView = function() {
            if (currentBatchId && currentSectionIndex !== null) {
                window.showLessonsInSectionsView(currentBatchId, currentSectionIndex);
            } else {
                window.showNewBatchesView(window.lastCategoryViewed);
            }
        };

        window.showVideoPlayerView = function(batchId, sectionId, videoUrl, lectureTitle) {
            hideAllViews();
            document.getElementById('video-player-view').style.display = 'block';
            currentView = 'video-player-view';
            const videoInfoForLike = extractVideoId(videoUrl);
            window.currentPlayingLectureId = videoInfoForLike ? videoInfoForLike.id : videoUrl;
            currentBatchId = batchId;
            currentSectionIndex = sectionId;

            const playerTitleElement = document.getElementById('player-view-title');
            const lessonSubTitleElement = document.getElementById('player-lesson-sub-title');
            const videoPlayerContainer = document.getElementById('main-video-player');
            const lessonsForPlayerBatchContainer = document.getElementById('lessons-for-player-batch');
            playerTitleElement.textContent = lectureTitle;
            lessonSubTitleElement.textContent = lectureTitle;
            videoPlayerContainer.innerHTML = '';

            const videoInfo = extractVideoId(videoUrl);
            if (videoInfo) {
                let embedUrl = '';
                if (videoInfo.type === 'gdrive') {
                    // Using /embed/ is generally more reliable than /preview/ for direct video play
                    embedUrl = `https://drive.google.com/embed?id=${videoInfo.id}`;
                } else if (videoInfo.type === 'youtube') {
                    embedUrl = `https://www.youtube-nocookie.com/embed/${videoInfo.id}?autoplay=1`;
                }
                if (embedUrl) {
                    videoPlayerContainer.innerHTML = `<iframe src="${embedUrl}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen" allowfullscreen></iframe>`;
                } else {
                    videoPlayerContainer.innerHTML = `<p style="color: var(--text-light); text-align: center; padding: 20px;">Unsupported video URL for embedding.</p>`;
                }
            } else {
                videoPlayerContainer.innerHTML = `<p style="color: var(--text-light); text-align: center; padding: 20px;">Invalid video URL format.</p>`;
            }

            const likeButton = document.getElementById('likeButton');
            likeButton.classList.remove('liked');
            const likeCountDisplay = document.getElementById('likeCountDisplay');
            likeCountDisplay.textContent = '0';
            updateLikeButtonState();

            lessonsForPlayerBatchContainer.innerHTML = '';
            let selectedBatch = null;
            for (const catId in allCategoriesData) {
                if (allCategoriesData[catId].batches && allCategoriesData[catId].batches[batchId]) {
                    selectedBatch = allCategoriesData[catId].batches[batchId];
                    break;
                }
            }

            if (selectedBatch && selectedBatch.modules && selectedBatch.modules[sectionId] && selectedBatch.modules[sectionId].lectures) {
                const allLecturesInModule = Object.values(selectedBatch.modules[sectionId].lectures).filter(item => item.type === 'lecture');
                allLecturesInModule.forEach(lesson => {
                    const lessonItem = document.createElement('li');
                    lessonItem.className = 'lesson-item';
                    lessonItem.onclick = () => window.showVideoPlayerView(batchId, sectionId, lesson.url, lesson.name);
                    lessonItem.innerHTML = `<h3>${lesson.name}</h3>`;
                    lessonsForPlayerBatchContainer.appendChild(lessonItem);
                });
            }
            window.scrollTo(0, 0);
        };
        window.showVideoPlayerViewFromDrive = function(videoUrl, videoName) {
            hideAllViews();
            document.getElementById('video-player-view').style.display = 'block';
            currentView = 'video-player-view';
            const videoInfoForLike = extractVideoId(videoUrl);
            window.currentPlayingLectureId = videoInfoForLike ? videoInfoForLike.id : videoUrl;
            currentBatchId = null;
            currentSectionIndex = null;
            const playerTitleElement = document.getElementById('player-view-title');
            const lessonSubTitleElement = document.getElementById('player-lesson-sub-title');
            const videoPlayerContainer = document.getElementById('main-video-player');
            const lessonsForPlayerBatchContainer = document.getElementById('lessons-for-player-batch');

            playerTitleElement.textContent = videoName;
            lessonSubTitleElement.textContent = videoName;
            videoPlayerContainer.innerHTML = '';

            const videoInfo = extractVideoId(videoUrl);
            if (videoInfo) {
                let embedUrl = '';
                if (videoInfo.type === 'gdrive') {
                    // Using /embed/ is generally more reliable than /preview/ for direct video play
                    embedUrl = `https://drive.google.com/embed?id=${videoInfo.id}`;
                } else if (videoInfo.type === 'youtube') {
                    embedUrl = `https://www.youtube-nocookie.com/embed/${videoInfo.id}?autoplay=1`;
                }
                if (embedUrl) {
                    videoPlayerContainer.innerHTML = `<iframe src="${embedUrl}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen" allowfullscreen></iframe>`;
                } else {
                    videoPlayerContainer.innerHTML = `<p style="color: var(--text-light); text-align: center; padding: 20px;">Unsupported video URL for embedding.</p>`;
                }
            } else {
                videoPlayerContainer.innerHTML = `<p style="color: var(--text-light); text-align: center; padding: 20px;">Invalid video URL format.</p>`;
            }

            const likeButton = document.getElementById('likeButton');
            likeButton.classList.remove('liked');
            const likeCountDisplay = document.getElementById('likeCountDisplay');
            likeCountDisplay.textContent = '0';
            updateLikeButtonState();

            lessonsForPlayerBatchContainer.innerHTML = `<p style="text-align: center; color: var(--text-light); padding: 20px;">No additional lessons in this direct link content.</p>`;
            window.scrollTo(0, 0);
        };

        window.toggleFullScreen = function() {
            const iframe = document.querySelector('#main-video-player iframe');
            if (iframe) {
                if (iframe.requestFullscreen) {
                    iframe.requestFullscreen();
                } else if (iframe.mozRequestFullScreen) {
                    iframe.mozRequestFullScreen();
                } else if (iframe.webkitRequestFullscreen) {
                    iframe.webkitRequestFullscreen();
                } else if (iframe.msRequestFullscreen) {
                    iframe.msRequestFullscreen();
                }
            }
        };
        window.highlightBottomNav = function(activeId) {
            document.querySelectorAll('.bottom-navbar .nav-item').forEach(item => {
                item.classList.remove('active');
            });
            const activeItem = document.getElementById(activeId);
            if (activeItem) {
                activeItem.classList.add('active');
            }
        };

        window.showComingSoonView = function(feature) {
            hideAllViews();
            let viewId = '';
            let backAction = 'home';

            switch(feature) {
                case 'timeline':
                    viewId = 'timeline-coming-soon-view';
                    backAction = 'player';
                    break;
                case 'watch-later':
                    viewId = 'watch-later-coming-soon-view';
                    backAction = 'player';
                    break;
                case 'comments-coming-soon':
                    viewId = 'comments-coming-soon-view';
                    backAction = 'player';
                    break;
                case 'bundles':
                    viewId = 'bundles-coming-soon-view';
                    backAction = 'home';
                    break;
                case 'pdfs':
                    viewId = 'pdfs-coming-soon-view';
                    backAction = 'home';
                    break;
                case 'ai-chatbot':
                    viewId = 'ai-chatbot-coming-soon-view';
                    backAction = 'home';
                    break;
                default:
                    alert('Coming soon feature not recognized!');
                    window.showHomeView();
                    return;
            }

            document.getElementById(viewId).style.display = 'flex';
            currentView = viewId;
            const backButton = document.querySelector(`#${viewId} .back-button`);
            if (backButton) {
                backButton.onclick = () => {
                    if (backAction === 'player') {
                        window.goBackFromPlayerView();
                    } else {
                        window.showHomeView();
                    }
                };
            }
            window.scrollTo(0,0);
        };
        window.shareApp = async () => {
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'SkillNeast App',
                        text: 'Master new skills and boost your knowledge with SkillNeast! Download the app now.',
                        url: window.location.href
                    });
                    console.log('App shared successfully');
                } catch (error) {
                    console.error('Error sharing app:', error);
                }
            } else {
                alert('Web Share API is not supported in this browser. You can manually copy the link: ' + window.location.href);
            }
        };

        window.showAboutMeView = function() {
            hideAllViews();
            document.getElementById('about-me-view').style.display = 'flex';
            currentView = 'about-me-view';
            window.highlightBottomNav('about-me-nav');
            window.scrollTo(0,0);
        };

        window.showHowToUseAppView = function() {
            hideAllViews();
            document.getElementById('how-to-use-app-view').style.display = 'flex';
            currentView = 'how-to-use-app-view';
            window.highlightBottomNav('home-nav'); 
            window.scrollTo(0,0);
        };

        window.openCommentsPopup = function() {
            document.getElementById('commentsPopupOverlay').style.display = 'flex';
            document.getElementById('commentsPopupOverlay').classList.add('active');
            loadComments();
        };

        window.closeCommentsPopup = function() {
            document.getElementById('commentsPopupOverlay').classList.remove('active');
            setTimeout(() => {
                document.getElementById('commentsPopupOverlay').style.display = 'none';
            }, 300);
        };

        window.postComment = async function() {
            if (!isAuthenticated) {
                alert("You need to be authenticated to post comments.");
                return;
            }
            if (!window.currentPlayingLectureId) {
                alert("No lecture selected to comment on.");
                return;
            }

            const commentInput = document.getElementById('commentInput');
            const commentText = commentInput.value.trim();
            const userName = localStorage.getItem('userName') || 'Anonymous';
            if (commentText.length === 0) {
                alert("Comment cannot be empty.");
                return;
            }

            try {
                const commentsRef = dbRef(rtdb, `comments/${window.currentPlayingLectureId}`);
                await push(commentsRef, {
                    userId: currentUserId,
                    userName: userName,
                    text: commentText,
                    timestamp: serverTimestamp()
                });
                commentInput.value = '';
                console.log('Comment posted!');
            } catch (error) {
                console.error("Error posting comment:", error);
                alert("Failed to post comment: " + error.message);
            }
        };
        function loadComments() {
            if (!window.currentPlayingLectureId) {
                document.getElementById('commentsDisplayArea').innerHTML = '<p class="no-comments-message">No lecture selected for comments.</p>';
                return;
            }

            const commentsRef = dbRef(rtdb, `comments/${window.currentPlayingLectureId}`);
            onValue(commentsRef, (snapshot) => {
                const commentsData = snapshot.val();
                const commentsDisplayArea = document.getElementById('commentsDisplayArea');
                commentsDisplayArea.innerHTML = '';

                if (!commentsData) {
                    commentsDisplayArea.innerHTML = '<p class="no-comments-message">No comments yet. Be the first to comment!</p>';
                    return;
                }

                const sortedComments = Object.values(commentsData).sort((a, b) => {
                    const timeA = a.timestamp || 0;
                    const timeB = b.timestamp || 0;
                    return timeA - timeB;
                });

                sortedComments.forEach(comment => {
                    const commentItem = document.createElement('div');
                    commentItem.className = 'comment-item';
                    const commentTime = comment.timestamp ? new Date(comment.timestamp).toLocaleString() : 'Just now';
                    commentItem.innerHTML = `
                        <strong>${comment.userName}</strong> <span style="font-size: 0.75em; color: var(--text-light);">
                        ${commentTime}</span>
                        <p>${comment.text}</p>
                    `;
                    commentsDisplayArea.appendChild(commentItem);
                });
            }, (error) => {
                console.error("Error loading comments:", error);
                document.getElementById('commentsDisplayArea').innerHTML = `<p class="no-comments-message" style="color:red;">Error loading comments: ${error.message}</p>`;
            });
        }

        function setupLikeButton() {
            const likeButton = document.getElementById('likeButton');
            const likeCountDisplay = document.getElementById('likeCountDisplay');

            if (!likeButton.dataset.listenerAttached) {
                likeButton.addEventListener('click', async () => {
                    if (!isAuthenticated) {
                        alert("Please sign in to like content.");
                        return;
                    }
                    if (!window.currentPlayingLectureId) {
                        alert("No lecture selected to like.");
                        return;
                    }

                    const lectureId = window.currentPlayingLectureId;
                    const userLikesIndex = window.userLikes.indexOf(lectureId);

                    try {
                        if (userLikesIndex > -1) {
                            likeButton.classList.remove('liked');
                            window.userLikes.splice(userLikesIndex, 1);
                            localStorage.setItem('userLikes', JSON.stringify(window.userLikes));
                            
                            const lectureLikesRef = dbRef(rtdb, `likes/${lectureId}/count`);
                            onValue(lectureLikesRef, (snapshot) => {
                                let currentCount = snapshot.val() || 0;
                                set(lectureLikesRef, Math.max(0, currentCount - 1));
                            }, { onlyOnce: true });

                        } else {
                            likeButton.classList.add('liked');
                            likeButton.classList.add('animating');
                            setTimeout(() => likeButton.classList.remove('animating'), 300);
                            window.userLikes.push(lectureId);
                            localStorage.setItem('userLikes', JSON.stringify(window.userLikes));

                            const lectureLikesRef = dbRef(rtdb, `likes/${lectureId}/count`);
                            onValue(lectureLikesRef, (snapshot) => {
                                let currentCount = snapshot.val() || 0;
                                set(lectureLikesRef, currentCount + 1);
                            }, { onlyOnce: true });
                        }
                    } catch (error) {
                        console.error("Error toggling like:", error);
                        alert("Failed to update like status: " + error.message);
                    }
                });
                likeButton.dataset.listenerAttached = 'true';
            }

            onValue(dbRef(rtdb, `likes/${window.currentPlayingLectureId}/count`), (snapshot) => {
                const count = snapshot.val() || 0;
                likeCountDisplay.textContent = count;
                if (window.userLikes.includes(window.currentPlayingLectureId)) {
                    likeButton.classList.add('liked');
                } else {
                    likeButton.classList.remove('liked');
                }
            });
        }

        function updateLikeButtonState() {
            if (!window.currentPlayingLectureId) return;
            const likeButton = document.getElementById('likeButton');
            const likeCountDisplay = document.getElementById('likeCountDisplay');

            if (window.userLikes.includes(window.currentPlayingLectureId)) {
                likeButton.classList.add('liked');
            } else {
                likeButton.classList.remove('liked');
            }

            onValue(dbRef(rtdb, `likes/${window.currentPlayingLectureId}/count`), (snapshot) => {
                const count = snapshot.val() || 0;
                likeCountDisplay.textContent = count;
            });
        }

        window.openFullscreenImage = function(imageUrl) {
            const overlay = document.getElementById('fullscreenImageOverlay');
            const img = document.getElementById('fullscreenImage');
            img.src = imageUrl;
            img.style.pointerEvents = 'auto'; // Re-enable pointer events for the image itself if needed
            overlay.classList.add('active');
            overlay.onclick = (e) => {
                if (e.target === overlay || e.target === img) { // Close if backdrop or image itself is clicked
                    window.closeFullscreenImage();
                }
            };
        };
        window.closeFullscreenImage = function() {
            const overlay = document.getElementById('fullscreenImageOverlay');
            overlay.classList.remove('active');
            overlay.onclick = null;
        };

        window.openGlobalNoticePopup = function() {
            const overlay = document.getElementById('globalNoticeOverlay');
            const noticeMessage = document.getElementById('globalNoticeMessage');
            const joinButton = document.getElementById('globalNoticeJoinButton');
            const reactionsContainer = overlay.querySelector('.notice-reaction-container');
            onValue(globalNoticeRef, (snapshot) => {
                const noticeData = snapshot.val();
                if (noticeData && noticeData.message) {
                    noticeMessage.textContent = noticeData.message;
                    joinButton.textContent = noticeData.buttonText || "Join Now";
                    joinButton.onclick = () => {
                        if (noticeData.buttonLink) {
                            window.open(noticeData.buttonLink, '_blank');
                        }
                        window.closeGlobalNoticePopup();
                    };

                    reactionsContainer.innerHTML = ''; 
                    const emojis = ["❤️", "😂", "👍"];
                    emojis.forEach(emoji => {
                        const reactionSpan = document.createElement('span');
                        reactionSpan.className = 'reaction-icon-notice';
                        reactionSpan.dataset.reaction = emoji;
                        reactionSpan.innerHTML = `<span class="reaction-emoji">${emoji}</span> <span class="count">${noticeData.reactions ? (noticeData.reactions[emoji] || 0) : 0}</span>`;
                        
                        if (window.userNoticeReactions.lastReactedNoticeId === 'globalNotice' && window.userNoticeReactions.lastReactionType === emoji) {
                            reactionSpan.classList.add('reacted');
                        }

                        reactionSpan.onclick = (e) => {
                            e.stopPropagation();
                            toggleGlobalNoticeReaction(emoji, reactionSpan);
                        };
                        reactionsContainer.appendChild(reactionSpan);
                    });

                    overlay.style.display = 'flex';
                    setTimeout(() => {
                        overlay.classList.add('active');
                    }, 10);
                } else {
                    console.log("No global notice data found or message is empty.");
                    overlay.classList.remove('active');
                    overlay.style.display = 'none';
                }
            }, (error) => {
                console.error("Error loading global notice:", error);
                overlay.classList.remove('active');
                overlay.style.display = 'none';
                alert("Error loading notice: " + error.message);
            });
        };
        window.closeGlobalNoticePopup = function() {
            document.getElementById('globalNoticeOverlay').classList.remove('active');
            setTimeout(() => {
                document.getElementById('globalNoticeOverlay').style.display = 'none';
            }, 300);
        };

        async function toggleGlobalNoticeReaction(reactionType, clickedElement) {
            if (!isAuthenticated) {
                alert("Please sign in to react.");
                return;
            }

            const noticeId = 'globalNotice';
            const currentReactionByUser = window.userNoticeReactions.lastReactionType;
            const currentReactedNoticeId = window.userNoticeReactions.lastReactedNoticeId;
            const noticeReactionsRef = dbRef(rtdb, `notices/${noticeId}/reactions`);
            try {
                const snapshot = await new Promise(resolve => onValue(noticeReactionsRef, resolve, { onlyOnce: true }));
                const currentReactionsData = snapshot.val() || {};
                const updates = {};
                if (currentReactedNoticeId === noticeId && currentReactionByUser === reactionType) {
                    window.userNoticeReactions = {};
                    updates[reactionType] = Math.max(0, (currentReactionsData[reactionType] || 0) - 1);
                    clickedElement.classList.remove('reacted');
                } else {
                    if (currentReactedNoticeId === noticeId && currentReactionByUser) {
                        updates[currentReactionByUser] = Math.max(0, (currentReactionsData[currentReactionByUser] || 0) - 1);
                        document.querySelector(`.notice-reaction-container .reaction-icon-notice[data-reaction="${currentReactionByUser}"]`)?.classList.remove('reacted');
                    }
                    
                    window.userNoticeReactions = {
                        lastReactedNoticeId: noticeId,
                        lastReactionType: reactionType
                    };
                    updates[reactionType] = (currentReactionsData[reactionType] || 0) + 1;
                    clickedElement.classList.add('reacted');
                }
                
                await update(noticeReactionsRef, updates);
                localStorage.setItem('userNoticeReactions', JSON.stringify(window.userNoticeReactions));

            } catch (error) {
                console.error("Error toggling global notice reaction:", error);
                alert("Failed to update reaction: " + error.message);
            }
        }

        function loadDiscoverNoticeReactions() {
            const noticeId = 'discoverNoticeReactions';
            const reactionsContainer = document.querySelector('.discover-notice-reactions');

            onValue(discoverNoticeReactionsRef, (snapshot) => {
                const reactionsData = snapshot.val() || {};
                
                reactionsContainer.querySelectorAll('.reaction-icon-discover').forEach(iconElement => {
                    const reactionType = iconElement.dataset.reaction;
                    const countSpan = iconElement.querySelector('.count');
                    const currentCount = reactionsData[reactionType] || 0;
                    countSpan.textContent = currentCount;

                    if (window.userDiscoverNoticeReactions.lastReactedNoticeId === noticeId && window.userDiscoverNoticeReactions.lastReactionType === reactionType) {
                        iconElement.classList.add('reacted');
                    } else {
                        iconElement.classList.remove('reacted');
                    }

                    if (!iconElement.dataset.listenerAttached) {
                        iconElement.addEventListener('click', (e) => {
                            e.stopPropagation();
                            toggleDiscoverNoticeReaction(noticeId, reactionType, iconElement);
                        });
                        iconElement.dataset.listenerAttached = 'true';
                    }
                });
            }, (error) => {
                console.error("Error loading discover notice reactions:", error);
            });
        }

        async function toggleDiscoverNoticeReaction(noticeId, reactionType, clickedElement) {
            if (!isAuthenticated) {
                alert("Please sign in to react.");
                return;
            }

            const currentReactionByUser = window.userDiscoverNoticeReactions.lastReactionType;
            const currentReactedNoticeId = window.userDiscoverNoticeReactions.lastReactedNoticeId;
            const reactionsRef = dbRef(rtdb, `notices/${noticeId}`);

            try {
                const snapshot = await new Promise(resolve => onValue(reactionsRef, resolve, { onlyOnce: true }));
                const currentReactionsData = snapshot.val() || {};
                const updates = {};
                if (currentReactedNoticeId === noticeId && currentReactionByUser === reactionType) {
                    window.userDiscoverNoticeReactions = {};
                    updates[reactionType] = Math.max(0, (currentReactionsData[reactionType] || 0) - 1);
                    clickedElement.classList.remove('reacted');
                } else {
                    if (currentReactedNoticeId === noticeId && currentReactionByUser) {
                        updates[currentReactionByUser] = Math.max(0, (currentReactionsData[currentReactionByUser] || 0) - 1);
                        document.querySelector(`.discover-notice-reactions .reaction-icon-discover[data-reaction="${currentReactionByUser}"]`)?.classList.remove('reacted');
                    }
                    
                    window.userDiscoverNoticeReactions = {
                        lastReactedNoticeId: noticeId,
                        lastReactionType: reactionType
                    };
                    updates[reactionType] = (currentReactionsData[reactionType] || 0) + 1;
                    clickedElement.classList.add('reacted');
                }
                
                await update(reactionsRef, updates);
                localStorage.setItem('userDiscoverNoticeReactions', JSON.stringify(window.userDiscoverNoticeReactions));

            } catch (error) {
                console.error("Error toggling discover notice reaction:", error);
                alert("Failed to update reaction: " + error.message);
            }
        }

        // NEW: Request Courses View Functions
        window.showRequestCoursesView = function() {
            hideAllViews();
            document.getElementById('request-courses-view').style.display = 'block';
            currentView = 'request-courses-view';
            window.highlightBottomNav('home-nav'); // Highlight Home nav, as requests nav is removed
            window.scrollTo(0, 0);
            loadRequestCoursePosts();
        };

        function loadRequestCoursePosts() {
            const container = document.getElementById('request-posts-container');
            container.innerHTML = `<p class="text-center text-muted col-span-full" id="loadingRequestPostsMessage">Loading community requests...</p>`;

            onValue(requestCoursesRef, (snapshot) => {
                const requests = snapshot.val() || {};
                container.innerHTML = ''; // Clear loading message

                if (Object.keys(requests).length === 0) {
                    container.innerHTML = `<p class="text-center text-muted col-span-full">No community requests available yet. Be the first to share an idea!</p>`;
                    return;
                }

                // Sort by timestamp descending (newest first)
                const sortedRequests = Object.entries(requests).sort(([, a], [, b]) => (b.timestamp || 0) - (a.timestamp || 0));

                sortedRequests.forEach(([requestId, request]) => {
                    const card = document.createElement('div');
                    card.className = 'request-post-card hidden-on-scroll';

                    // Check if it's a new post (e.g., posted in the last 24 hours)
                    const isNew = request.timestamp && (Date.now() - new Date(request.timestamp)) < (24 * 60 * 60 * 1000);

                    let buttonHtml = '';
                    if (request.buttonText && request.buttonLink) {
                        buttonHtml = `<button class="post-button" onclick="window.open('${request.buttonLink}', '_blank');">${request.buttonText} <i class="fas fa-arrow-right"></i></button>`;
                    }

                    let imageUrlHtml = '';
                    if (request.imageUrl) {
                        imageUrlHtml = `<div class="post-image-container" onclick="window.openFullscreenImage('${request.imageUrl}')"><img src="${request.imageUrl}" alt="Request Image" onerror="this.onerror=null;this.src='https://via.placeholder.com/200x150/00ADB5/1A2B3C?text=No+Img';"></div>`;
                    }

                    card.innerHTML = `
                        ${isNew ? '<span class="new-post-tag">New</span>' : ''}
                        ${imageUrlHtml}
                        <div class="post-content">
                            <h3 class="post-title">${request.title || 'Untitled Request'}</h3>
                            <p class="post-description">${request.description || 'No description provided.'}</p>
                            ${buttonHtml}
                            <div class="post-reactions">
                                <span class="reaction-icon-post" data-reaction="❤️" data-post-id="${requestId}"><span class="reaction-emoji">❤️</span> <span class="count">${request.reactions?.["❤️"] || 0}</span></span>
                                <span class="reaction-icon-post" data-reaction="😂" data-post-id="${requestId}"><span class="reaction-emoji">😂</span> <span class="count">${request.reactions?.["😂"] || 0}</span></span>
                                <span class="reaction-icon-post" data-reaction="👍" data-post-id="${requestId}"><span class="reaction-emoji">👍</span> <span class="count">${request.reactions?.["👍"] || 0}</span></span>
                                <span class="reaction-icon-post" data-reaction="🌟" data-post-id="${requestId}"><span class="reaction-emoji">🌟</span> <span class="count">${request.reactions?.["🌟"] || 0}</span></span>
                            </div>
                        </div>
                    `;
                    container.appendChild(card);
                    observer.observe(card); // For fade-in animation

                    // Attach reaction event listeners
                    card.querySelectorAll('.reaction-icon-post').forEach(reactionElement => {
                        if (isAuthenticated) { // Only attach if user is authenticated
                            if (window.userRequestReactions[requestId] === reactionElement.dataset.reaction) {
                                reactionElement.classList.add('reacted');
                            }
                            reactionElement.addEventListener('click', (e) => {
                                e.stopPropagation(); // Prevent card click if reaction clicked
                                toggleRequestReaction(requestId, reactionElement.dataset.reaction, reactionElement);
                            });
                        } else {
                            // Optionally, disable reaction buttons or show a message if not authenticated
                            reactionElement.style.pointerEvents = 'none';
                            reactionElement.style.opacity = '0.6';
                        }
                    });
                });
            }, (error) => {
                container.innerHTML = `<p class="text-center text-muted col-span-full" style="color:red;">Error loading requests: ${error.message}</p>`;
                console.error("Error loading request course posts:", error);
            });
        }

        async function toggleRequestReaction(postId, reactionType, clickedElement) {
            if (!isAuthenticated) {
                alert("Please sign in to react.");
                return;
            }

            const currentReactionByUser = window.userRequestReactions[postId];
            const postReactionsRef = dbRef(rtdb, `requestCourses/${postId}/reactions`);

            try {
                const snapshot = await new Promise(resolve => onValue(postReactionsRef, resolve, { onlyOnce: true }));
                const currentReactionsData = snapshot.val() || {};
                const updates = {};

                if (currentReactionByUser === reactionType) {
                    // User is unreacting
                    delete window.userRequestReactions[postId];
                    updates[reactionType] = Math.max(0, (currentReactionsData[reactionType] || 0) - 1);
                    clickedElement.classList.remove('reacted');
                } else {
                    // User is reacting or changing reaction
                    if (currentReactionByUser) { // If user had a previous reaction, decrement its count
                        updates[currentReactionByUser] = Math.max(0, (currentReactionsData[currentReactionByUser] || 0) - 1);
                        // Find the previously reacted element and remove 'reacted' class
                        const prevReactedElement = document.querySelector(`.request-post-card [data-post-id="${postId}"] .reaction-icon-post[data-reaction="${currentReactionByUser}"]`);
                        if (prevReactedElement) {
                           prevReactedElement.classList.remove('reacted');
                        }
                    }
                    
                    window.userRequestReactions[postId] = reactionType; // Set new reaction
                    updates[reactionType] = (currentReactionsData[reactionType] || 0) + 1;
                    clickedElement.classList.add('reacted');
                }
                
                await update(postReactionsRef, updates);
                localStorage.setItem('userRequestReactions', JSON.stringify(window.userRequestReactions));

            } catch (error) {
                console.error("Error toggling request reaction:", error);
                alert("Failed to update reaction: " + error.message);
            }
        }
    </script>
</body>
</html>
