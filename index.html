<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkillNeast Courses</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Open+Sans:wght@300;400;600;700&family=Comfortaa:wght@700&family=Poppins:wght@700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        :root {
            /* Premium Colors (Dark Theme Defaults) */
            --primary-dark: #1A2B3C;
            --accent-teal: #00ADB5;
            --secondary-light: #2c2c2c;
            --text-dark: #f0f0f0;
            --text-light: #b0b0b0;
            --highlight-gold: #FFD700;
            --success-green: #4CAF50;
            --error-red: #EF5350;
            --white: #ffffff;
            --border-color: rgba(255, 255, 255, 0.08);
            --cyan-glow-color: rgba(0, 173, 181, 0.5);
            --dark-bg-gradient-start: #000000;
            --dark-bg-gradient-end: #1A1A1A;

            /* Image-specific colors for lesson-item and player view */
            --player-bg-color: #1A2B3C;
            --player-section-bg: #222222;
            --player-meta-bg: #282828;
            --timeline-btn-bg: #4CAF50;
            --comments-btn-bg: #007bff;
            --watch-later-btn-bg: #6c757d;

            /* Shadows & Radii */
            --shadow-light: 0 4px 12px rgba(0, 0, 0, 0.2);
            --shadow-medium: 0 10px 30px rgba(0, 0, 0, 0.35);
            --shadow-popup: 0 15px 40px rgba(0, 0, 0, 0.5);
            --border-radius-main: 25px;
            --border-radius-card: 15px;
            --border-radius-input: 10px;
            --border-radius-button: 30px;

            /* Slider Menu Variables */
            --slider-bg: #1A1A1A;
            --slider-item-hover: #2c2c2c;
            --slider-text-color: var(--text-dark);
            --slider-icon-color: var(--accent-teal);
            --slider-border-color: rgba(255, 255, 255, 0.1);
        }

        /* Light Mode Variables */
        body.light-mode {
            --primary-dark: #F0F0F0;
            --accent-teal: #007B80; /* A darker teal for contrast */
            --secondary-light: #F8F8F8;
            --text-dark: #333333;
            --text-light: #555555;
            --highlight-gold: #DAA520;
            --success-green: #388E3C;
            --error-red: #D32F2F;
            --white: #000000; /* Black for 'white' in light theme where applicable */
            --border-color: rgba(0, 0, 0, 0.1);
            --player-bg-color: #DDDDDD;
            --player-section-bg: #FFFFFF;
            --player-meta-bg: #EAEAEA;

            --shadow-light: 0 4px 12px rgba(0, 0, 0, 0.1);
            --shadow-medium: 0 10px 30px rgba(0, 0, 0, 0.2);
            --shadow-popup: 0 15px 40px rgba(0, 0, 0, 0.3);
            
            --dark-bg-gradient-start: #FFFFFF;
            --dark-bg-gradient-end: #F0F0F0;
            /* Light mode specific for slider */
            --slider-bg: #FFFFFF;
            --slider-item-hover: #E0E0E0;
            --slider-text-color: #333333;
            --slider-icon-color: #007B80;
            --slider-border-color: rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Open Sans', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--secondary-light);
            color: var(--text-dark);
            line-height: 1.8;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            overflow-x: hidden;
            padding-bottom: 90px;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        img {
            pointer-events: none;
            -webkit-user-drag: none;
            user-drag: none;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: auto;
            padding: 0 15px;
        }

        .top-navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 25px;
            background: linear-gradient(to right, var(--dark-bg-gradient-start), var(--dark-bg-gradient-end));
            box-shadow: var(--shadow-medium);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom-left-radius: var(--border-radius-main);
            border-bottom-right-radius: var(--border-radius-main);
            transition: background 0.3s ease, box-shadow 0.3s ease;
        }
        .top-navbar .menu-icon, .top-navbar .telegram-icon {
            font-size: 1.8em;
            color: var(--white);
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            width: 52px; /* Adjusted size for better tap target */
            height: 52px; /* Adjusted size for better tap target */
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease, color 0.3s ease;
        }
        .top-navbar .menu-icon { margin-right: 8px; } /* Added margin for spacing */
        .top-navbar .telegram-icon { margin-left: 8px; } /* Added margin for spacing */

        .top-navbar .menu-icon:hover, .top-navbar .telegram-icon:hover {
            background-color: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }
        .top-navbar .app-logo {
            display: flex;
            flex-direction: row; /* Changed to row for logo and title on same line */
            align-items: center;
            padding: 8px 18px; /* Adjusted padding */
            background-color: var(--primary-dark); /* Changed to dark background */
            border-radius: var(--border-radius-button);
            box-shadow: var(--shadow-light);
            cursor: pointer;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            position: relative; /* Needed for tagline positioning */
            overflow: hidden; /* For tagline animation */
            flex-grow: 1; /* Allow it to take available space */
            margin: 0 10px; /* Space from icons */
            justify-content: flex-start; /* Align content to the start */
        }
        .top-navbar .app-logo:hover {
            background-color: #2F4156; /* Darker on hover */
        }
        .top-navbar .app-logo img#skillNeastLogo {
            height: 34px; /* Adjusted size */
            margin-right: 8px; /* Space between logo and text */
            margin-bottom: 0; /* Remove bottom margin */
            transition: transform 1s linear; /* Ensure smooth rotation */
        }
        .top-navbar .app-logo img#skillNeastLogo.rotating {
            animation: rotate360 1s linear forwards; /* Apply rotation to image only */
        }
        @keyframes rotate360 {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .top-navbar .app-logo .text-wrapper { /* New wrapper for title and tagline */
            display: flex;
            flex-direction: column;
            align-items: flex-start; /* Align text to the start within wrapper */
        }
        .top-navbar .app-logo .main-title {
            font-family: 'Poppins', sans-serif;
            font-weight: 800;
            font-size: 1.5em; /* Slightly smaller font for main title */
            letter-spacing: 1.2px; /* Adjusted spacing */
            background: linear-gradient(90deg, #FF6F61, #FFD700, #4CAF50, #00ADB5, #3F51B5, #9C27B0);
            -webkit-background-clip: text;
            color: transparent;
            display: inline-block;
            animation: rainbowText 5s linear infinite;
            background-size: 200% 100%;
            line-height: 1; /* Ensure tight line height */
        }

        @keyframes rainbowText {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }
        /* New Tagline Styles */
        .top-navbar .app-logo .tagline {
            font-family: 'Open Sans', sans-serif;
            font-size: 0.65em; /* Smaller font for tagline */
            font-weight: 600;
            color: var(--text-light); /* Lighter text for tagline */
            text-align: left; /* Align to left */
            animation: floatUpDown 2s infinite ease-in-out; /* Floating animation */
            white-space: nowrap; /* Prevent wrapping */
            transition: color 0.3s ease;
            line-height: 1; /* Ensure tight line height */
        }

        /* --- Main Content Area --- */
        .main-content {
            padding: 30px 20px;
            min-height: calc(100vh - 180px);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* --- Welcome Banner --- */
        .welcome-banner {
            background: linear-gradient(135deg, var(--primary-dark), #2F4156);
            color: var(--text-dark);
            padding: 28px;
            border-radius: var(--border-radius-main);
            /* New 3D Glow Effect */
            box-shadow: 0 0 10px rgba(0, 173, 181, 0.6), /* Teal glow */
                        0 0 20px rgba(0, 173, 181, 0.4),
                        0 10px 30px rgba(0, 0, 0, 0.4); /* Deeper shadow */
            display: flex;
            align-items: center;
            justify-content: center; /* Center items with gap */
            gap: 15px; /* Space between greeting and fire icon */
            margin-bottom: 25px;
            border: 1px solid rgba(0, 173, 181, 0.1);
            position: relative;
            transition: background 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
        }
        .welcome-banner .greeting {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.9em; /* Slightly larger */
            font-weight: 700;
            display: flex;
            align-items: center;
            color: var(--text-dark);
            transition: color 0.3s ease;
        }
        .welcome-banner .greeting i {
            margin-right: 10px; /* Adjusted margin */
            color: var(--error-red);
            font-size: 1.5em; /* Slightly larger */
            vertical-align: middle; /* Align icon vertically */
        }
        .welcome-banner .fire-icon {
            font-size: 2.5em; /* Slightly larger */
            color: #FF5722;
            animation: pulse 1s infinite alternate;
            vertical-align: middle; /* Align icon vertically */
            margin-left: 0; /* Ensure no extra margin */
        }
        .role-sticker {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--accent-teal);
            color: var(--white);
            font-family: 'Montserrat', sans-serif;
            font-size: 0.7em;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 12px;
            box-shadow: var(--shadow-light);
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* --- Quote Section (Updated for Premium Look with Cyan Glow) --- */
        .quote-section {
            background: linear-gradient(135deg, #2A2A2A, #222222);
            padding: 30px;
            border-radius: var(--border-radius-main);
            box-shadow: 0 0 15px var(--cyan-glow-color),
                        0 10px 30px rgba(0, 0, 0, 0.35);
            text-align: center;
            margin-bottom: 30px;
            border: 2px solid var(--accent-teal);
            position: relative;
            overflow: hidden;
            transition: box-shadow 0.3s ease-in-out, background 0.3s ease, border-color 0.3s ease;
        }
        .quote-section::before {
            content: '“';
            position: absolute;
            top: 10px;
            left: 20px;
            font-family: serif;
            font-size: 5em;
            color: rgba(255, 255, 255, 0.08);
            z-index: 0;
            line-height: 0.5;
        }
        .quote-section::after {
            content: '”';
            position: absolute;
            bottom: -20px;
            right: 20px;
            font-family: serif;
            font-size: 5em;
            color: rgba(255, 255, 255, 0.08);
            z-index: 0;
            line-height: 0.5;
        }
        .quote-section .quote-text {
            font-family: 'Open Sans', sans-serif;
            font-style: italic;
            font-size: 1.25em;
            margin-bottom: 18px;
            color: var(--text-dark);
            position: relative;
            z-index: 1;
            animation: quoteSlideIn 0.8s cubic-bezier(0.23, 1, 0.32, 1) forwards;
            padding: 0 10px;
            transition: color 0.3s ease;
        }
        @keyframes quoteSlideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .quote-section .quote-author {
            font-weight: 700;
            color: var(--highlight-gold);
            font-size: 1.1em;
            position: relative;
            z-index: 1;
            animation: quoteAuthorFadeIn 1s ease-out forwards;
            transition: color 0.3s ease;
        }
        @keyframes quoteAuthorFadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .quote-section .quote-emoji {
            font-size: 1.3em;
            margin-left: 10px;
            display: inline-block;
            z-index: 1;
            animation: emojiPopAndGlow 0.6s ease-out forwards, floatUpDown 2s infinite ease-in-out;
        }
        @keyframes emojiPopAndG0low {
            0% { transform: scale(0); opacity: 0; text-shadow: none; }
            50% { transform: scale(1.3); opacity: 1; text-shadow: 0 0 8px var(--cyan-glow-color); }
            100% { transform: scale(1); opacity: 1; text-shadow: none; }
        }
        @keyframes floatUpDown {
            0% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0); }
        }

        /* --- Home View (Initial grid of course categories/batches) --- */
        #home-view {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            padding: 0px;
        }
        
        .course-category-item {
            background-color: #333333;
            border-radius: 18px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            padding: 0;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease, background-color 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: stretch;
            min-height: 180px;
            border: 1px solid var(--border-color);
            overflow: hidden;
            width: 100%; /* Ensure it takes full column width */
        }
        .course-category-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            border-color: var(--accent-teal);
        }
        .course-category-item:active {
            transform: scale(0.98);
        }
        .course-category-item.long-press {
            transform: scale(0.95) !important;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5) !important;
            transition-duration: 0.1s;
        }

        .course-category-item .image-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: inherit;
            overflow: hidden;
            z-index: 1;
        }
        .course-category-item .image-container img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            object-position: center;
            padding: 10px;
            box-sizing: border-box;
        }
        .course-category-item .content-overlay {
            position: relative;
            z-index: 2;
            background: rgba(0, 0, 0, 0.4);
            color: var(--white);
            padding: 10px 15px;
            text-align: center;
            box-sizing: border-box;
            width: 100%;
            margin-top: auto;
            transition: color 0.3s ease;
        }
        .course-category-item .content-overlay .category-name {
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            font-size: 1.2em;
            line-height: 1.2;
            margin-bottom: 0;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.8);
        }
        .course-category-item .new-tag {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #FFC107;
            color: var(--white);
            font-size: 0.7em;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 5px;
            text-transform: uppercase;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            z-index: 3;
        }

        .surprise-button {
            grid-column: 1 / -1;
            background: linear-gradient(90deg, #FF6F61, #FF5722);
            color: var(--white);
            padding: 20px;
            border-radius: var(--border-radius-main);
            box-shadow: var(--shadow-medium);
            text-align: center;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.3em;
            font-weight: 700;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        .surprise-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.4);
            background: linear-gradient(90deg, #FF5722, #FF6F61);
        }
        .surprise-button:active {
            transform: scale(0.98);
        }
        .surprise-button i {
            font-size: 1.5em;
            animation: bounce 1s infinite alternate;
        }

        @media (max-width: 600px) {
            #home-view {
                grid-template-columns: 1fr;
            }
            .surprise-button {
                font-size: 1.1em;
                padding: 15px;
                gap: 10px;
                margin-top: 15px;
            }
            .surprise-button i {
                font-size: 1.3em;
            }
            .course-category-item {
                min-height: 160px;
            }
            .course-category-item .image-container img { padding: 5px; }
            .course-category-item .content-overlay { padding: 10px; }
            .course-category-item .category-name { font-size: 0.95em;}

            .quote-section {
                padding: 20px;
            }
            .quote-section .quote-text {
                font-size: 1.1em;
            }
            .quote-section .quote-author {
                font-size: 0.95em;
            }
        }

        .favorites-section-home-card {
            grid-column: 1 / -1; /* Span across columns */
            background-color: #333333;
            border-radius: var(--border-radius-main);
            box-shadow: var(--shadow-light);
            padding: 25px;
            margin-top: 30px;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.3s ease;
            border: 1px solid var(--border-color);
        }
        .favorites-section-home-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-medium);
        }
        .favorites-section-home-card:active {
            transform: scale(0.98);
        }
        .favorites-section-home-card.long-press {
            transform: scale(0.95) !important;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5) !important;
            transition-duration: 0.1s;
        }
        .favorites-section-home-card h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8em;
            font-weight: 700;
            color: var(--text-dark);
            margin-top: 0;
            margin-bottom: 15px;
            transition: color 0.3s ease;
        }
        .favorites-section-home-card .fav-icon {
            font-size: 3em;
            color: var(--error-red);
            margin-bottom: 10px;
        }
        .favorites-section-home-card p {
            font-size: 1em;
            color: var(--text-light);
            margin-bottom: 10px;
            transition: color 0.3s ease;
        }
        .favorites-section-home-card .fav-count {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.2em;
            font-weight: 700;
            color: var(--accent-teal);
            transition: color 0.3s ease;
        }

        .telegram-card {
            grid-column: 1 / -1; /* Span across columns */
            background-color: #333333;
            border-radius: var(--border-radius-card);
            box-shadow: var(--shadow-light);
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease, background-color 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 150px;
            border: 1px solid var(--border-color);
            margin-top: 20px;
            color: var(--text-dark);
        }
        .telegram-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-medium);
            border-color: #0088cc;
        }
        .telegram-card:active {
            transform: scale(0.98);
        }
        .telegram-card.long-press {
            transform: scale(0.95) !important;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5) !important;
            transition-duration: 0.1s;
        }
        .telegram-card .telegram-icon-large {
            font-size: 3em;
            color: #0088cc;
            margin-bottom: 10px;
        }
        .telegram-card .telegram-text {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 1.2em;
            color: var(--text-dark);
            transition: color 0.3s ease;
        }

        #new-batches-view {
            display: none;
            padding: 0px;
        }
        #new-batches-view .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
        }
        #new-batches-view .back-button {
            background-color: transparent;
            border: none;
            font-size: 2em;
            color: var(--text-dark);
            cursor: pointer;
            margin-right: 18px;
            transition: color 0.2s ease, transform 0.2s ease;
        }
        #new-batches-view .back-button:hover {
            color: var(--accent-teal);
            transform: translateX(-5px);
        }
        #new-batches-view h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.2em;
            font-weight: 700;
            color: var(--text-dark);
            margin: 0;
            flex-grow: 1;
            transition: color 0.3s ease;
        }
        .search-bar-container {
            display: flex;
            align-items: center;
            background-color: #222222;
            border-radius: var(--border-radius-main);
            box-shadow: var(--shadow-light);
            padding: 8px 15px;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
            transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .search-bar-container input {
            flex-grow: 1;
            border: none;
            outline: none;
            padding: 8px 10px;
            font-size: 1em;
            font-family: 'Open Sans', sans-serif;
            color: var(--text-dark);
            background-color: transparent;
            transition: color 0.3s ease;
        }
        .search-bar-container .search-icon {
            font-size: 1.2em;
            color: var(--text-light);
            margin-right: 10px;
            transition: color 0.3s ease;
        }
        .search-bar-container .search-button {
            background-color: var(--accent-teal);
            color: var(--white);
            border: none;
            border-radius: var(--border-radius-button);
            padding: 10px 20px;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .search-bar-container .search-button:hover {
            background-color: #00939b;
        }

        .batch-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .batch-card {
            background-color: #333333;
            border-radius: var(--border-radius-card);
            box-shadow: var(--shadow-light);
            overflow: hidden;
            border: 1px solid #444444;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.3s ease, border-color 0.3s ease;
        }
        .batch-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-medium);
        }
        .batch-card:active {
            transform: scale(0.98);
        }
        .batch-card.long-press {
            transform: scale(0.95) !important;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5) !important;
            transition-duration: 0.1s;
        }
        .batch-card-header {
            position: relative;
            background-color: var(--accent-teal);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--white);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.1em;
            font-weight: 600;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .batch-card-header .icons {
            font-size: 1.2em;
        }
        .batch-card-header .icons i {
            margin-left: 15px;
            cursor: pointer;
            transition: color 0.2s ease, transform 0.2s ease;
        }
        .batch-card-header .icons i.fas.fa-heart {
            color: var(--error-red);
            transform: scale(1.1);
        }
        .batch-card-header .icons i:hover {
            transform: scale(1.2);
        }

        .batch-card-body {
            padding: 20px;
            transition: color 0.3s ease;
        }
        .batch-card-body .batch-image-container {
            width: calc(100% + 40px);
            height: 220px;
            margin: -20px -20px 15px -20px;
            border-radius: 0;
            overflow: hidden;
            position: relative;
        }
        .batch-card-body .batch-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .batch-card-body .batch-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.6em;
            font-weight: 700;
            color: var(--text-dark);
            margin-top: 0;
            margin-bottom: 10px;
            transition: color 0.3s ease;
        }
        .batch-card-body .batch-description {
            font-size: 0.95em;
            color: var(--text-light);
            margin-bottom: 15px;
            line-height: 1.5;
            text-align: justify; /* Justified text for description */
            transition: color 0.3s ease;
        }
        .batch-card-body .lets-roar-button {
            background-color: var(--primary-dark);
            color: var(--white);
            padding: 15px 25px;
            border-radius: var(--border-radius-button);
            text-align: center;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease, color 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: var(--shadow-light);
            margin-top: 15px;
        }
        .batch-card-body .lets-roar-button:hover {
            background-color: #2F4156;
            transform: translateY(-2px);
        }
        .batch-card-body .lets-roar-button i {
            font-size: 1.2em;
        }


        #favorites-view {
            display: none; /* This view will ONLY be accessible via the "My Favorites" card on the homepage */
            padding: 0px;
        }
        #favorites-view .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
        }
        #favorites-view .back-button {
            background-color: transparent;
            border: none;
            font-size: 2em;
            color: var(--text-dark);
            cursor: pointer;
            margin-right: 18px;
            transition: color 0.2s ease, transform 0.2s ease;
        }
        #favorites-view .back-button:hover {
            color: var(--accent-teal);
            transform: translateX(-5px);
        }
        #favorites-view h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.2em;
            font-weight: 700;
            color: var(--text-dark);
            margin: 0;
            flex-grow: 1;
            transition: color 0.3s ease;
        }
        .promotional-banner { /* Removed all content inside this class in HTML */
            display: none; /* Ensure it's hidden as per request */
        }
        .favorite-batch-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .no-favorites-message-view {
            font-size: 1.2em;
            color: var(--text-light);
            text-align: center;
            padding: 40px 20px;
            background-color: #333333;
            border-radius: var(--border-radius-card);
            box-shadow: var(--shadow-light);
            margin-top: 20px;
            border: 1px solid var(--border-color);
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .partition {
            display: none; /* Hidden as per request */
        }

        #sections-view {
            display: none;
            padding: 0px;
        }
        #sections-view .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
        }
        #sections-view .back-button {
            background-color: transparent;
            border: none;
            font-size: 2em;
            color: var(--text-dark);
            cursor: pointer;
            margin-right: 18px;
            transition: color 0.2s ease, transform 0.2s ease;
        }
        #sections-view .back-button:hover {
            color: var(--accent-teal);
            transform: translateX(-5px);
        }
        #sections-view h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.2em;
            font-weight: 700;
            color: var(--text-dark);
            margin: 0;
            flex-grow: 1;
            transition: color 0.3s ease;
        }
        .sections-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        /* New styles for module item to match screenshot 200107.jpg */
        .section-item {
            background: linear-gradient(135deg, rgba(0, 173, 181, 0.1), rgba(0, 173, 181, 0.05)); /* Subtle gradient */
            border-radius: var(--border-radius-card);
            box-shadow: var(--shadow-light);
            padding: 20px; /* Increased padding */
            display: flex;
            flex-direction: column; /* Changed to column for multiple lines of text */
            justify-content: space-between;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.3s ease;
            border: 1px solid rgba(0, 173, 181, 0.2); /* Accent border */
            position: relative;
            overflow: hidden;
        }
        .section-item::before { /* Left accent bar */
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background-color: var(--accent-teal);
            border-top-left-radius: inherit;
            border-bottom-left-radius: inherit;
        }
        .section-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }
        .section-item .section-name {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.4em; /* Larger font for main title */
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 5px; /* Space between title and counts */
            padding-left: 10px; /* Space for the left bar */
            text-align: left; /* Align text left */
            flex-grow: 1;
        }
        .section-item .section-counts {
            font-size: 0.9em;
            color: var(--text-light);
            padding-left: 10px; /* Align with title */
            text-align: left;
        }
        .section-item .section-counts span {
            font-weight: 600;
            color: var(--accent-teal);
        }
        .section-item .section-arrow {
            position: absolute; /* Position arrow to the right */
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5em; /* Larger arrow */
            color: var(--accent-teal);
            transition: color 0.3s ease;
        }

        #lessons-in-sections-view {
            display: none;
            padding: 0px;
        }
        #lessons-in-sections-view .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 25px;
        }
        #lessons-in-sections-view .back-button {
            background-color: transparent;
            border: none;
            font-size: 2em;
            color: var(--text-dark);
            cursor: pointer;
            margin-right: 18px;
            transition: color 0.2s ease, transform 0.2s ease;
        }
        #lessons-in-sections-view .back-button:hover {
            color: var(--accent-teal);
            transform: translateX(-5px);
        }
        #lessons-in-sections-view h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.2em;
            font-weight: 700;
            color: var(--text-dark);
            margin: 0;
            flex-grow: 1;
            transition: color 0.3s ease;
        }
        .lesson-list-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        /* New styles for lesson item to match screenshot 191010.jpg */
        .lesson-list-item {
            background: linear-gradient(135deg, #2A2A2A, #222222); /* Darker background, matching quote section for consistency */
            border-radius: var(--border-radius-card);
            box-shadow: var(--shadow-light);
            padding: 20px; /* Increased padding */
            display: flex;
            flex-direction: row; /* Changed to row for layout */
            align-items: center; /* Vertically center content */
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.3s ease;
            border: 1px solid var(--border-color);
            position: relative; /* For positioning video icon */
        }
        .lesson-list-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }
        .lesson-list-item-left {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-right: 20px; /* Space between left and right content */
            flex-shrink: 0; /* Don't shrink logo/teacher area */
        }
        .lesson-list-item .pw-logo {
            width: 50px; /* Larger logo */
            height: 50px; /* Larger logo */
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--accent-teal); /* Highlight logo */
            margin-bottom: 8px; /* Space below logo */
        }
        .lesson-list-item .teacher-name {
            font-family: 'Open Sans', sans-serif;
            font-size: 0.8em;
            color: var(--text-light);
            text-align: center;
        }
        .lesson-list-item-right {
            flex-grow: 1; /* Allows text content to take remaining space */
            display: flex;
            flex-direction: column;
            text-align: left;
        }
        .lesson-list-item .lesson-list-item-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.3em;
            font-weight: 700;
            color: var(--text-dark);
            margin: 0 0 5px 0;
            line-height: 1.2;
        }
        .lesson-list-item .lesson-list-item-subtitle {
            font-family: 'Open Sans', sans-serif;
            font-size: 1em;
            color: var(--text-light);
            margin-bottom: 10px;
        }
        .lesson-list-item .lesson-meta {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 0.85em;
            color: var(--text-light);
        }
        .lesson-list-item .lesson-meta i {
            color: var(--accent-teal);
            margin-right: 5px;
        }
        .lesson-list-item .video-icon-overlay {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 2em;
            color: var(--error-red);
        }


        #video-player-view {
            display: none;
            padding: 0px;
            background-color: var(--player-bg-color);
            min-height: calc(100vh - 90px);
            transition: background-color 0.3s ease;
        }
        #video-player-view .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 0px;
            padding: 15px 20px;
            background-color: var(--player-bg-color);
            transition: background-color 0.3s ease;
        }
        #video-player-view .back-button {
            background-color: transparent;
            border: none;
            font-size: 2em;
            color: var(--text-dark);
            cursor: pointer;
            margin-right: 18px;
            transition: color 0.2s ease, transform 0.2s ease;
        }
        #video-player-view .back-button:hover {
            color: var(--accent-teal);
            transform: translateX(-5px);
        }
        #video-player-view h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.2em;
            font-weight: 700;
            color: var(--text-dark);
            margin: 0;
            flex-grow: 1;
            transition: color 0.3s ease;
        }

        .player-card-container {
            padding: 0px 20px 20px 20px;
        }

        .player-card {
            background-color: var(--player-section-bg);
            border-radius: var(--border-radius-card);
            box-shadow: var(--shadow-light);
            overflow: hidden;
            border: 1px solid var(--border-color);
            margin-bottom: 20px;
            transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .main-video-player {
            position: relative;
            padding-top: 56.25%;
            background-color: #000;
            display: block;
        }
        .main-video-player iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        .player-metadata {
            padding: 20px;
            background-color: var(--player-meta-bg);
            border-top: 1px solid var(--border-color);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        .player-metadata .lesson-sub-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8em;
            font-weight: 600;
            color: var(--text-dark);
            margin-top: 0;
            margin-bottom: 10px;
            text-align: center;
            transition: color 0.3s ease;
        }
        
        /* Removed Teacher & Meta info from player view */


        .player-action-buttons {
            display: flex;
            gap: 10px;
            padding: 0 20px 20px 20px;
        }
        .player-action-buttons .action-button {
            flex: 1;
            background-color: var(--button-primary);
            color: var(--white);
            border: none;
            border-radius: var(--border-radius-button);
            padding: 12px 10px;
            font-family: 'Montserrat', sans-serif;
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: var(--shadow-light);
            transition: background-color 0.2s ease, transform 0.2s ease, color 0.3s ease;
        }
        .player-action-buttons .action-button:hover {
            transform: translateY(-2px);
        }
        .player-action-buttons .action-button.timeline {
            background-color: var(--timeline-btn-bg);
        }
        .player-action-buttons .action-button.comments {
            background-color: var(--comments-btn-bg); /* This button is removed via JS but CSS remains */
        }
        .player-action-buttons .action-button.watch-later {
            background-color: var(--watch-later-btn-bg);
        }

        .lesson-list {
            list-style: none;
            padding: 0 20px;
            margin-top: 20px;
        }
        /* Player view lesson item is same as general lesson list item now */
        .lesson-item {
            background-color: #333333;
            border-radius: var(--border-radius-card);
            box-shadow: var(--shadow-light);
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.3s ease, border-color 0.3s ease;
        }
        .lesson-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }
        .lesson-item h3 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.3em;
            color: var(--text-dark);
            margin-top: 0;
            margin-bottom: 0;
            transition: color 0.3s ease;
        }

        /* --- Bottom Navigation Bar --- */
        .bottom-navbar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #1A1A1A;
            box-shadow: 0 -6px 20px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: space-around;
            padding: 15px 0;
            border-top-left-radius: var(--border-radius-main);
            border-top-right-radius: var(--border-radius-main);
            z-index: 1000;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }
        .nav-item {
            text-align: center;
            color: var(--text-light);
            font-size: 0.9em;
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 5px;
            transition: color 0.2s ease, transform 0.2s ease;
        }
        .nav-item i {
            font-size: 1.8em;
            margin-bottom: 8px;
            transition: color 0.2s ease;
        }
        .nav-item.active {
            color: var(--accent-teal);
            font-weight: 700;
        }
        .nav-item.active i {
            color: var(--accent-teal);
        }
        .nav-item:hover {
            color: var(--accent-teal);
        }
        .nav-item:active {
            transform: scale(0.95);
        }

        /* --- Popup Styles --- */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .popup-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .name-popup {
            background-color: #222222;
            padding: 40px;
            border-radius: var(--border-radius-main);
            box-shadow: var(--shadow-popup);
            text-align: center;
            width: 90%;
            max-width: 420px;
            opacity: 0;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.3s ease, background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        .popup-overlay.active .name-popup {
            transform: translateY(-50px);
            opacity: 1;
        }
        .name-popup h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2em;
            color: var(--text-dark);
            margin-bottom: 25px;
            font-weight: 700;
            transition: color 0.3s ease;
        }
        .name-popup p {
            font-size: 1.1em;
            color: var(--text-light);
            margin-bottom: 30px;
            transition: color 0.3s ease;
        }
        .name-popup .input-container {
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-input);
            padding: 12px 18px;
            margin-bottom: 25px;
            position: relative;
            background-color: #383838;
            transition: border-color 0.2s ease, background-color 0.3s ease;
        }
        .name-popup .input-container:focus-within {
            border-color: var(--accent-teal);
        }
        .name-popup input[type="text"] {
            width: 100%;
            padding: 10px 0;
            padding-top: 20px;
            border: none;
            background: transparent;
            font-family: 'Open Sans', sans-serif;
            font-size: 1.2em;
            color: var(--text-dark);
            outline: none;
            transition: color 0.3s ease;
        }
         .name-popup input[type="text"]:focus + label,
         .name-popup input[type="text"]:not(:placeholder-shown) + label {
            top: 5px;
            font-size: 0.7em;
            color: var(--accent-teal);
        }
        .name-popup .char-count {
            font-size: 0.85em;
            color: var(--text-light);
            text-align: right;
            margin-top: -15px;
            margin-bottom: 25px;
            transition: color 0.3s ease;
        }
        .name-popup .role-selection {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            font-family: 'Open Sans', sans-serif;
        }
        .name-popup .role-option {
            display: flex;
            align-items: center;
            background-color: #444;
            padding: 8px 15px;
            border-radius: var(--border-radius-button);
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.3s ease;
            font-size: 0.9em;
            color: var(--text-light);
        }
        .name-popup .role-option:hover {
            background-color: #555;
        }
        .name-popup input[type="radio"] {
            margin-right: 8px;
            accent-color: var(--accent-teal);
        }
        .name-popup button {
            background-color: var(--accent-teal);
            color: white;
            padding: 15px 35px;
            border: none;
            border-radius: var(--border-radius-button);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease, color 0.3s ease;
            box-shadow: var(--shadow-light);
        }
        .name-popup button:hover {
            background-color: #00939b;
            transform: translateY(-3px);
        }
        .popup-close-button {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 2em;
            color: var(--text-light);
            cursor: pointer;
            transition: color 0.2s ease;
        }
        .popup-close-button:hover {
            color: var(--text-dark);
        }

        .comments-popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .comments-popup-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .comments-popup {
            background-color: #222222;
            padding: 25px;
            border-radius: var(--border-radius-main);
            box-shadow: var(--shadow-popup);
            width: 90%;
            max-width: 500px;
            transform: translateY(20px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease, background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            display: flex;
            flex-direction: column;
            max-height: 80vh;
        }
        .comments-popup-overlay.active .comments-popup {
            transform: translateY(0);
            opacity: 1;
        }
        .comments-popup h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8em;
            color: var(--text-dark);
            margin-top: 0;
            margin-bottom: 20px;
            text-align: center;
            transition: color 0.3s ease;
        }
        .comments-input-area {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }
        .comments-input-area textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-input);
            font-family: 'Open Sans', sans-serif;
            font-size: 1em;
            min-height: 80px;
            resize: vertical;
            outline: none;
            transition: border-color 0.2s ease, background-color 0.3s ease, color 0.3s ease;
            background-color: #383838;
            color: var(--text-dark);
        }
        .comments-input-area textarea:focus {
            border-color: var(--comments-btn-bg);
        }
        .comments-input-area button {
            background-color: var(--comments-btn-bg);
            color: var(--white);
            border: none;
            border-radius: var(--border-radius-button);
            padding: 10px 15px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.3s ease;
        }
        .comments-input-area button:hover {
            background-color: #0056b3;
        }
        .comments-display-area {
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 10px;
            margin-bottom: 10px;
        }
        .comment-item {
            background-color: #383838;
            border-radius: var(--border-radius-input);
            padding: 10px;
            margin-bottom: 10px;
            font-size: 0.9em;
            border: 1px solid #555;
            color: var(--text-dark);
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }
        .comment-item strong {
            color: var(--primary-dark);
            margin-right: 5px;
            transition: color 0.3s ease;
        }
        .no-comments-message {
            text-align: center;
            color: var(--text-light);
            font-style: italic;
            transition: color 0.3s ease;
        }

        .coming-soon-section {
            display: none;
            text-align: center;
            padding: 50px 20px;
            background-color: #333333;
            border-radius: var(--border-radius-main);
            box-shadow: var(--shadow-medium);
            margin-top: 30px;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 300px;
            border: 1px solid var(--border-color);
            color: var(--text-dark);
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .coming-soon-section h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.5em;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 20px;
            transition: color 0.3s ease;
        }
        .coming-soon-section p {
            font-size: 1.3em;
            color: var(--text-light);
            margin-bottom: 30px;
            line-height: 1.5;
            transition: color 0.3s ease;
        }
        .coming-soon-section .emoji {
            font-size: 3em;
            margin-top: 20px;
            animation: bounce 1s infinite alternate;
        }

        @keyframes bounce {
            0% { transform: translateY(0); }
            100% { transform: translateY(-10px); }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.08); }
            100% { transform: scale(1); }
        }

        @keyframes fadeInSlideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        body.animate-in {
            animation: fadeInSlideUp 0.8s ease-out forwards;
        }

        @keyframes popupEnter {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(50px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        .popup-overlay.active .name-popup {
            animation: popupEnter 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .hidden-on-scroll {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }

        .visible-on-scroll {
            opacity: 1;
            transform: translateY(0);
        }

        .offline-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            color: white;
            font-size: 1.5em;
            text-align: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .offline-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .offline-overlay i {
            font-size: 3em;
            margin-bottom: 20px;
            color: #FFC107;
        }
        .offline-overlay p {
            margin: 0;
            padding: 0 20px;
        }
        .offline-overlay .reload-button {
            background-color: var(--accent-teal);
            color: var(--white);
            border: none;
            border-radius: var(--border-radius-button);
            padding: 10px 20px;
            margin-top: 20px;
            cursor: pointer;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            transition: background-color 0.2s ease;
        }
        .offline-overlay .reload-button:hover {
            background-color: #00939b;
        }

        #about-me-view {
            display: none;
            flex-direction: column;
            padding: 20px;
            min-height: calc(100vh - 90px);
            background-color: var(--secondary-light);
            align-items: center;
            text-align: center;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        #about-me-view .section-header {
            display: flex;
            align-items: center;
            width: 100%;
            margin-bottom: 25px;
        }
        #about-me-view .back-button {
            background-color: transparent;
            border: none;
            font-size: 2em;
            color: var(--text-dark);
            cursor: pointer;
            margin-right: 18px;
            transition: color 0.2s ease, transform 0.2s ease;
        }
        #about-me-view .back-button:hover {
            color: var(--accent-teal);
            transform: translateX(-5px);
        }
        #about-me-view h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.2em;
            font-weight: 700;
            color: var(--text-dark);
            margin: 0;
            flex-grow: 1;
            transition: color 0.3s ease;
        }
        .about-me-card {
            background-color: #333333;
            border-radius: var(--border-radius-main);
            box-shadow: var(--shadow-medium);
            padding: 30px;
            width: 100%;
            max-width: 500px;
            margin-top: 20px;
            border: 1px solid var(--border-color);
            transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .about-me-card .profile-pic {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 20px;
            border: 4px solid var(--accent-teal);
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }
        .about-me-card h3 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8em;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 10px;
            transition: color 0.3s ease;
        }
        .about-me-card p {
            font-size: 1.1em;
            color: var(--text-light);
            margin-bottom: 25px;
            line-height: 1.6;
            transition: color 0.3s ease;
        }
        .social-links {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 20px;
        }
        .social-link {
            font-size: 2.5em;
            color: var(--text-light);
            transition: color 0.2s ease, transform 0.2s ease;
        }
        .social-link:hover {
            transform: translateY(-5px);
        }
        .social-link.telegram:hover { color: #0088cc; }
        .social-link.instagram:hover {
            background: radial-gradient(circle at 30% 107%, #fdf497 0%, #fdf497 5%, #fd5949 45%, #d6249f 60%, #285AEB 90%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .social-link.youtube:hover { color: #FF0000; }

        #how-to-use-app-view {
            display: none;
            flex-direction: column;
            padding: 20px;
            min-height: calc(100vh - 90px);
            background-color: var(--secondary-light);
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        #how-to-use-app-view .section-header {
            display: flex;
            align-items: center;
            width: 100%;
            margin-bottom: 25px;
        }
        #how-to-use-app-view .back-button {
            background-color: transparent;
            border: none;
            font-size: 2em;
            color: var(--text-dark);
            cursor: pointer;
            margin-right: 18px;
            transition: color 0.2s ease, transform 0.2s ease;
        }
        #how-to-use-app-view .back-button:hover {
            color: var(--accent-teal);
            transform: translateX(-5px);
        }
        #how-to-use-app-view h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.2em;
            font-weight: 700;
            color: var(--text-dark);
            margin: 0;
            flex-grow: 1;
            transition: color 0.3s ease;
        }
        #how-to-use-app-view .video-container {
            position: relative;
            width: 100%;
            padding-top: 56.25%; /* 16:9 Aspect Ratio */
            background-color: #000;
            border-radius: var(--border-radius-card);
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: var(--shadow-medium);
        }
        #how-to-use-app-view .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }
        #how-to-use-app-view p {
            font-size: 1.1em;
            color: var(--text-light);
            line-height: 1.6;
            margin-top: 0;
            transition: color 0.3s ease;
        }
        
        .share-app-button {
            background-color: #007bff;
            color: var(--white);
            padding: 15px 25px;
            border-radius: var(--border-radius-button);
            text-align: center;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.2em;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease, color 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: var(--shadow-medium);
            margin-top: 30px;
            margin-bottom: 30px;
        }

        .share-app-button:hover {
            background-color: #0056b3;
            transform: translateY(-3px);
        }

        .share-app-button i {
            font-size: 1.5em;
        }

        @media (max-width: 768px) {
            .top-navbar { padding: 12px 15px; }
            .top-navbar .app-logo .main-title { font-size: 1.3em; } /* Adjusted for mobile */
            .top-navbar .app-logo .tagline { font-size: 0.6em; } /* Adjusted for mobile */
            .top-navbar .app-logo img#skillNeastLogo { height: 30px; } /* Adjusted for mobile */
            .top-navbar .menu-icon, .top-navbar .telegram-icon {
                width: 44px; /* Smaller for mobile */
                height: 44px; /* Smaller for mobile */
                font-size: 1.6em;
            }
            .top-navbar .menu-icon { margin-right: 5px; }
            .top-navbar .telegram-icon { margin-left: 5px; }
            .top-navbar .app-logo {
                padding: 5px 10px; /* Adjusted padding for mobile */
                margin: 0 5px; /* Smaller margin for mobile */
            }


            .welcome-banner { padding: 20px; }
            .welcome-banner .greeting { font-size: 1.4em; }
            .welcome-banner .fire-icon { font-size: 1.8em; }
            .quote-section { padding: 20px; }
            .quote-section .quote-text { font-size: 0.95em; }
            #home-view { gap: 20px; }
            .course-category-item { min-height: 160px; }
            .course-category-item .image-container img { padding: 5px; }
            .course-category-item .content-overlay { padding: 10px; }
            .course-category-item .category-name { font-size: 0.95em; }

            .favorites-section-home-card { padding: 20px; margin-top: 20px; }
            .favorites-section-home-card h2 { font-size: 1.6em; }
            .favorites-section-home-card .fav-icon { font-size: 2.5em; }
            .favorites-section-home-card p { font-size: 0.9em; }
            .favorites-section-home-card .fav-count { font-size: 1.1em; }

            #new-batches-view .section-header h2 { font-size: 1.8em; }
            .search-bar-container { padding: 5px 10px; }
            .search-bar-container input { padding: 6px 8px; }
            .search-bar-container .search-button { padding: 8px 15px; font-size: 0.8em; }
            .batch-card-body .batch-title { font-size: 1.4em; }
            .batch-card-body .lets-roar-button { padding: 12px 20px; font-size: 1em; }
            .batch-card-body .batch-image-container {
                height: 160px;
            }

            #favorites-view .section-header h2 { font-size: 1.8em; }
            .promotional-banner { padding: 12px 15px; font-size: 0.8em; }
            .promotional-banner .promo-text { font-size: 1em; }


            #video-player-view .section-header h2 { font-size: 1.8em; }
            .player-card-container { padding: 0 15px 15px 15px; }
            .player-card { margin-bottom: 15px; }
            .player-metadata { padding: 15px; }
            .player-metadata .lesson-sub-title { font-size: 1.5em; text-align: center; }
            .player-action-buttons { flex-wrap: wrap; justify-content: center;
            padding: 0 15px 15px 15px; }
            .player-action-buttons .action-button { flex: unset;
            width: 48%; margin-bottom: 10px; padding: 10px 8px; font-size: 0.8em; }
            .player-action-buttons .action-button i { margin-right: 5px; }


            .bottom-navbar { padding: 12px 0; }
            .nav-item { font-size: 0.8em; }
            .nav-item i { font-size: 1.6em; }

            .name-popup { padding: 30px; }
            .name-popup h2 { font-size: 1.6em; }
            .name-popup p { font-size: 1em;
            margin-bottom: 20px;}
            .name-popup input { font-size: 1.1em; padding-top: 15px; }
            .name-popup label { top: 6px; font-size: 0.8em; }
            .name-popup button { font-size: 1.05em; padding: 12px 25px; }

            .comments-popup { max-width: 95%;
            padding: 20px; }
            .comments-popup h2 { font-size: 1.5em; }

            .coming-soon-section h2 { font-size: 2em; }
            .coming-soon-section p { font-size: 1.1em; }
            .coming-soon-section .emoji { font-size: 2.5em; }

            #about-me-view {
                padding: 15px;
            }
            .about-me-card {
                padding: 25px;
            }
            .about-me-card .profile-pic {
                width: 100px;
                height: 100px;
            }
            .about-me-card h3 {
                font-size: 1.5em;
            }
            .about-me-card p {
                font-size: 1em;
            }
            .social-link {
                font-size: 2em;
            }
            
            #how-to-use-app-view h2 { font-size: 1.8em; }
            #how-to-use-app-view p { font-size: 0.95em; }
        }

        .slider-menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1500;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease;
        }

        .slider-menu-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .slider-menu {
            position: fixed;
            top: 0;
            left: -250px;
            width: 250px;
            height: 100%;
            background-color: var(--slider-bg);
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.5);
            z-index: 1600;
            transition: left 0.3s ease-in-out, background-color 0.3s ease;
            display: flex;
            flex-direction: column;
            padding-top: 20px;
            box-sizing: border-box;
            overflow-y: auto;
            padding-bottom: 20px;
        }

        .slider-menu.active {
            left: 0;
        }

        .slider-header {
            padding: 20px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid var(--slider-border-color);
            margin-bottom: 10px;
            font-family: 'Comfortaa', sans-serif;
            transition: border-color 0.3s ease;
        }

        .slider-header img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 15px;
            object-fit: cover;
            border: 2px solid var(--accent-teal);
            box-shadow: 0 0 8px rgba(0, 173, 181, 0.3);
        }

        .slider-header h3 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.5em;
            font-weight: 700;
            color: var(--accent-teal);
            margin: 0;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
            transition: color 0.3s ease;
        }

        .slider-menu-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            color: var(--slider-text-color);
            text-decoration: none;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.05em;
            transition: background-color 0.2s ease, transform 0.2s ease, color 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .slider-menu-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 173, 181, 0.1), transparent);
            transition: left 0.3s ease-out;
        }

        .slider-menu-item:hover::before {
            left: 0;
        }

        .slider-menu-item:hover {
            background-color: var(--slider-item-hover);
            transform: translateX(5px);
        }

        .slider-menu-item i {
            font-size: 1.6em;
            margin-right: 15px;
            color: var(--slider-icon-color);
            transition: color 0.2s ease;
        }

        .slider-menu-item:hover i {
            color: var(--highlight-gold);
        }

        .slider-menu-item .item-text {
            flex-grow: 1;
            font-weight: 500;
        }

        .slider-menu-item .coming-soon-tag {
            background-color: #FFC107;
            color: #333;
            font-size: 0.7em;
            font-weight: 700;
            padding: 3px 8px;
            border-radius: 10px;
            margin-left: 10px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .slider-footer {
            margin-top: auto;
            padding: 15px 20px;
            text-align: center;
            border-top: 1px solid var(--slider-border-color);
            font-size: 0.85em;
            color: var(--text-light);
            font-family: 'Open Sans', sans-serif;
            line-height: 1.5;
            transition: border-color 0.3s ease, color 0.3s ease;
        }

        .slider-footer .version {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--text-dark);
            font-size: 0.9em;
            transition: color 0.3s ease;
        }
        
        .dark-mode-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            color: var(--slider-text-color);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.05em;
            cursor: pointer;
            border-top: 1px solid var(--slider-border-color);
            margin-top: 10px;
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        .dark-mode-toggle i {
            font-size: 1.6em;
            margin-right: 15px;
            color: var(--slider-icon-color);
            transition: color 0.3s ease;
        }
        .switch {
            position: relative;
            display: inline-block;
            width: 45px;
            height: 25px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider-round {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #555;
            transition: .4s;
            border-radius: 25px;
        }
        .slider-round:before {
            position: absolute;
            content: "";
            height: 19px;
            width: 19px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider-round {
            background-color: var(--accent-teal);
        }
        input:checked + .slider-round:before {
            transform: translateX(20px);
        }

        /* Modal for Batch Details (AI Overview, now removed from general flow) */
        .batch-detail-modal-overlay {
            display: none; /* Hide by default, only shown via specific function calls if needed */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            justify-content: center;
            align-items: center;
            z-index: 2500;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .batch-detail-modal-overlay.active {
            opacity: 1;
            visibility: visible;
            display: flex; /* Show when active */
        }
        .batch-detail-modal-content {
            background-color: var(--player-section-bg);
            padding: 30px;
            border-radius: var(--border-radius-main);
            box-shadow: var(--shadow-popup);
            width: 90%;
            max-width: 600px;
            position: relative;
            transform: translateY(20px);
            opacity: 0;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
            border: 1px solid var(--border-color);
            color: var(--text-dark);
            max-height: 90vh;
            overflow-y: auto;
        }
        .batch-detail-modal-overlay.active .batch-detail-modal-content {
            transform: translateY(0);
            opacity: 1;
        }
        .batch-detail-modal-content .close-button {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 2em;
            color: var(--text-light);
            cursor: pointer;
            transition: color 0.2s ease;
        }
        .batch-detail-modal-content .close-button:hover {
            color: var(--text-dark);
        }
        .batch-detail-modal-content h3 {
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8em;
            font-weight: 700;
            margin-bottom: 15px;
            text-align: center;
            color: var(--text-dark);
        }
        .batch-detail-modal-content img {
            max-width: 100%;
            height: auto;
            border-radius: var(--border-radius-card);
            margin-bottom: 20px;
        }
        .batch-detail-modal-content .modal-description, .batch-detail-modal-content .modal-overview {
            font-size: 1em;
            line-height: 1.6;
            color: var(--text-light);
            margin-bottom: 20px;
            text-align: justify;
        }
        .batch-detail-modal-content .generate-overview-btn {
            background-color: var(--accent-teal);
            color: var(--white);
            padding: 10px 20px;
            border: none;
            border-radius: var(--border-radius-button);
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease;
            margin-top: 10px;
            display: block;
            width: fit-content;
            margin-left: auto;
            margin-right: auto;
        }
        .batch-detail-modal-content .generate-overview-btn:hover {
            background-color: #00939b;
            transform: translateY(-2px);
        }
        .batch-detail-modal-content .loading-overview {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 15px;
            color: var(--text-light);
        }
        .batch-detail-modal-content .loading-overview .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--accent-teal);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

    <div class="offline-overlay" id="offlineOverlay">
        <i class="fas fa-wifi"></i>
        <p>You are offline. Please check your internet connection.</p>
        <button class="reload-button" onclick="location.reload()">Retry Connection</button>
    </div>

    <!-- Name Popup (for first-time users) -->
    <div class="popup-overlay" id="namePopupOverlay">
        <div class="name-popup">
            <button class="popup-close-button" onclick="window.closeNamePopup()">×</button>
            <h2>Welcome to SkillNeast!</h2>
            <p>Please tell us your name and what you do to personalize your experience.</p>
            <div class="input-container">
                <label for="userNameInput" style="position: absolute; top: 12px; left: 18px; font-size: 0.9em; color: var(--text-light); transition: all 0.2s ease;">Enter Your Name</label>
                <input type="text" id="userNameInput" placeholder=" " maxlength="15" onkeyup="window.updateCharCount()">
            </div>
            <div class="char-count"><span id="currentCharCount">0</span>/15</div>
            <div class="role-selection">
                <label class="role-option"><input type="radio" name="userRole" value="Editor"> Editor ✂️</label>
                <label class="role-option"><input type="radio" name="userRole" value="Programmer"> Programmer 💻</label>
                <label class="role-option"><input type="radio" name="userRole" value="Content Creator"> Content Creator 🎬</label>
                <label class="role-option"><input type="radio" name="userRole" value="Music Artist"> Music Artist 🎶</label>
                <label class="role-option"><input type="radio" name="userRole" value="Other" checked> Other ✨</label>
            </div>
            <button onclick="window.submitName()">START LEARNING</button>
        </div>
    </div>

    <!-- This modal is now unused in the main flow, but kept in case you want to use it for other purposes -->
    <div class="batch-detail-modal-overlay" id="batchDetailModalOverlay">
        <div class="batch-detail-modal-content">
            <button class="close-button" onclick="window.closeBatchDetailModal()">×</button>
            <h3 id="modalBatchTitle"></h3>
            <img id="modalBatchImage" src="" alt="Batch Image" />
            <p id="modalBatchDescription" class="modal-description"></p>
            <button class="generate-overview-btn" id="generateOverviewBtn">Generate AI Overview ✨</button>
            <div id="loadingOverview" class="loading-overview" style="display: none;">
                <div class="spinner"></div>
                <span>Generating overview...</span>
            </div>
            <p id="generatedOverview" class="modal-overview"></p>
        </div>
    </div>

    <div class="comments-popup-overlay" id="commentsPopupOverlay">
        <div class="comments-popup">
            <button class="popup-close-button" onclick="window.closeCommentsPopup()">×</button>
            <h2 id="commentsHeader">SR Comments</h2>
            <div class="comments-input-area">
                <textarea id="commentInput" placeholder="Write your comment here..."></textarea>
                <button onclick="window.postComment()">Post Comment</button>
            </div>
            <div class="comments-display-area" id="commentsDisplayArea">
                <p class="no-comments-message">No comments yet. Be the first to comment!</p>
            </div>
        </div>
    </div>

    <div class="top-navbar">
        <div class="menu-icon" onclick="window.openSliderMenu()"><i class="fas fa-bars"></i></div>
        <div class="app-logo" id="appLogo">
            <img src="https://via.placeholder.com/40x40/00ADB5/ffffff?text=SN" alt="SkillNeast Logo" draggable="false" id="skillNeastLogo">
            <div class="text-wrapper"> <!-- Added text wrapper -->
                <span class="main-title">SKILLNEAST</span>
                <span class="tagline">Master New Skill 🚀💡</span>
            </div>
        </div>
        <div class="telegram-icon" onclick="window.open('YOUR_TELEGRAM_GROUP_LINK', '_blank');"><i class="fab fa-telegram-plane"></i></div>
    </div>

    <div class="main-content">

        <div class="welcome-banner">
            <span class="greeting"><i class="fas fa-heart"></i> Welcome <span id="displayedUserName">Guest</span></span>
            <span class="fire-icon"><i class="fas fa-fire"></i></span>
            <span class="role-sticker" id="displayedUserRole" style="display: none;"></span>
        </div>

        <div class="quote-section">
            <p class="quote-text" id="quoteText"></p>
            <p class="quote-author" id="quoteAuthor"></p>
        </div>

        <div id="home-view">
            <!-- Categories will be loaded here dynamically from Firebase -->
            <p class="text-center text-muted col-span-full" id="loadingCategoriesMessage">Loading categories...</p>

            <!-- Favorites Section (ONLY on Home Page - moved inside home-view) -->
            <div class="favorites-section-home-card" onclick="window.showFavoritesView()" id="favorites-section-home-card">
                <i class="fas fa-heart fav-icon"></i>
                <h2>My Favorite Batches</h2>
                <p>Explore SkillNeast! Your ultimate hub for mastering new skills with engaging courses, expert instructors, and a vibrant community. Dive into learning, track your progress, and unlock your full potential! 🌟 More exciting features coming soon! 🚀</p>
                <span class="fav-count" id="favorites-count">0 Batches</span>
            </div>

            <!-- Removed partitions -->

            <div class="telegram-card" onclick="window.open('YOUR_TELEGRAM_GROUP_LINK', '_blank');">
                <i class="fab fa-telegram-plane telegram-icon-large"></i>
                <span class="telegram-text">Join Our Telegram Community!</span>
            </div>
            
            <button class="share-app-button" onclick="window.shareApp()">
                <i class="fas fa-share-alt"></i> Share with your Friends
            </button>
        </div>

        <div id="new-batches-view" style="display: none;">
            <div class="section-header">
                <button class="back-button" onclick="window.showHomeView()"><i class="fas fa-arrow-left"></i></button>
                <h2 id="new-batches-title">All Courses</h2>
            </div>
            <div class="search-bar-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" id="batchSearchInput" placeholder="Search by batch name" onkeyup="window.filterBatches()">
                <button class="search-button" onclick="window.filterBatches()">Search</button>
            </div>
            <div class="batch-list" id="batches-container">
                <!-- Batches will be loaded here dynamically -->
                <p class="text-center text-muted" id="loadingBatchesMessage">Loading batches...</p>
            </div>
        </div>

        <div id="favorites-view" style="display: none;">
            <div class="section-header">
                <button class="back-button" onclick="window.showHomeView()"><i class="fas fa-arrow-left"></i></button>
                <h2>Favourite Batches</h2>
            </div>
            <div class="batch-list" id="favorite-batches-container">
            </div>
            <p id="no-favorites-message-view" class="no-favorites-message-view" style="display: none;">You haven't favorited any batches yet. Click the heart icon on any batch to add it here!</p>
        </div>

        <div id="sections-view" style="display: none;">
            <div class="section-header">
                <button class="back-button" onclick="window.showNewBatchesView(window.lastCategoryViewed)"><i class="fas fa-arrow-left"></i></button>
                <h2 id="sections-title"></h2>
            </div>
            <div class="sections-container" id="sections-container">
            </div>
        </div>

        <div id="lessons-in-sections-view" style="display: none;">
            <div class="section-header">
                <button class="back-button" onclick="window.goBackFromLessonsList()"><i class="fas fa-arrow-left"></i></button>
                <h2 id="lessons-in-sections-title"></h2>
            </div>
            <div class="lesson-list-container" id="lessons-in-sections-container">
            </div>
        </div>

        <div id="video-player-view" style="display: none;">
            <div class="section-header">
                <button class="back-button" onclick="window.goBackFromPlayerView()"><i class="fas fa-arrow-left"></i></button>
                <h2 id="player-view-title"></h2>
            </div>
            
            <div class="player-card-container">
                <div class="player-card">
                    <div class="main-video-player" id="main-video-player">
                    </div>
                    <div class="player-metadata">
                        <h3 class="lesson-sub-title" id="player-lesson-sub-title"></h3>
                        <!-- Removed player-lesson-meta-info div entirely -->
                    </div>
                </div>
            </div>

            <div class="player-action-buttons">
                <button class="action-button timeline"><i class="fas fa-stream"></i> Timeline</button>
                <button class="action-button comments" onclick="window.showCommentsPopup()"><i class="fas fa-comments"></i> SR Comments</button>
                <button class="action-button watch-later"><i class="fas fa-bookmark"></i> Watch Later</button>
            </div>
            
            <ul class="lesson-list" id="lessons-for-player-batch">
            </ul>
        </div>

        <div id="bundles-coming-soon-view" class="coming-soon-section" style="display: none;">
            <i class="emoji">🎁</i>
            <h2>Bundles Coming Soon!</h2>
            <p>Exciting new course bundles are on their way. Stay tuned for amazing deals and curated learning paths!</p>
        </div>

        <div id="pdfs-coming-soon-view" class="coming-soon-section" style="display: none;">
            <i class="emoji">📄</i>
            <h2>PDFs Coming Soon!</h2>
            <p>We're preparing a comprehensive library of downloadable PDFs and study materials for you. Check back soon!</p>
        </div>

        <div id="ai-chatbot-coming-soon-view" class="coming-soon-section" style="display: none;">
            <i class="emoji">🤖</i>
            <h2>Neast Bro (AI Chatbot) Coming Soon!</h2>
            <p>Get ready for personalized assistance! Our AI Chatbot, Neast Bro, is under development to help you with your learning journey. Stay tuned for its launch! 🚀</p>
        </div>

        <div id="about-me-view" style="display: none;">
            <div class="section-header">
                <button class="back-button" onclick="window.showHomeView()"><i class="fas fa-arrow-left"></i></button>
                <h2>About Me</h2>
            </div>
            <div class="about-me-card">
                <img src="https://via.placeholder.com/120x120/00ADB5/ffffff?text=Fahad" alt="Fahad Profile" draggable="false">
                <h3>Hello, I'm Fahad! 👋</h3>
                <p>I'm 16 years old and currently learning in Class 11 with PCM (Physics, Chemistry, Maths) stream. Skills abhi kuch nahi hain, but har roz kuch naya seekh raha hoon! Learning is my journey. 😊</p>
                <div class="social-links">
                    <a href="YOUR_TELEGRAM_GROUP_LINK" target="_blank" class="social-link telegram"><i class="fab fa-telegram-plane"></i></a>
                    <a href="YOUR_INSTAGRAM_PROFILE_LINK" target="_blank" class="social-link instagram"><i class="fab fa-instagram"></i></a>
                    <a href="YOUR_YOUTUBE_CHANNEL_LINK" target="_blank" class="social-link youtube"><i class="fab fa-youtube"></i></a>
                </div>
            </div>
        </div>

        <div id="how-to-use-app-view" style="display: none;">
            <div class="section-header">
                <button class="back-button" onclick="window.showHomeView()"><i class="fas fa-arrow-left"></i></button>
                <h2>How to use the App</h2>
            </div>
            <div class="video-container">
                <iframe src="https://www.youtube-nocookie.com/embed/YOUR_YOUTUBE_TUTORIAL_VIDEO_ID" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
            <p>Welcome to SkillNeast! This video will guide you through all the features of our app, from navigating courses to managing your favorites and interacting with our community.</p>
            <p>If you have any further questions, feel free to reach out to us through the Telegram community link in the menu!</p>
        </div>
    </div> 
  
    <div class="bottom-navbar">
        <a href="#" class="nav-item" id="courses-nav" onclick="window.showNewBatchesView('all'); window.highlightBottomNav('courses-nav')"><i class="fas fa-book-open"></i> Courses</a>
        <a href="#" class="nav-item" id="bundles-nav" onclick="window.showComingSoonView('bundles'); window.highlightBottomNav('bundles-nav');"><i class="fas fa-boxes"></i> Bundles</a>
        <a href="#" class="nav-item active" id="home-nav" onclick="window.showHomeView(); window.highlightBottomNav('home-nav')"><i class="fas fa-home"></i> Home</a>
        <a href="#" class="nav-item" id="pdfs-nav" onclick="window.showComingSoonView('pdfs'); window.highlightBottomNav('pdfs-nav');"><i class="fas fa-file-pdf"></i> PDFs</a>
        <a href="#" class="nav-item" id="about-me-nav" onclick="window.showAboutMeView(); window.highlightBottomNav('about-me-nav');"><i class="fas fa-user-circle"></i> About Me</a>
    </div>

    <!-- Slider Menu -->
    <div class="slider-menu-overlay" id="sliderMenuOverlay" onclick="window.closeSliderMenu()"></div>
    <div class="slider-menu" id="sliderMenu">
        <div class="slider-header">
            <img src="https://via.placeholder.com/50x50/00ADB5/ffffff?text=SN" alt="SkillNeast Logo">
            <h3>SkillNeast</h3>
        </div>
        
        <a href="#" class="slider-menu-item" onclick="window.showComingSoonView('ai-chatbot'); window.closeSliderMenu();">
            <i class="fas fa-robot"></i> <span class="item-text">Neast Bro (AI Chatbot)</span> <span class="coming-soon-tag">Coming Soon</span>
        </a>
        <a href="#" class="slider-menu-item" onclick="window.showAboutMeView(); window.closeSliderMenu();">
            <i class="fas fa-user-circle"></i> <span class="item-text">About Me</span>
        </a>
        <a href="#" class="slider-menu-item" onclick="window.showFavoritesView(); window.closeSliderMenu();">
            <i class="fas fa-heart"></i> <span class="item-text">Favorite Batches</span>
        </a>
        <a href="YOUR_TELEGRAM_CHANNEL_LINK" target="_blank" class="slider-menu-item">
            <i class="fab fa-telegram-plane"></i> <span class="item-text">Join Telegram Channel</span>
        </a>
        <a href="YOUR_TELEGRAM_GROUP_LINK" target="_blank" class="slider-menu-item">
            <i class="fab fa-telegram-plane"></i> <span class="item-text">Join Telegram Group</span>
        </a>
        <a href="#" class="slider-menu-item" onclick="alert('Request Courses functionality coming soon!'); window.closeSliderMenu();">
            <i class="fas fa-hand-paper"></i> <span class="item-text">Request Courses</span>
        </a>
        <a href="#" class="slider-menu-item" onclick="window.showHowToUseAppView(); window.closeSliderMenu();">
            <i class="fas fa-question-circle"></i> <span class="item-text">How to use the App</span>
        </a>
        <a href="#" class="slider-menu-item" onclick="window.shareApp(); window.closeSliderMenu();">
            <i class="fas fa-share-alt"></i> <span class="item-text">Share with your Friends</span>
        </a>

        <div class="dark-mode-toggle" onclick="window.toggleDarkMode()">
            <i class="fas fa-moon"></i> <span>Dark Mode</span>
            <label class="switch">
                <input type="checkbox" id="darkModeToggleSwitch">
                <span class="slider-round"></span>
            </label>
        </div>
        
        <div class="slider-footer">
            <div class="version">App Version: v1.0.0 (G.O.A.T)</div>
            Made with ❤️ in INDIA 🇮🇳
        </div>
    </div>

    <script type="module">
        // Firebase configuration (from firebase-client-config.js)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
        import { getDatabase, ref, onValue, push, set, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
        import { getFirestore, collection, query, where, addDoc, getDocs, onSnapshot } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";


        const firebaseConfig = {
            apiKey: "AIzaSyChwpbFb6M4HtG6zwjg0AXh7Lz9KjnrGZk",
            authDomain: "adminneast.firebaseapp.com",
            databaseURL: "https://adminneast-default-rtdb.firebaseio.com",
            projectId: "adminneast",
            storageBucket: "adminneast.firebasestorage.app",
            messagingSenderId: "883877553418",
            appId: "1:883877553418:web:84ce8200f4b471bfffc6f3",
            measurementId: "G-PCH99BDF1S"
        };
        const app = initializeApp(firebaseConfig);
        const rtdb = getDatabase(app); // Renamed for Realtime Database
        const auth = getAuth(app);
        const firestore = getFirestore(app); // Initialized Firestore

        // API Key for Gemini (Canvas will automatically provide the API key)
        const API_KEY = ""; 

        // Current user ID for Firestore operations
        let currentUserId = null;


        // Authenticate Firebase (anonymous for public site)
        const authenticateFirebase = async () => {
            try {
                if (typeof __initial_auth_token !== 'undefined') {
                    const userCredential = await signInWithCustomToken(auth, __initial_auth_token);
                    currentUserId = userCredential.user.uid;
                    console.log("Public site: Signed in with custom token. UID:", currentUserId);
                } else {
                    const userCredential = await signInAnonymously(auth);
                    currentUserId = userCredential.user.uid;
                    console.log("Public site: Signed in anonymously. UID:", currentUserId);
                }
            } catch (error) {
                console.error("Public site Firebase authentication error:", error);
                // Display user-friendly message for Firebase auth issues
                alert("Firebase Authentication Error: Could not connect to courses. Please check your Firebase configuration and network. If you are hosting this app, ensure your domain is added to Firebase Authorized Domains. Error: " + error.message);
            }
        };

        // --- Data Structure for Quotes (moved to JS for dynamic updates) ---
        const quotes = [
            { quote: "The only way to do great work is to love what you do.", author: "Steve Jobs" },
            { quote: "Success is not final, failure is not fatal: It is the courage to continue that counts.", author: "Winston Churchill" },
            { quote: "Believe you can and you're halfway there.", author: "Theodore Roosevelt" },
            { quote: "The future belongs to those who believe in the beauty of their dreams.", author: "Eleanor Roosevelt" },
            { quote: "The mind is everything. What you think you become.", author: "Buddha" },
            { quote: "The best way to predict the future is to create it.", author: "Peter Drucker" },
            { quote: "It always seems impossible until it's done.", author: "Nelson Mandela" },
            { quote: "Don't wish it were easier, wish you were better.", author: "Jim Rohn" },
            { quote: "The expert in anything was once a beginner.", author: "Helen Hayes" },
            { quote: "Education is the most powerful weapon which you can use to change the world.", author: "Nelson Mandela" },
            { quote: "Strive not to be a success, but rather to be of value.", author: "Albert Einstein" },
            { quote: "The best revenge is massive success.", author: "Frank Sinatra" },
            { quote: "The greatest glory in living lies not in never falling, but in rising every time we fall.", author: "Nelson Mandela" },
            { quote: "The journey of a thousand miles begins with a single step.", author: "Lao Tzu" },
            { quote: "What you get by achieving your goals is not as important as what you become by achieving your goals.", author: "Zig Ziglar" },
            { quote: "The mind is not a vessel to be filled, but a fire to be kindled.", author: "Plutarch" },
            { quote: "Limitations live only in our minds. But if we use our imaginations, our possibilities become limitless.", author: "Jamie Paolinetti" },
            { quote: "Innovation distinguishes between a leader and a follower.", author: "Steve Jobs" },
            { quote: "The harder you work for something, the greater you'll feel when you achieve it.", author: "Unknown" },
            { quote: "Dreams don't work unless you do.", author: "John C. Maxwell" },
            { quote: "Success is walking from failure to failure with no loss of enthusiasm.", author: "Winston Churchill" },
            { quote: "I find that the harder I work, the more luck I seem to have.", author: "Thomas Jefferson" },
            { quote: "The only place where success comes before work is in the dictionary.", author: "Vidal Sassoon" },
            { quote: "Quality is not an act, it is a habit.", author: "Aristotle" },
            { quote: "To be the best, you must be able to handle the worst.", author: "Wilson Kanadi" },
            { quote: "Opportunities don't happen, you create them.", author: "Chris Grosser" },
            { quote: "There are no shortcuts to any place worth going.", author: "Beverly Sills" },
            { quote: "The future depends on what you do today.", author: "Mahatma Gandhi" },
            { quote: "Push yourself, because no one else is going to do it for you.", author: "Unknown" },
            { quote: "Great things never came from comfort zones.", author: "Unknown" },
            { quote: "Success is the sum of small efforts repeated day in and day out.", author: "Robert Collier" },
            { quote: "The expert in anything was once a beginner.", author: "Helen Hayes" },
            { quote: "Don’t count the days, make the days count.", author: "Muhammad Ali" },
            { quote: "The secret of getting ahead is getting started.", author: "Mark Twain" },
            { quote: "You don’t have to be great to start, but you have to start to be great.", author: "Zig Ziglar" },
            { quote: "The only limit to our realization of tomorrow will be our doubts of today.", author: "Franklin D. Roosevelt" },
            { quote: "If you are not willing to risk the usual, you will have to settle for the ordinary.", author: "Jim Rohn" },
            { quote: "The starting point of all achievement is desire.", author: "Napoleon Hill" },
            { quote: "It’s not whether you get knocked down, it’s whether you get up.", author: "Vince Lombardi" },
            { quote: "Your time is limited, don't waste it living someone else's life.", author: "Steve Jobs" }
        ];
        const allEmojis = [
            '✨', '🚀', '💡', '🌟', '💪', '🔥', '💖', '🎓', '📚', '🎯', '💯', '🌈', '🤩', '🏆', '📈', '🧠', '🧩', '🌱', '✅', '👑',
            '🎉', '💫', '🌠', '🔮', '💎', '🔑', '🔓', '🖋️', '📖', '🧑‍🎓', '💻', '🎼', '🎬', '🎨', '⚙️', '📊', '🌐', '🗺️', '🧭', '🌟',
            '💡', '✨', '⚡', '💥', '🔥', '🌈', '💎', '🔑', '🏆', '💯', '🚀', '🧠', '📚', '🎓', '💻', '📈', '🗺️', '🌐', '🎯', '💡',
            '🌟', '🚀', '✨', '🔥', '💖', '💪', '🌱', '🌈', '💯', '🏆', '🧠', '📚', '🎯', '🎉', '💫', '🌠', '🔮', '💎', '🔑', '🔓',
            '🤩', '🧑‍🎓', '💻', '🎼', '🎬', '🎨', '⚙️', '📊', '🌐', '🗺️', '🧭', '✅', '👑', '📝', '🖋️', '📈', '💡', '⚡', '💥', '☀️'
        ];
        let availableQuoteIndices = [];

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        let allCategoriesData = {}; // Stores fetched categories and their nested data
        window.favorites = JSON.parse(localStorage.getItem('favorites')) || []; // Made global for direct access
        let currentView = 'home-view';
        let currentBatchId = null;
        let currentSectionIndex = null;
        window.currentPlayingLectureId = null; // New global to store currently playing lecture ID for comments
        window.lastCategoryViewed = 'all'; // Made global for direct access from HTML
        const surpriseLink = "https://www.youtube.com/watch?v=dQw4w9WgXcQ"; // Example link

        // --- User Name Popup Logic ---
        document.addEventListener('DOMContentLoaded', async () => {
            await authenticateFirebase(); // Authenticate Firebase first
            loadAllCategoriesFromFirebase(); // Start loading categories

            let userName = localStorage.getItem('userName');
            let userRole = localStorage.getItem('userRole');
            const popupOverlay = document.getElementById('namePopupOverlay');
            
            document.body.classList.add('animate-in'); 

            if (!userName || !userRole) {
                popupOverlay.classList.add('active');
                document.querySelector('input[name="userRole"][value="Other"]').checked = true;
            } else {
                updateWelcomeSection();
            }

            for (let i = 0; i < quotes.length; i++) {
                availableQuoteIndices.push(i);
            }
            shuffleArray(availableQuoteIndices);

            window.highlightBottomNav('home-nav'); // Call global function
            renderFavoritesSectionHomeCard();
            window.updateQuote(); // Call global function
            setInterval(window.updateQuote, 6 * 60 * 60 * 1000); // Call global function

            document.addEventListener('contextmenu', (e) => { e.preventDefault(); });

            // Long press functionality
            let pressTimer;
            const longPressDuration = 500;

            function onTouchStart(event) {
                this.classList.add('active');
                const targetElement = this;
                pressTimer = setTimeout(() => {
                    targetElement.classList.add('long-press');
                }, longPressDuration);
            }

            function onTouchEnd(event) {
                clearTimeout(pressTimer);
                this.classList.remove('long-press');
                this.classList.remove('active');
            }

            // Event listeners for static elements now handled in renderCategories for their re-addition
            // document.querySelectorAll('.favorites-section-home-card, .telegram-card, .surprise-button').forEach(item => {
            //     item.addEventListener('touchstart', onTouchStart);
            //     item.addEventListener('touchend', onTouchEnd);
            //     item.addEventListener('touchcancel', onTouchEnd);
            //     item.addEventListener('mousedown', onTouchStart);
            //     item.addEventListener('mouseup', onTouchEnd);
            //     item.addEventListener('mouseleave', onTouchEnd);
            // });

            // Offline detection
            function updateOnlineStatus() {
                const offlineOverlay = document.getElementById('offlineOverlay');
                if (offlineOverlay) { // Check if element exists
                    if (navigator.onLine) {
                        offlineOverlay.classList.remove('active');
                    } else {
                        offlineOverlay.classList.add('active');
                    }
                }
            }

            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);
            updateOnlineStatus();

            // Initial check for dark/light mode preference on load
            const isLightModeEnabled = localStorage.getItem('lightModeEnabled') === 'true';
            if (isLightModeEnabled) {
                document.body.classList.add('light-mode');
                const darkModeToggleSwitch = document.getElementById('darkModeToggleSwitch');
                if (darkModeToggleSwitch) darkModeToggleSwitch.checked = false; // Check if element exists
            } else {
                document.body.classList.remove('light-mode');
                const darkModeToggleSwitch = document.getElementById('darkModeToggleSwitch');
                if (darkModeToggleSwitch) darkModeToggleSwitch.checked = true; // Check if element exists
            }

            // Ensure appLogo rotation works globally
            const appLogo = document.getElementById('appLogo');
            const skillNeastLogoImage = document.getElementById('skillNeastLogo');
            if (appLogo && skillNeastLogoImage) { // Check both parent and child
                appLogo.addEventListener('click', () => {
                    if (!skillNeastLogoImage.classList.contains('rotating')) {
                        skillNeastLogoImage.classList.add('rotating'); // Apply rotating class to image
                        setTimeout(() => {
                            skillNeastLogoImage.classList.remove('rotating'); // Remove class after rotation
                            location.reload(); // Then refresh
                        }, 1000); // Duration of rotation animation
                    }
                });
            }
        });

        // --- Quote Logic ---
        window.updateQuote = function() {
            const quoteTextElement = document.getElementById('quoteText');
            const quoteAuthorElement = document.getElementById('quoteAuthor');
            
            if (!quoteTextElement || !quoteAuthorElement) return; // Add null check

            if (availableQuoteIndices.length === 0) {
                for (let i = 0; i < quotes.length; i++) {
                    availableQuoteIndices.push(i);
                }
                shuffleArray(availableQuoteIndices);
            }

            const quoteIndex = availableQuoteIndices.pop();
            const selectedQuote = quotes[quoteIndex];
            const randomEmoji = allEmojis[Math.floor(Math.random() * allEmojis.length)];

            quoteTextElement.style.animation = 'none';
            quoteAuthorElement.style.animation = 'none';
            void quoteTextElement.offsetWidth;
            void quoteAuthorElement.offsetWidth;

            quoteTextElement.innerHTML = `"${selectedQuote.quote}" <span class="quote-emoji">${randomEmoji}</span>`;
            quoteAuthorElement.textContent = selectedQuote.author;
            quoteTextElement.style.animation = 'quoteSlideIn 0.8s cubic-bezier(0.23, 1, 0.32, 1) forwards';
            quoteAuthorElement.style.animation = 'quoteAuthorFadeIn 1s ease-out forwards';
        }

        window.updateCharCount = function() {
            const userNameInput = document.getElementById('userNameInput');
            const currentCharCount = document.getElementById('currentCharCount');
            if (!userNameInput || !currentCharCount) return; // Add null check
            currentCharCount.textContent = userNameInput.value.length;
        }

        window.submitName = function() {
            const userNameInput = document.getElementById('userNameInput');
            if (!userNameInput) return; // Add null check
            let userName = userNameInput.value.trim();
            const selectedRoleElement = document.querySelector('input[name="userRole"]:checked');
            let userRole = selectedRoleElement ? selectedRoleElement.value : 'Other';

            if (userName === '') {
                userName = 'Guest';
            } else if (userName.length > 15) {
                userName = userName.substring(0, 15);
            }

            localStorage.setItem('userName', userName);
            localStorage.setItem('userRole', userRole);

            updateWelcomeSection();
            window.closeNamePopup();
        }

        function updateWelcomeSection() {
            const userName = localStorage.getItem('userName') || 'Guest';
            const userRole = localStorage.getItem('userRole') || '';
            const displayedUserName = document.getElementById('displayedUserName');
            const displayedUserRoleElement = document.getElementById('displayedUserRole');
            if (displayedUserName) displayedUserName.textContent = userName; // Add null check
            if (displayedUserRoleElement) { // Add null check
                if (userRole && userRole !== 'Other') {
                    displayedUserRoleElement.textContent = userRole;
                    displayedUserRoleElement.style.display = 'inline-block';
                } else {
                    displayedUserRoleElement.textContent = '';
                    displayedUserRoleElement.style.display = 'none';
                }
            }
        }

        window.closeNamePopup = function() {
            const namePopupOverlay = document.getElementById('namePopupOverlay');
            if (namePopupOverlay) namePopupOverlay.classList.remove('active'); // Add null check
        }

        // --- View Switching Logic ---
        function hideAllViews() {
            const views = [
                'home-view', /* Now contains favorites, partitions, telegram, share button */
                'new-batches-view',
                'favorites-view',
                'sections-view',
                'lessons-in-sections-view',
                'video-player-view',
                'bundles-coming-soon-view',
                'pdfs-coming-soon-view',
                'about-me-view',
                'how-to-use-app-view',
                'ai-chatbot-coming-soon-view'
            ];
            views.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.style.display = 'none';
                }
            });

            // Specific top-level elements that are not part of a "view" div
            const welcomeBanner = document.querySelector('.welcome-banner');
            if (welcomeBanner) welcomeBanner.style.display = 'none';

            const quoteSection = document.querySelector('.quote-section');
            if (quoteSection) quoteSection.style.display = 'none';
        }

        window.showHomeView = function() {
            hideAllViews();
            const homeView = document.getElementById('home-view');
            const welcomeBanner = document.querySelector('.welcome-banner');
            const quoteSection = document.querySelector('.quote-section');
            
            if (homeView) homeView.style.display = 'grid'; /* Use grid as home-view is now a grid container */

            renderFavoritesSectionHomeCard(); // Ensure favorites are rendered when showing home view
            currentView = 'home-view';
            window.highlightBottomNav('home-nav');
            window.scrollTo(0, 0);

            if (welcomeBanner) welcomeBanner.style.display = 'flex';
            if (quoteSection) quoteSection.style.display = 'block';

            updateWelcomeSection();
            renderCategories(); /* Re-render categories including static homepage elements */
        }

        // --- Firebase Data Fetching and Rendering ---
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.remove('hidden-on-scroll');
                    entry.target.classList.add('visible-on-scroll');
                } else {
                    if (entry.target.classList.contains('visible-on-scroll')) {
                        entry.target.classList.remove('visible-on-scroll');
                        entry.target.classList.add('hidden-on-scroll');
                    }
                }
            });
        }, { threshold: 0.1 });

        function loadAllCategoriesFromFirebase() {
            const categoriesRef = ref(rtdb, 'categories'); // Use rtdb for Realtime Database
            onValue(categoriesRef, (snapshot) => {
                allCategoriesData = snapshot.val() || {};
                renderCategories();
            }, (error) => {
                console.error("Error fetching categories:", error);
                const loadingCategoriesMessage = document.getElementById('loadingCategoriesMessage');
                if (loadingCategoriesMessage) loadingCategoriesMessage.textContent = `Error loading categories: ${error.message}`;
            });
        }

        function renderCategories() {
            const homeView = document.getElementById('home-view');
            if (!homeView) return;

            // Remove only dynamically added category items
            Array.from(homeView.querySelectorAll('.course-category-item')).forEach(el => el.remove());

            const loadingMessage = document.getElementById('loadingCategoriesMessage');
            if (loadingMessage) loadingMessage.remove(); // Remove initial loading message for categories

            // These elements are now part of home-view's static HTML content.
            // We just need to ensure they are visible if home-view is active and observed for animation.
            const favoritesSection = document.getElementById('favorites-section-home-card');
            const telegramCard = homeView.querySelector('.telegram-card');
            const shareButton = homeView.querySelector('.share-app-button');
            const surpriseButton = homeView.querySelector('.surprise-button');

            if (Object.keys(allCategoriesData).length === 0) {
                // Only add "No categories" message if it doesn't exist and there are no categories
                const noCategoriesMessage = document.getElementById('noCategoriesMessage');
                if (!noCategoriesMessage) {
                    homeView.insertAdjacentHTML('afterbegin', '<p class="text-center text-muted col-span-full" id="noCategoriesMessage">No categories found. Please add courses via the admin panel.</p>');
                }
                return;
            } else {
                 // Ensure noCategoriesMessage is removed if categories are found
                 const noCategoriesMessage = document.getElementById('noCategoriesMessage');
                 if(noCategoriesMessage) noCategoriesMessage.remove();
            }

            // Dynamically add category items
            Object.entries(allCategoriesData).forEach(([catId, category]) => {
                const categoryItem = document.createElement('div');
                categoryItem.className = 'course-category-item hidden-on-scroll';
                categoryItem.onclick = () => window.showNewBatchesView(catId);

                const firstBatch = category.batches ? Object.values(category.batches)[0] : null;
                const imageUrl = firstBatch && firstBatch.thumbnail ? firstBatch.thumbnail : 'https://via.placeholder.com/90x90/00ADB5/1A2B3C?text=Category';
                const isNewCategory = firstBatch && firstBatch.isNew;

                categoryItem.innerHTML = `
                    <div class="image-container">
                        <img src="${imageUrl}" alt="${category.name}" draggable="false" onerror="this.onerror=null;this.src='https://via.placeholder.com/90x90/00ADB5/1A2B3C?text=Category';">
                    </div>
                    <div class="content-overlay">
                        <span class="category-name">${category.name}</span>
                    </div>
                    ${isNewCategory ? '<span class="new-tag">NEW</span>' : ''}
                `;
                homeView.prepend(categoryItem); /* Prepend to show categories first */
                observer.observe(categoryItem);
            });

            // Re-observe static elements in home-view to ensure they animate correctly
            document.querySelectorAll('#home-view .favorites-section-home-card, #home-view .telegram-card, #home-view .share-app-button, #home-view .surprise-button').forEach(item => {
                // Only add hidden-on-scroll if it's not already observed or visible (prevents re-adding class)
                if (!item.classList.contains('hidden-on-scroll') && !item.classList.contains('visible-on-scroll')) {
                    item.classList.add('hidden-on-scroll');
                }
                observer.observe(item);
            });
        }


        window.showNewBatchesView = function(categoryId = 'all') {
            hideAllViews();
            const newBatchesView = document.getElementById('new-batches-view');
            if (newBatchesView) newBatchesView.style.display = 'block';
            
            currentView = 'new-batches-view';
            window.lastCategoryViewed = categoryId; // Use window.lastCategoryViewed
            
            const batchesContainer = document.getElementById('batches-container');
            if (batchesContainer) batchesContainer.innerHTML = '<p class="text-center text-muted" id="loadingBatchesMessage">Loading batches...</p>';

            let batchesToDisplay = [];
            if (categoryId === 'all') {
                const newBatchesTitle = document.getElementById('new-batches-title');
                if (newBatchesTitle) newBatchesTitle.textContent = 'All Courses';
                Object.values(allCategoriesData).forEach(category => {
                    if (category.batches) {
                        batchesToDisplay = batchesToDisplay.concat(Object.keys(category.batches).map(key => ({ id: key, ...category.batches[key] })));
                    }
                });
            } else {
                const selectedCategory = allCategoriesData[categoryId];
                const newBatchesTitle = document.getElementById('new-batches-title');
                if (newBatchesTitle) newBatchesTitle.textContent = selectedCategory ? selectedCategory.name + ' Courses' : 'Courses';
                if (selectedCategory && selectedCategory.batches) {
                    batchesToDisplay = Object.keys(selectedCategory.batches).map(key => ({ id: key, ...selectedCategory.batches[key] }));
                }
            }
            
            const loadingMsg = document.getElementById('loadingBatchesMessage');
            if(loadingMsg) loadingMsg.remove();
            
            displayBatches(batchesToDisplay);
            window.highlightBottomNav('courses-nav');
            window.scrollTo(0, 0);
        }

        function displayBatches(batchesToDisplay) {
            const batchesContainer = document.getElementById('batches-container');
            if (!batchesContainer) return;

            batchesContainer.innerHTML = '';

            if (batchesToDisplay.length === 0) {
                batchesContainer.innerHTML = '<p style="text-align: center; color: var(--text-light);">No batches found matching your search or category.</p>';
                return;
            }

            batchesToDisplay.forEach(batch => {
                const batchCard = document.createElement('div');
                batchCard.className = 'batch-card hidden-on-scroll';
                const isFavorited = window.favorites.includes(batch.id); /* Use window.favorites */
                const heartIconClass = isFavorited ? 'fas fa-heart' : 'far fa-heart';

                batchCard.innerHTML = `
                    <div class="batch-card-header" style="background-color: ${batch.headerColor || 'var(--accent-teal)'};">
                        <span>${batch.title}</span>
                        <div class="icons">
                            <i class="${heartIconClass}" onclick="event.stopPropagation(); window.toggleFavorite('${batch.id}', this);"></i>
                            <i class="fas fa-share-alt share-batch-btn" data-batch-id="${batch.id}" data-batch-title="${encodeURIComponent(batch.title || '')}" data-batch-desc="${encodeURIComponent(batch.description || '')}" onclick="event.stopPropagation();"></i>
                        </div>
                    </div>
                    <div class="batch-card-body">
                        <div class="batch-image-container">
                            <img src="${batch.thumbnail}" alt="${batch.title}" draggable="false" onerror="this.onerror=null;this.src='https://via.placeholder.com/200x150/00ADB5/1A2B3C?text=Batch+Image';">
                        </div>
                        <div class="batch-title">${batch.title}</div>
                        <p class="batch-description">${batch.description || 'No detailed description available.'}</p>
                        <button class="lets-roar-button" data-batch-id="${batch.id}">LET'S ROAR 🚀🔥</button>
                    </div>
                `;
                batchesContainer.appendChild(batchCard);

                // Attach event listener for the share button on batches
                const shareButton = batchCard.querySelector('.share-batch-btn');
                if (shareButton) {
                    shareButton.addEventListener('click', (e) => {
                        const batchTitle = decodeURIComponent(e.target.dataset.batchTitle);
                        const batchDesc = decodeURIComponent(e.target.dataset.batchDesc);
                        window.shareBatch(batchTitle, batchDesc);
                    });
                }
                
                // Attach event listener to the lets-roar button
                const letsRoarButton = batchCard.querySelector('.lets-roar-button');
                if (letsRoarButton) {
                    letsRoarButton.addEventListener('click', () => {
                        const clickedBatchId = letsRoarButton.dataset.batchId;
                        window.showSectionsView(clickedBatchId); // Navigate to sections view
                    });
                }
                observer.observe(batchCard);
            });
        }

        window.filterBatches = function() {
            const searchTerm = document.getElementById('batchSearchInput');
            if (!searchTerm) return;
            
            let currentCategoryBatches = [];

            if (window.lastCategoryViewed === 'all') { // Use window.lastCategoryViewed
                Object.values(allCategoriesData).forEach(category => {
                    if (category.batches) {
                        currentCategoryBatches = currentCategoryBatches.concat(Object.keys(category.batches).map(key => ({ id: key, ...category.batches[key] })));
                    }
                });
            } else {
                const selectedCategory = allCategoriesData[window.lastCategoryViewed]; // Use window.lastCategoryViewed
                if (selectedCategory && selectedCategory.batches) {
                    currentCategoryBatches = Object.keys(selectedCategory.batches).map(key => ({ id: key, ...selectedCategory.batches[key] }));
                }
            }

            const filteredBatches = currentCategoryBatches.filter(batch => 
                batch.title.toLowerCase().includes(searchTerm.value.toLowerCase())
            );
            displayBatches(filteredBatches);
        }

        // --- Favorites Logic ---
        window.toggleFavorite = function(batchId, iconElement) {
            if (window.favorites.includes(batchId)) { // Use window.favorites
                window.favorites = window.favorites.filter(id => id !== batchId); // Use window.favorites
                if (iconElement) {
                    iconElement.classList.remove('fas');
                    iconElement.classList.add('far');
                }
            } else {
                window.favorites.push(batchId); // Use window.favorites
                if (iconElement) {
                    iconElement.classList.remove('far');
                    iconElement.classList.add('fas');
                }
            }
            localStorage.setItem('favorites', JSON.stringify(window.favorites)); // Use window.favorites
            renderFavoritesSectionHomeCard();
            if (currentView === 'favorites-view') {
                window.showFavoritesView();
            }
        }

        function renderFavoritesSectionHomeCard() {
            const favoritesCountSpan = document.getElementById('favorites-count');
            if (favoritesCountSpan) favoritesCountSpan.textContent = `${window.favorites.length} Batches`; // Use window.favorites
        }

        window.showFavoritesView = function() {
            hideAllViews();
            const favoritesView = document.getElementById('favorites-view');
            if (favoritesView) favoritesView.style.display = 'block';
            
            currentView = 'favorites-view';
            window.highlightBottomNav('home-nav');

            const favoriteBatchesContainer = document.getElementById('favorite-batches-container');
            const noFavoritesMessageView = document.getElementById('no-favorites-message-view');

            if (!favoriteBatchesContainer || !noFavoritesMessageView) return;

            favoriteBatchesContainer.innerHTML = '';
            if (window.favorites.length === 0) { // Use window.favorites
                noFavoritesMessageView.style.display = 'block';
                favoriteBatchesContainer.style.display = 'none';
            } else {
                noFavoritesMessageView.style.display = 'none';
                favoriteBatchesContainer.style.display = 'flex';

                window.favorites.forEach(favId => { // Use window.favorites
                    let batch = null;
                    for (const catId in allCategoriesData) {
                        if (allCategoriesData[catId].batches && allCategoriesData[catId].batches[favId]) {
                            batch = { id: favId, ...allCategoriesData[catId].batches[favId] };
                            break;
                        }
                    }

                    if (batch) {
                        const isFavorited = window.favorites.includes(batch.id); // Use window.favorites
                        const heartIconClass = isFavorited ? 'fas fa-heart' : 'far fa-heart';

                        const favBatchCard = document.createElement('div');
                        favBatchCard.className = 'batch-card hidden-on-scroll';
                        favBatchCard.innerHTML = `
                            <div class="batch-card-header" style="background-color: ${batch.headerColor || 'var(--accent-teal)'};">
                                <span>${batch.title}</span>
                                <div class="icons">
                                    <i class="${heartIconClass}" onclick="event.stopPropagation(); window.toggleFavorite('${batch.id}', this);"></i>
                                    <i class="fas fa-share-alt share-batch-btn" data-batch-id="${batch.id}" data-batch-title="${encodeURIComponent(batch.title || '')}" data-batch-desc="${encodeURIComponent(batch.description || '')}" onclick="event.stopPropagation();"></i>
                                </div>
                            </div>
                            <div class="batch-card-body">
                                 <div class="batch-image-container">
                                    <img src="${batch.thumbnail}" alt="${batch.title}" draggable="false" onerror="this.onerror=null;this.src='https://via.placeholder.com/200x150/00ADB5/1A2B3C?text=Batch+Image';">
                                </div>
                                <div class="batch-title">${batch.title}</div>
                                <p class="batch-description">${batch.description || 'No detailed description available.'}</p>
                                <button class="lets-roar-button" data-batch-id="${batch.id}">LET'S ROAR 🚀🔥</button>
                            </div>
                        `;
                        favoriteBatchesContainer.appendChild(favBatchCard);
                        const letsRoarButton = favBatchCard.querySelector('.lets-roar-button');
                        if (letsRoarButton) {
                            letsRoarButton.addEventListener('click', () => {
                                const clickedBatchId = letsRoarButton.dataset.batchId;
                                window.showSectionsView(clickedBatchId); // Navigate to sections view
                            });
                        }
                        observer.observe(favBatchCard);
                    }
                });
            }
            window.scrollTo(0, 0);
        }

        // --- Show Sections (Folders) for a Batch ---
        window.showSectionsView = function(batchId) {
            hideAllViews();
            currentBatchId = batchId;
            
            let selectedBatch = null;
            let currentCategoryId = null;
            for (const catId in allCategoriesData) {
                if (allCategoriesData[catId].batches && allCategoriesData[catId].batches[batchId]) {
                    selectedBatch = allCategoriesData[catId].batches[batchId];
                    currentCategoryId = catId;
                    break;
                }
            }

            const sectionsContainer = document.getElementById('sections-container');
            const sectionsTitle = document.getElementById('sections-title');
            if (!sectionsContainer || !sectionsTitle) return;

            sectionsContainer.innerHTML = '';

            if (selectedBatch && selectedBatch.modules && Object.keys(selectedBatch.modules).length > 0) {
                sectionsTitle.textContent = selectedBatch.title + ' Modules';
                Object.entries(selectedBatch.modules).forEach(([moduleId, module], index) => {
                    // Count lectures within this module
                    const lectureCount = module.lectures ? Object.keys(module.lectures).length : 0;
                    const sectionItem = document.createElement('div');
                    sectionItem.className = 'section-item hidden-on-scroll';
                    sectionItem.onclick = () => window.showLessonsInSectionsView(currentCategoryId, batchId, moduleId);
    
                    // Updated HTML structure for module item to match screenshot 200107.jpg
                    sectionItem.innerHTML = `
                        <span class="section-name">${module.name}</span>
                        <div class="section-counts">
                            <span>${lectureCount} Videos</span>,
                            <span>0 Notes</span>, <!-- Placeholder for Notes Count -->
                            <span>0 Exercises</span> <!-- Placeholder for Exercises Count -->
                        </div>
                        <i class="fas fa-chevron-right section-arrow"></i>
                    `;
                    sectionsContainer.appendChild(sectionItem);
                    observer.observe(sectionItem);
                });
            } else {
                sectionsTitle.textContent = selectedBatch ? selectedBatch.title + ' Modules' : 'Modules';
                sectionsContainer.innerHTML = '<p style="text-align: center; color: var(--text-light);">No modules found for this batch.</p>';
            }

            const sectionsView = document.getElementById('sections-view');
            if (sectionsView) sectionsView.style.display = 'block';
            currentView = 'sections-view';
            window.scrollTo(0, 0);
        }

        // --- Show Lessons within a Section (Folder) ---
        window.showLessonsInSectionsView = function(categoryId, batchId, moduleId) {
            hideAllViews();
            currentBatchId = batchId;
            currentSectionIndex = moduleId;

            const selectedCategory = allCategoriesData[categoryId];
            const selectedBatch = selectedCategory && selectedCategory.batches ? selectedCategory.batches[batchId] : null;
            const selectedModule = selectedBatch && selectedBatch.modules ? selectedBatch.modules[moduleId] : null;

            const lessonsContainer = document.getElementById('lessons-in-sections-container');
            const lessonsTitle = document.getElementById('lessons-in-sections-title');
            if (!lessonsContainer || !lessonsTitle) return;

            lessonsContainer.innerHTML = '';

            if (selectedModule && selectedModule.lectures && Object.keys(selectedModule.lectures).length > 0) {
                lessonsTitle.textContent = selectedModule.name + ' (' + selectedBatch.title + ')';
                Object.entries(selectedModule.lectures).forEach(([lectureId, lecture], lessonIndex) => {
                    const lessonItem = document.createElement('div');
                    lessonItem.className = 'lesson-list-item hidden-on-scroll';
                    lessonItem.onclick = () => window.showVideoPlayerView(categoryId, batchId, moduleId, lectureId);
                   
                    // Implement UI from Screenshot_20250613-191010.jpg (simplified to remove unnecessary elements)
                    lessonItem.innerHTML = `
                        <div class="lesson-list-item-left">
                            <!-- Removed PW Logo -->
                        </div>
                        <div class="lesson-list-item-right">
                            <h3 class="lesson-list-item-title">${lecture.name}</h3>
                        </div>
                        <div class="video-icon-overlay">
                            <i class="fas fa-video"></i>
                        </div>
                    `;
                    lessonsContainer.appendChild(lessonItem);
                    observer.observe(lessonItem);
                });
            } else {
                lessonsTitle.textContent = selectedModule ? selectedModule.name : 'Lessons';
                lessonsContainer.innerHTML = '<p style="text-align: center; color: var(--text-light);">No lectures found in this module.</p>';
            }

            const lessonsInSectionsView = document.getElementById('lessons-in-sections-view');
            if (lessonsInSectionsView) lessonsInSectionsView.style.display = 'block';
            currentView = 'lessons-in-sections-view';
            window.scrollTo(0, 0);
        }

        // --- Video Player View (For individual lessons) ---
        window.showVideoPlayerView = function(categoryId, batchId, moduleId, lectureId) {
            hideAllViews();
            currentBatchId = batchId;
            currentSectionIndex = moduleId;
            window.currentPlayingLectureId = lectureId; // Set current playing lecture ID

            const selectedCategory = allCategoriesData[categoryId];
            const selectedBatch = selectedCategory && selectedCategory.batches ? selectedCategory.batches[batchId] : null;
            const selectedModule = selectedBatch && selectedBatch.modules ? selectedBatch.modules[moduleId] : null;
            const selectedLecture = selectedModule && selectedModule.lectures ? selectedModule.lectures[lectureId] : null;

            if (!selectedCategory || !selectedBatch || !selectedModule || !selectedLecture) {
                alert('Lesson details not found! Please check the data structure or Firebase data.');
                window.goBackFromPlayerView();
                return;
            }
            
            const playerViewTitle = document.getElementById('player-view-title');
            if (playerViewTitle) playerViewTitle.textContent = selectedLecture.name;
            
            const playerLessonSubTitle = document.getElementById('player-lesson-sub-title');
            if (playerLessonSubTitle) playerLessonSubTitle.textContent = selectedLecture.name; // Can be improved if subtitle is in Firebase

            const mainVideoPlayer = document.getElementById('main-video-player');
            if (mainVideoPlayer) {
                mainVideoPlayer.innerHTML = '';
                const videoInfo = extractGdriveId(selectedLecture.link);
                if (videoInfo) {
                    let embedUrl = '';
                    if (videoInfo.type === 'gdrive') {
                        embedUrl = `https://drive.google.com/file/d/${videoInfo.id}/preview`;
                    } else if (videoInfo.type === 'youtube') {
                        embedUrl = `https://www.youtube-nocookie.com/embed/${videoInfo.id}?autoplay=1`;
                    }
                    
                    if (embedUrl) {
                        mainVideoPlayer.innerHTML = `<iframe src="${embedUrl}" allowfullscreen draggable="false" allow="autoplay; encrypted-media"></iframe>`;
                    } else {
                        mainVideoPlayer.innerHTML = `<p style="color: white; text-align: center; padding: 20px;">Error: Could not construct embed URL for this video type.</p>`;
                    }
                } else {
                    mainVideoPlayer.innerHTML = `
                        <p style="color: white; text-align: center; padding: 20px; background-color: rgba(0,0,0,0.5); border-radius: 10px;">
                            Video Not Found or Link Invalid.<br><br>
                            To play videos, ensure:<br>
                            1. It's a Google Drive video with 'Anyone with the link' access.<br>
                            2. You copy the ID correctly from a URL like:
                            <code>https://drive.google.com/file/d/<b>YOUR_VIDEO_ID</b>/view</code><br>
                            Then paste the full preview link: <code>https://www.youtube.com/file/d/<b>YOUR_VIDEO_ID</b>/preview</code><br>
                            (YouTube links are also supported for demonstration, e.g., <code>https://www.youtube.com/watch?v=<b>VIDEO_ID</b></code>)
                        </p>
                    `;
                }
            }

            const lessonsForPlayerBatch = document.getElementById('lessons-for-player-batch');
            if (lessonsForPlayerBatch) {
                lessonsForPlayerBatch.innerHTML = '';
                if (selectedModule && selectedModule.lectures) {
                    Object.entries(selectedModule.lectures).forEach(([otherLectureId, otherLecture]) => {
                        const lessonItem = document.createElement('li');
                        lessonItem.className = 'lesson-item hidden-on-scroll';
                        lessonItem.onclick = () => window.showVideoPlayerView(categoryId, batchId, moduleId, otherLectureId);
                        
                        // Re-use the simplified lesson-list-item structure from showLessonsInSectionsView
                        lessonItem.innerHTML = `
                            <div class="lesson-list-item-left">
                                <!-- Removed PW Logo -->
                            </div>
                            <div class="lesson-list-item-right">
                                <h3 class="lesson-list-item-title">${otherLecture.name}</h3>
                            </div>
                            <div class="video-icon-overlay">
                                <i class="fas fa-video"></i>
                            </div>
                        `;
                        lessonsForPlayerBatch.appendChild(lessonItem);
                        observer.observe(lessonItem);
                    });
                } else {
                     lessonsForPlayerBatch.innerHTML = '<p style="text-align: center; color: var(--text-light);">No other lectures in this module.</p>';
                }
            }

            const videoPlayerView = document.getElementById('video-player-view');
            if (videoPlayerView) videoPlayerView.style.display = 'block';
            currentView = 'video-player-view';
            window.scrollTo(0, 0);
        }

        // --- Back Button Logic from Player View ---
        window.goBackFromPlayerView = function() {
            if (currentBatchId && currentSectionIndex !== null) {
                let categoryId = null;
                for (const catId in allCategoriesData) {
                    if (allCategoriesData[catId].batches && allCategoriesData[catId].batches[currentBatchId]) {
                        categoryId = catId;
                        break;
                    }
                }
                if (categoryId) {
                    window.showLessonsInSectionsView(categoryId, currentBatchId, currentSectionIndex);
                    return;
                }
            } 
            window.showNewBatchesView(window.lastCategoryViewed); // Go back to the last viewed category
        }

        // --- Back Button Logic from Lessons In Sections View ---
        window.goBackFromLessonsList = function() {
            if (currentBatchId) {
                window.showSectionsView(currentBatchId);
            } else {
                window.showNewBatchesView(window.lastCategoryViewed); // Go back to the last viewed category
            }
        }

        // --- Video ID Extraction Logic (Handles Google Drive and YouTube) ---
        function extractGdriveId(url) {
            const gdriveRegex = /(?:drive\.google\.com\/(?:file\/d\/|open\?id=)|docs\.google\.com\/file\/d\/|drive\.google\.com\/uc\?id=)([a-zA-Z0-9_-]+)(?:\/preview|\/view|\/edit)?/;
            const gdriveMatch = url.match(gdriveRegex);
            if (gdriveMatch) {
                return { type: 'gdrive', id: gdriveMatch[1] };
            }

            const youtubeRegex = /(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
            const youtubeMatch = url.match(youtubeRegex);
            if (youtubeMatch) {
                return { type: 'youtube', id: youtubeMatch[1] };
            }

            return null;
        }

        // --- Bottom Navigation Highlight ---
        window.highlightBottomNav = function(activeId) {
            document.querySelectorAll('.bottom-navbar .nav-item').forEach(item => {
                if (item) item.classList.remove('active');
            });
            const activeItem = document.getElementById(activeId);
            if (activeItem) activeItem.classList.add('active');
        }

        // --- Comments Popup Logic (using Firestore) ---
        window.showCommentsPopup = function() {
            const commentsPopupOverlay = document.getElementById('commentsPopupOverlay');
            const commentsHeader = document.getElementById('commentsHeader');
            if (!commentsPopupOverlay || !commentsHeader) return;

            commentsPopupOverlay.classList.add('active');
            const playerViewTitle = document.getElementById('player-view-title');
            if (playerViewTitle) {
                commentsHeader.textContent = `Comments for ${playerViewTitle.textContent}`;
            } else {
                commentsHeader.textContent = `SR Comments`;
            }
            renderComments(window.currentPlayingLectureId); // Render comments for the current lecture
        }

        window.closeCommentsPopup = function() {
            const commentsPopupOverlay = document.getElementById('commentsPopupOverlay');
            if (commentsPopupOverlay) commentsPopupOverlay.classList.remove('active');
            // Unsubscribe from Firestore listener when closing popup
            if (window.unsubscribeComments) {
                window.unsubscribeComments();
                window.unsubscribeComments = null;
            }
        }

        // Firestore listener for comments
        window.unsubscribeComments = null; // Made global to manage subscription

        async function renderComments(lectureId) {
            const commentsDisplayArea = document.getElementById('commentsDisplayArea');
            if (!commentsDisplayArea) return;

            commentsDisplayArea.innerHTML = '<p class="no-comments-message">Loading comments...</p>'; // Show loading message

            // Unsubscribe from previous listener if active
            if (window.unsubscribeComments) {
                window.unsubscribeComments();
            }

            // Correctly access __app_id within the module scope
            const currentAppId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

            if (!lectureId) {
                commentsDisplayArea.innerHTML = '<p class="no-comments-message">No lecture selected for comments.</p>';
                return;
            }

            // Reference to Firestore collection
            const commentsCollectionRef = collection(firestore, `artifacts/${currentAppId}/public/comments/${lectureId}/userComments`);
            const q = query(commentsCollectionRef); // You can add orderBy here if needed, but Firestore needs indexes.

            window.unsubscribeComments = onSnapshot(q, (snapshot) => { // Assign to global
                commentsDisplayArea.innerHTML = ''; // Clear existing comments
                if (snapshot.empty) {
                    commentsDisplayArea.innerHTML = '<p class="no-comments-message">No comments yet. Be the first to comment!</p>';
                } else {
                    snapshot.forEach(doc => {
                        const comment = doc.data();
                        const commentItem = document.createElement('div');
                        commentItem.className = 'comment-item';
                        const timestamp = comment.timestamp && comment.timestamp.seconds ? new Date(comment.timestamp.seconds * 1000).toLocaleTimeString() : 'Unknown Time';
                        commentItem.innerHTML = `
                            <strong>${comment.userDisplayName || 'Anonymous'}</strong> <span>(${timestamp})</span><br>
                            ${comment.commentText}
                        `;
                        commentsDisplayArea.appendChild(commentItem);
                    });
                }
                commentsDisplayArea.scrollTop = commentsDisplayArea.scrollHeight; // Scroll to bottom
            }, (error) => {
                console.error("Error fetching comments:", error);
                commentsDisplayArea.innerHTML = `<p class="no-comments-message" style="color:red;">Error loading comments: ${error.message}</p>`;
            });
        }

        window.postComment = async function() {
            const commentInput = document.getElementById('commentInput');
            if (!commentInput) return;
            const commentText = commentInput.value.trim();
            const userName = localStorage.getItem('userName') || 'Guest';
            
            if (!commentText) {
                alert('Please write something before posting!');
                return;
            }

            if (!window.currentPlayingLectureId) {
                alert('Cannot post comment: No lecture selected.');
                return;
            }
            if (!currentUserId) {
                 alert('Cannot post comment: User not authenticated.');
                 return;
            }

            const currentAppId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';


            try {
                await addDoc(collection(firestore, `artifacts/${currentAppId}/public/comments/${window.currentPlayingLectureId}/userComments`), {
                    userDisplayName: userName,
                    userId: currentUserId,
                    commentText: commentText,
                    timestamp: serverTimestamp() // Use Firestore server timestamp
                });
                commentInput.value = ''; // Clear input after posting
                console.log("Comment posted successfully!");
            } catch (error) {
                console.error("Error posting comment:", error);
                alert(`Failed to post comment: ${error.message}`);
            }
        }

        // --- New: Show Coming Soon Views ---
        window.showComingSoonView = function(type) {
            hideAllViews();
            let targetView = null;
            if (type === 'bundles') {
                targetView = document.getElementById('bundles-coming-soon-view');
            } else if (type === 'pdfs') {
                targetView = document.getElementById('pdfs-coming-soon-view');
            } else if (type === 'ai-chatbot') {
                targetView = document.getElementById('ai-chatbot-coming-soon-view');
            }

            if (targetView) targetView.style.display = 'flex';
            currentView = `${type}-coming-soon-view`;
            window.scrollTo(0, 0);
        }

        // --- Today's Surprise Function ---
        window.openSurpriseLink = function() {
            window.open(surpriseLink, '_blank');
        }

        // --- About Me View Logic ---
        window.showAboutMeView = function() {
            hideAllViews();
            const aboutMeView = document.getElementById('about-me-view');
            if (aboutMeView) aboutMeView.style.display = 'flex';
            currentView = 'about-me-view';
            window.highlightBottomNav('about-me-nav');
            window.scrollTo(0, 0);
        }

        // --- New: How to use the App View Logic ---
        window.showHowToUseAppView = function() {
            hideAllViews();
            const howToUseAppView = document.getElementById('how-to-use-app-view');
            if (howToUseAppView) howToUseAppView.style.display = 'flex';
            currentView = 'how-to-use-app-view';
            window.scrollTo(0, 0);
        }

        // --- Slider Menu Functions ---
        window.openSliderMenu = function() {
            const sliderMenuOverlay = document.getElementById('sliderMenuOverlay');
            const sliderMenu = document.getElementById('sliderMenu');
            if (sliderMenuOverlay) sliderMenuOverlay.classList.add('active');
            if (sliderMenu) sliderMenu.classList.add('active');
        }

        window.closeSliderMenu = function() {
            const sliderMenuOverlay = document.getElementById('sliderMenuOverlay');
            const sliderMenu = document.getElementById('sliderMenu');
            if (sliderMenuOverlay) sliderMenuOverlay.classList.remove('active');
            if (sliderMenu) sliderMenu.classList.remove('active');
        }

        // --- Share App Function (for specific batches) ---
        window.shareBatch = function(title, description) {
            if (navigator.share) {
                navigator.share({
                    title: `Check out this course: ${title} on SkillNeast! 🚀`,
                    text: `${description}\n\nLearn more at SkillNeast!`,
                    url: window.location.href // Shares the current app URL, as deep linking for batches is complex
                }).then(() => {
                    console.log('Thanks for sharing!');
                }).catch((error) => {
                    console.error('Error sharing:', error);
                    alert(`Share feature not fully supported or allowed on this device/browser. You can copy the link and share:\n\nTitle: ${title}\nDescription: ${description}\nLink: ${window.location.href}`);
                });
            } else {
                alert(`Share feature not supported on this browser. You can copy the link and share:\n\nTitle: ${title}\nDescription: ${description}\nLink: ${window.location.href}`);
            }
        }

        // --- Dark Mode Toggle Functionality ---
        window.toggleDarkMode = function() {
            const body = document.body;
            body.classList.toggle('light-mode'); 
            
            const isLightMode = body.classList.contains('light-mode');
            localStorage.setItem('lightModeEnabled', isLightMode);
            
            const darkModeToggleSwitch = document.getElementById('darkModeToggleSwitch');
            if (darkModeToggleSwitch) darkModeToggleSwitch.checked = !isLightMode;
        }
    </script>
</body>
</html>
